<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pixel Journey || NFT Staking Dashboard</title>
  <link rel="icon" type="image/x-icon" href="https://pixeljourney.xyz/img/logo.png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
  <style>
    :root {
      /* Modern color palette */
      --primary-color: #10a37f;
      --primary-dark: #0d8c6e;
      --primary-light: #1cbe94;
      --bg-dark: #1a1b1e;
      --bg-light: #ffffff;
      --card-dark: #27292d;
      --card-light: #f5f7fa;
      --text-dark: #e4e6eb;
      --text-light: #1f2937;
      --accent-dark: #2d2f31;
      --accent-light: #f2f3f5;
      --border-dark: #3a3d40;
      --border-light: #e5e7eb;
      --hover-dark: #2f3134;
      --hover-light: #eaeaea;
      --shadow-dark: 0 4px 12px rgba(0, 0, 0, 0.3);
      --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.1);
      --gradient-primary: linear-gradient(135deg, #10a37f, #14b885);
      --gradient-secondary: linear-gradient(135deg, #2d2f31, #3a3d40);
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --transition-fast: 0.2s ease;
      --transition-normal: 0.3s ease;
      --font-main: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    /* Base styles */
    body {
      background-color: var(--bg-dark);
      color: var(--text-dark);
      font-family: var(--font-main);
      line-height: 1.6;
      transition: all var(--transition-normal);
      margin: 25px;
      padding: 0;
      min-height: 100vh;
    }

    body.light-mode {
      background-color: var(--bg-light);
      color: var(--text-light);
    }

    /* Typography */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-weight: 600;
      margin-top: 0;
      color: var(--primary-color);
    }

    a {
      color: var(--primary-color);
      text-decoration: none;
      transition: all var(--transition-fast);
    }

    a:hover {
      color: var(--primary-light);
      text-decoration: none;
    }

    /* Layout components */
    .container {
      max-width: 1400px;
      padding: 0 30px;
      margin: 0 auto;
    }

    /* Header improvements */
    header {
      background: var(--gradient-secondary);
      padding: 20px 0;
      box-shadow: var(--shadow-dark);
      position: relative;
      z-index: 10;
      margin-bottom: 20px;
    }

    header h1 {
      font-size: 28px;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      display: inline-block;
    }

    header.light-mode {
      background-color: var(--card-light);
      box-shadow: var(--shadow-light);
    }

    /* Stats bar improvements */
    .stats-bar {
      display: flex;
      align-items: center;
      padding: 15px 25px;
      background: rgba(39, 41, 45, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(58, 61, 64, 0.5);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-dark);
      margin: 20px auto;
      max-width: 1200px;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .stats-bar .stat {
      display: flex;
      align-items: center;
      padding: 8px 15px;
      background: rgba(16, 163, 127, 0.1);
      border: 1px solid rgba(16, 163, 127, 0.2);
      border-radius: var(--radius-sm);
      font-weight: 500;
      transition: all var(--transition-fast);
      margin: 5px;
      min-width: 180px;
    }

    .stats-bar .stat:hover {
      background: rgba(16, 163, 127, 0.2);
      transform: translateY(-2px);
    }

    .stats-bar img {
      height: 32px;
      margin-right: 15px;
      transition: transform var(--transition-fast);
    }

    .stats-bar img:hover {
      transform: scale(1.1);
    }

    .stats-bar.light-mode {
      background: rgba(245, 247, 250, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(229, 231, 235, 0.5);
      box-shadow: var(--shadow-light);
    }

    .light-mode .stat {
      background: var(--accent-light);
      color: var(--text-light);
    }

    /* Rewards section styling */
    .rewards-section {
      background: rgba(39, 41, 45, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(58, 61, 64, 0.5);
      border-radius: var(--radius-md);
      padding: 15px 25px;
      margin: 20px auto;
      max-width: 1200px;
      text-align: center;
      box-shadow: var(--shadow-dark);
      display: none;
      /* Hide by default */
    }

    .rewards-section h3 {
      margin-bottom: 15px;
      color: var(--primary-color);
    }

    #claimableRewards {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--text-dark);
    }

    .claim-btn {
      background: var(--gradient-primary);
      color: white;
      border: none;
      padding: 10px 25px;
      border-radius: var(--radius-md);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-fast);
      box-shadow: 0 4px 10px rgba(16, 163, 127, 0.3);
    }

    .claim-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(16, 163, 127, 0.4);
    }

    .claim-btn:active {
      transform: translateY(1px);
    }

    .light-mode .rewards-section {
      background: rgba(245, 247, 250, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(229, 231, 235, 0.5);
    }

    .light-mode #claimableRewards {
      color: var(--text-light);
    }

    /* Buttons */
    button,
    .btn {
      border: none;
      color: white;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: var(--radius-sm);
      background: var(--gradient-primary);
      font-weight: 500;
      transition: all var(--transition-fast), transform 0.1s ease;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      text-transform: none;
      letter-spacing: 0.3px;
    }

    button:hover,
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      background: var(--primary-color);
    }

    button:active,
    .btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    .btn-secondary {
      background: var(--gradient-secondary);
      margin: 0 5px 5px 0;    
      place-content: center;
    }

    .btn-secondary:hover {
      background: var(--accent-dark);
    }

    .light-mode .btn-secondary {
      background: var(--accent-light);
      color: var(--text-light);
    }

    .light-mode .btn-secondary:hover {
      background: var(--hover-light);
    }

    /* Cards */
    .card {
      background: var(--card-dark);
      color: var(--text-dark);
      padding: 20px;
      border: none;
      border-radius: var(--radius-md);
      margin-bottom: 20px;
      transition: all var(--transition-normal);
      box-shadow: var(--shadow-dark);
    }

    .light-mode .card {
      background: rgba(245, 247, 250, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(229, 231, 235, 0.5);
      box-shadow: var(--shadow-light);
    }

    .card-body {
      padding: 0;
    }

    /* Dark mode toggle */
    .dark-mode-toggle {
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: var(--primary-color);
      color: white;
      border: none;
      margin: 10px 15px;
      margin-left: 0;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .dark-mode-toggle:hover {
      background: var(--primary-light);
      transform: translateY(-2px);
    }

    .dark-mode-toggle:before {
      content: "☀️";
      font-size: 16px;
    }

    /* Template grid */
    .template-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .template-card {
      background: var(--card-dark);
      border-radius: var(--radius-md);
      overflow: hidden;
      transition: all var(--transition-fast);
      box-shadow: var(--shadow-dark);
      position: relative;
      display: flex;
      flex-direction: column;
    }

    .template-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    }

    .template-card .template-image {
      height: 160px;
      background-size: cover;
      background-position: center;
      background-color: var(--accent-dark);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-dark);
      font-weight: bold;
      font-size: 18px;
    }

    .template-card .template-info {
      padding: 15px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .template-card .template-name {
      font-weight: 600;
      font-size: 18px;
      margin-bottom: 5px;
      color: var(--primary-color);
    }

    .template-card .template-type {
      font-size: 14px;
      color: var(--text-dark);
      opacity: 0.8;
      margin-bottom: 10px;
    }

    .template-card .template-stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .template-card .stat-value {
      font-weight: 600;
      font-size: 16px;
      color: var(--primary-light);
    }

    .template-card .stat-label {
      font-size: 12px;
      opacity: 0.7;
    }

    .template-card .template-actions {
      margin-top: auto;
      display: flex;
      gap: 10px;
    }

    .template-card .asset-count {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(16, 163, 127, 0.9);
      color: white;
      border-radius: 20px;
      padding: 3px 10px;
      font-size: 12px;
      font-weight: 600;
    }

    .template-card .staked-count {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(45, 47, 49, 0.9);
      color: white;
      border-radius: 20px;
      padding: 3px 10px;
      font-size: 12px;
      font-weight: 600;
    }

    /* Asset selection modal */
    .modal-content {
      background: var(--card-dark);
      color: var(--text-dark);
      border: none;
      border-radius: var(--radius-md);
    }

    .modal-header {
      border-bottom: 1px solid var(--border-dark);
    }

    .modal-footer {
      border-top: 1px solid var(--border-dark);
    }

    .asset-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
      max-height: 400px;
      overflow-y: auto;
      padding: 10px;
    }

    .asset-item {
      border: 2px solid transparent;
      border-radius: var(--radius-sm);
      overflow: hidden;
      cursor: pointer;
      position: relative;
      transition: all var(--transition-fast);
    }

    .asset-item:hover {
      transform: scale(1.05);
    }

    .asset-item.selected {
      border-color: var(--primary-color);
    }

    .asset-item img {
      width: 100%;
      height: auto;
      display: block;
    }

    .asset-item .asset-id {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 10px;
      padding: 2px 5px;
      text-align: center;
    }

    .selection-controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    /* Loading spinner */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .stats-bar {
        flex-direction: column;
        align-items: center;
        padding: 10px;
      }

      .stats-bar .stat {
        margin-bottom: 5px;
        width: 100%;
        justify-content: center;
      }

      .template-grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      }
    }

    /* Total staking power highlight */
    .total-power {
      background: var(--gradient-primary);
      color: white;
      padding: 15px 25px;
      border-radius: var(--radius-md);
      text-align: center;
      margin: 20px 0;
      box-shadow: var(--shadow-dark);
      animation: pulse 2s infinite;
      cursor: pointer;
    }

    .total-power h3 {
      margin: 0;
      color: white;
      font-size: 24px;
    }

    .total-power .power-value {
      font-size: 36px;
      font-weight: 700;
      margin: 10px 0;
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(16, 163, 127, 0.4);
      }

      70% {
        box-shadow: 0 0 0 10px rgba(16, 163, 127, 0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(16, 163, 127, 0);
      }
    }

    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      border-radius: var(--radius-md);
    }

    .global-loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .loading-content {
      background: var(--card-dark);
      padding: 30px;
      border-radius: var(--radius-md);
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: var(--shadow-dark);
    }

    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid rgba(16, 163, 127, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 1s ease-in-out infinite;
      margin-bottom: 15px;
    }

    .loading-text {
      color: var(--text-dark);
      font-weight: 500;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Video backgrounds for template cards */
    .template-image.video-bg {
      position: relative;
      overflow: hidden;
    }

    .template-image.video-bg video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .template-image::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.2);
      z-index: 1;
    }

    .template-image.video-bg .template-name-overlay {
      position: absolute;
      bottom: 10px;
      left: 10px;
      color: white;
      font-weight: bold;
      z-index: 2;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
    }

    .template-container:hover .template-name-overlay {
      background: rgba(16, 163, 127, 0.8);
    }



    /* Add this to your existing CSS */
    .power-value-container {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 10px 0;
    }

    .power-value {
      font-size: 36px;
      font-weight: 700;
      margin: 0 5px;
    }

    .power-rate {
      font-size: 16px;
      opacity: 0.8;
      align-self: flex-end;
      margin-bottom: 8px;
    }

    /* .info-icon {
    margin-left: 10px;
    cursor: pointer;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    transition: all var(--transition-fast);
}

.info-icon:hover {
    background: rgba(255, 255, 255, 0.4);
    transform: scale(1.1);
} */

    .earnings-table {
      width: 100%;
      border-collapse: collapse;
    }

    .earnings-table th,
    .earnings-table td {
      padding: 8px 12px;
      text-align: right;
    }

    .earnings-table th:first-child,
    .earnings-table td:first-child {
      text-align: left;
    }

    .earnings-table th {
      background: var(--primary-dark);
      color: white;
    }

    .earnings-table tr:nth-child(even) {
      background: rgba(16, 163, 127, 0.1);
    }

    .earnings-table tr:hover {
      background: rgba(16, 163, 127, 0.2);
    }

    .earnings-total {
      font-weight: 700;
      background: var(--primary-dark) !important;
      color: white;
    }

    .earnings-total td {
      border-top: 2px solid var(--primary-color);
    }

    /* Add this to your existing CSS */
    .asset-item video {
      width: 100%;
      height: auto;
      display: block;
      object-fit: cover;
      aspect-ratio: 1/1;
      background-color: var(--accent-dark);
    }

    /* For better hover effects on videos */
    .asset-item:hover video {
      transform: scale(1.05);
      transition: transform var(--transition-fast);
    }

    /* Make sure videos don't overflow their containers */
    .asset-item {
      /* ... existing code ... */
      overflow: hidden;
      position: relative;
    }

    /* Add a subtle overlay to make text more readable over videos */
    .asset-item.video-asset::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to bottom, transparent 70%, rgba(0, 0, 0, 0.7) 100%);
      pointer-events: none;
    }

    /* Add a small video indicator */
    .asset-item.video-asset::before {
      content: '▶';
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      font-size: 10px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
    }

    /* Ensure videos in modals display properly */
    .modal .asset-item video {
      max-height: 200px;
    }

    .modal .asset-item .img-asset-bg {
      max-height: 200px;
    }


    /* Add loading state for videos */
    .asset-item video.loading {
      min-height: 100px;
      background: var(--accent-dark) url('https://pixeljourney.xyz/img/loading.gif') center no-repeat;
      background-size: 32px;
    }
  </style>
</head>

<body>
  <header>
    <div class="container d-flex justify-content-between align-items-center">
      <h1>Pixel Journey Staking Dashboard</h1>
      <div class="d-flex">
        <a href="index.html" class="btn btn-secondary me-2">Home</a>
        <button class="dark-mode-toggle" id="darkModeToggle">Toggle Theme</button>
      </div>
    </div>
  </header>

  <div class="container">
    <!-- Connection Status -->
    <div class="card mb-4" id="connectionCard">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <h3>Connect to WAX</h3>
          <button class="btn" id="loginButton">Connect Wallet</button>
        </div>
        <div id="accountInfo" class="mt-3" style="display: none;">
          <p>Connected as: <span id="accountName" class="fw-bold"></span></p>
        </div>
      </div>
    </div>

    <!-- Total Staking Power -->
    <div class="total-power" id="totalPowerCard" style="display: none;">
      <h3>Your Total Staking Power</h3>
      <div class="power-value-container">
        <div class="power-value" id="totalPowerValue">0</div>
        <div class="power-rate"> /hour</div>
      </div>
      <div class="d-flex justify-content-center gap-3">
        <div><span id="totalPxjValue">0</span> PXJ</div>
        <div><span id="totalWufValue">0</span> WUF</div>
      </div>
    </div>

    <!-- Rewards Section -->
    <div class="rewards-section">
      <h3>Claimable Rewards</h3>
      <div id="claimableRewards">Loading rewards...</div>
      <button class="claim-btn" id="claimButton">Claim Rewards</button>
    </div>

    <!-- Earnings Breakdown Modal -->
    <div class="modal fade" id="earningsModal" tabindex="-1" aria-labelledby="earningsModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="earningsModalLabel">Earnings Breakdown</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <table class="earnings-table">
              <thead>
                <tr>
                  <th>Time Period</th>
                  <th>PXJ</th>
                  <th>WUF</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Per Second</td>
                  <td id="pxjPerSecond">0</td>
                  <td id="wufPerSecond">0</td>
                </tr>
                <tr>
                  <td>Per Minute</td>
                  <td id="pxjPerMinute">0</td>
                  <td id="wufPerMinute">0</td>
                </tr>
                <tr>
                  <td>Per Hour</td>
                  <td id="pxjPerHour">0</td>
                  <td id="wufPerHour">0</td>
                </tr>
                <tr>
                  <td>Per Day</td>
                  <td id="pxjPerDay">0</td>
                  <td id="wufPerDay">0</td>
                </tr>
                <tr>
                  <td>Per Week</td>
                  <td id="pxjPerWeek">0</td>
                  <td id="wufPerWeek">0</td>
                </tr>
                <tr>
                  <td>Per Month (30 days)</td>
                  <td id="pxjPerMonth">0</td>
                  <td id="wufPerMonth">0</td>
                </tr>
                <tr>
                  <td>Per Year</td>
                  <td id="pxjPerYear">0</td>
                  <td id="wufPerYear">0</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar" id="statsBar" style="display: none;">
      <div class="stat">
        <div>
          <div class="fw-bold">Total Assets</div>
          <div id="totalAssets">0</div>
        </div>
      </div>
      <div class="stat">
        <div>
          <div class="fw-bold">Staked Assets</div>
          <div id="stakedAssets">0</div>
        </div>
      </div>
      <div class="stat">
        <div>
          <div class="fw-bold">Unstaked Assets</div>
          <div id="unstakedAssets">0</div>
        </div>
      </div>
      <div class="stat">
        <div>
          <div class="fw-bold">Template Types</div>
          <div id="templateTypes">0</div>
        </div>
      </div>
    </div>

    <!-- Template Grid -->
    <div class="card" id="templateCard" style="display: none;">
      <div class="card-body">
        <h3 class="mb-4">Stakable Templates</h3>
        <div class="template-grid" id="templateGrid">
          <!-- Template cards will be generated here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Asset Selection Modal -->
  <div class="modal fade" id="assetModal" tabindex="-1" aria-labelledby="assetModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="assetModalLabel">Select Assets to Stake</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="selection-controls">
            <div>
              <button class="btn btn-sm btn-secondary" id="selectAllBtn">Select All</button>
              <button class="btn btn-sm btn-secondary ms-2" id="deselectAllBtn">Deselect All</button>
            </div>
            <div>
              <span id="selectedCount">0</span> assets selected
            </div>
          </div>
          <div class="asset-grid" id="assetGrid">
            <!-- Asset items will be generated here -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn" id="confirmStakeBtn">Stake Selected</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Unstake Modal -->
  <div class="modal fade" id="unstakeModal" tabindex="-1" aria-labelledby="unstakeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="unstakeModalLabel">Select Assets to Unstake</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="selection-controls">
            <div>
              <button class="btn btn-sm btn-secondary" id="selectAllUnstakeBtn">Select All</button>
              <button class="btn btn-sm btn-secondary ms-2" id="deselectAllUnstakeBtn">Deselect All</button>
            </div>
            <div>
              <span id="selectedUnstakeCount">0</span> assets selected
            </div>
          </div>
          <div class="asset-grid" id="stakedAssetGrid">
            <!-- Staked asset items will be generated here -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn" id="confirmUnstakeBtn">Unstake Selected</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://notify.waxsweden.org/static/assets/waxjs.js"></script>
  <script>
    // Template data
    const templates = [
      { id: 781515, pxj: 0.25, wuf: 5.0, pxjUpgrade: 0, name: "Pixal PFP", type: "pixals" },
      { id: 820134, pxj: 2.5, wuf: 20.0, pxjUpgrade: 0, name: "Pixel Ingredient Pack", type: "pixelpack" },
      { id: 858568, pxj: 124.0, wuf: 100.0, pxjUpgrade: 0, name: "Black (Primary)", type: "primary" },
      { id: 858569, pxj: 0.2, wuf: 2.0, pxjUpgrade: 0, name: "Blue (Primary)", type: "primary" },
      { id: 858570, pxj: 0.2, wuf: 2.0, pxjUpgrade: 0, name: "Red (Primary)", type: "primary" },
      { id: 858571, pxj: 0.2, wuf: 2.0, pxjUpgrade: 0, name: "Yellow (Primary)", type: "primary" },
      { id: 858572, pxj: 2.5, wuf: 9.0, pxjUpgrade: 25000, name: "Green (Secondary)", type: "secondary" },
      { id: 858573, pxj: 2.5, wuf: 9.0, pxjUpgrade: 25000, name: "Orange (Secondary)", type: "secondary" },
      { id: 858574, pxj: 2.5, wuf: 9.0, pxjUpgrade: 25000, name: "Purple (Secondary)", type: "secondary" },
      { id: 858575, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Amber (Tertiary)", type: "tertiary" },
      { id: 858576, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Chartreuse (Tertiary)", type: "tertiary" },
      { id: 858577, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Violet (Tertiary)", type: "tertiary" },
      { id: 858578, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Teal (Tertiary)", type: "tertiary" },
      { id: 858580, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Vermillion (Tertiary)", type: "tertiary" },
      { id: 859273, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Magenta (Tertiary)", type: "tertiary" }
    ];

    document.addEventListener('DOMContentLoaded', function () {
      // Initialize variables
      const wax = new waxjs.WaxJS({ rpcEndpoint: 'https://wax.greymass.com' });
      let userAccount = null;
      let stakedAssets = [];
      let userAssets = [];
      let selectedAssets = [];
      let selectedUnstakeAssets = [];

      // DOM elements
      const loginButton = document.getElementById('loginButton');
      const accountName = document.getElementById('accountName');
      const accountInfo = document.getElementById('accountInfo');
      const templateGrid = document.getElementById('templateGrid');
      const assetGrid = document.getElementById('assetGrid');
      const stakedAssetGrid = document.getElementById('stakedAssetGrid');
      const selectAllBtn = document.getElementById('selectAllBtn');
      const deselectAllBtn = document.getElementById('deselectAllBtn');
      const selectAllUnstakeBtn = document.getElementById('selectAllUnstakeBtn');
      const deselectAllUnstakeBtn = document.getElementById('deselectAllUnstakeBtn');
      const confirmStakeBtn = document.getElementById('confirmStakeBtn');
      const confirmUnstakeBtn = document.getElementById('confirmUnstakeBtn');
      const selectedCount = document.getElementById('selectedCount');
      const selectedUnstakeCount = document.getElementById('selectedUnstakeCount');
      const totalPowerCard = document.getElementById('totalPowerCard');
      const totalPowerValue = document.getElementById('totalPowerValue');
      const totalPxjValue = document.getElementById('totalPxjValue');
      const totalWufValue = document.getElementById('totalWufValue');
      const statsBar = document.getElementById('statsBar');
      const totalAssetsEl = document.getElementById('totalAssets');
      const stakedAssetsEl = document.getElementById('stakedAssets');
      const unstakedAssetsEl = document.getElementById('unstakedAssets');
      const templateTypesEl = document.getElementById('templateTypes');
      const templateCard = document.getElementById('templateCard');
      const darkModeToggle = document.getElementById('darkModeToggle');

      // Bootstrap modals
      const assetModal = new bootstrap.Modal(document.getElementById('assetModal'));
      const unstakeModal = new bootstrap.Modal(document.getElementById('unstakeModal'));

      // Event listeners
      loginButton.addEventListener('click', login);
      selectAllBtn.addEventListener('click', selectAllAssets);
      deselectAllBtn.addEventListener('click', deselectAllAssets);
      selectAllUnstakeBtn.addEventListener('click', selectAllStakedAssets);
      deselectAllUnstakeBtn.addEventListener('click', deselectAllStakedAssets);
      confirmStakeBtn.addEventListener('click', () => stakeAssets(selectedAssets));
      confirmUnstakeBtn.addEventListener('click', () => unstakeAssets(selectedUnstakeAssets));
      darkModeToggle.addEventListener('click', toggleDarkMode);
      
    document.getElementById('claimButton').addEventListener('click', claimRewards);

      // Check if user is already logged in
      checkAutoLogin();

      // Dark mode toggle
      function toggleDarkMode() {
        document.body.classList.toggle('light-mode');
        document.querySelectorAll('.card, .stats-bar, header, .modal-content').forEach(el => {
          el.classList.toggle('light-mode');
        });
      }

      // Set up the earnings info button
      const totalPowerCardBtn = document.getElementById('totalPowerCard');
      const earningsModal = new bootstrap.Modal(document.getElementById('earningsModal'));

      if (totalPowerCardBtn) {
        totalPowerCardBtn.addEventListener('click', function () {
          updateEarningsBreakdown(); // Ensure values are up to date
          earningsModal.show();
        });
      }

      // Login function
      async function login() {
        try {
          userAccount = await wax.login();
          accountName.textContent = userAccount;
          accountInfo.style.display = 'block';
          loginButton.textContent = 'Connected';
          loginButton.disabled = true;

          // Show UI elements
          totalPowerCard.style.display = 'block';
          statsBar.style.display = 'flex';
          templateCard.style.display = 'block';
          document.querySelector('.rewards-section').style.display = 'block'; // Show rewards section

          // Load data
          await fetchStakedAssets();
          await loadUserAssets();
          updateTemplateGrid();
          updateStats();
          fetchClaimableRewards();
        } catch (error) {
          console.error('Login error:', error);
          showErrorMessage('Failed to login. Please try again.');
        }
      }

      // Check if user is already logged in
      async function checkAutoLogin() {
        try {
          const isAutoLoginAvailable = await wax.isAutoLoginAvailable();
          if (isAutoLoginAvailable) {
            userAccount = wax.userAccount;
            accountName.textContent = userAccount;
            accountInfo.style.display = 'block';
            loginButton.textContent = 'Connected';
            loginButton.disabled = true;

            // Show UI elements
            totalPowerCard.style.display = 'block';
            statsBar.style.display = 'flex';
            templateCard.style.display = 'block';

            // Load data
            await fetchStakedAssets();
            await loadUserAssets();
            updateTemplateGrid();
            updateStats();
          }
        } catch (error) {
          console.error('Auto login error:', error);
        }
      }

      async function fetchClaimableRewards() {
        const rewardsDiv = document.getElementById('claimableRewards');
        if (!userAccount) {
          rewardsDiv.innerHTML = 'Please log in to see rewards.';
          return;
        }
        rewardsDiv.innerHTML = 'Loading rewards...';
        rewardsDiv.innerHTML = 'PXJ: ??? | WUF: ???';
      }

      async function claimRewards() {
        if (!userAccount) return alert('Please log in first.');
        try {
          const result = await wax.api.transact({
            actions: [{
              account: 'farms.waxdao',
              name: 'claim',
              authorization: [{ actor: userAccount, permission: 'active' }],
              data: {
                user: userAccount,
                farmname: 'pixeljourney'
              }
            }]
          }, {
            blocksBehind: 3,
            expireSeconds: 30
          });

          console.log('Claim result:', result);
          alert('Rewards claimed successfully!');

          // Update the claimable rewards to 0
          const rewardsDiv = document.getElementById('claimableRewards');
          rewardsDiv.innerHTML = 'PXJ: 0.0 | WUF: 0.0';

        } catch (error) {
          console.error('Claim error:', error);
          alert('Failed to claim rewards. Please try again.');
        }
      }

      // Fetch staked assets
      async function fetchStakedAssets() {
        if (!userAccount) return;

        try {
          stakedAssets = [];
          let lower_bound = '';
          let more = true;

          while (more) {
            const result = await wax.api.rpc.get_table_rows({
              code: 'farms.waxdao',
              scope: 'farms.waxdao',
              table: 'stakednfts',
              limit: 1000,
              lower_bound,
              json: true
            });

            for (const row of result.rows) {
              if (row.owner === userAccount && row.farmname === 'pixeljourney') {
                stakedAssets.push(row);
              }
            }

            more = result.more;
            if (more) lower_bound = result.next_key;
          }

          console.log('Staked assets:', stakedAssets);
        } catch (error) {
          console.error('Error fetching staked assets:', error);
          showErrorMessage('Failed to fetch staked assets.');
        }
      }

      // Load user assets
      async function loadUserAssets() {
        if (!userAccount) return;

        try {
          userAssets = [];
          let page = 1;

          while (true) {
            const response = await fetch(`https://wax.api.atomicassets.io/atomicassets/v1/assets?owner=${userAccount}&collection_name=pixeljourney&limit=1000&page=${page}`);
            const data = await response.json();
            const pageAssets = data.data;

            if (!pageAssets.length) break;

            userAssets = userAssets.concat(pageAssets);
            page++;
          }

          console.log('User assets:', userAssets);
        } catch (error) {
          console.error('Error loading user assets:', error);
          showErrorMessage('Failed to load your assets.');
        }
      }

      // Replace your updateTemplateGrid function with this enhanced version
      function updateTemplateGrid() {
        if (!userAccount || !templateGrid) return;

        templateGrid.innerHTML = '';

        // Template video mappings
        const templateVideos = {
          '858575': 'https://resizer.atomichub.io/videos/v1/preview?ipfs=QmTrBnHMF122ToGcYuozwzB6qoSsH23pbt8CvUFvJNZDW8&size=370&output=mp4', // amber
          '858576': 'https://resizer.atomichub.io/videos/v1/preview?ipfs=QmbMWRZzMxm554owRqrTszw7psUqzUGutwngcVV4n5w9Rj&size=370&output=mp4', // chartreuse
          '858577': 'https://resizer.atomichub.io/videos/v1/preview?ipfs=QmPvVD9CXxaHNEbzpfekMFaUF8c4KQXZcS4TKw7h3Hj5VE&size=370&output=mp4', // violet
          '858578': 'https://resizer.atomichub.io/videos/v1/preview?ipfs=QmZx2LLiwcyezor4c1DAc5nq8imJqKJdg77X7dVi1NdFqr&size=370&output=mp4', // teal
          '858580': 'https://resizer.atomichub.io/videos/v1/preview?ipfs=QmUp6c8X2HrKyZbK48orBb8JeWGQ6ynvMyJikMU7cfJHfq&size=370&output=mp4', // vermillion
          '859273': 'https://resizer.atomichub.io/videos/v1/preview?ipfs=QmagHqsoXsuQQ98Y41SqpV2yFkU6tyV3TbxDcDXfkAF4Yn&size=370&output=mp4', // magenta
          '858574': 'https://resizer.atomichub.io/videos/v1/preview?ipfs=QmS6HMsE2kdqGj1H21eRNmiDvCnBS4vKmTvXWruyDNsGqw&size=370&output=mp4', // purple
          '858573': 'https://resizer.atomichub.io/videos/v1/preview?ipfs=QmSXdwLhwBP1GvxU4hvrGD7Q6A7sHqsseKxE7bVMdWS2mg&size=370&output=mp4', // orange
          '858572': 'https://resizer.atomichub.io/videos/v1/preview?ipfs=QmbhyuUvJJfCxxbnTvUDTZwexJdxzZdnvpgLFrJfEtVAUN&size=370&output=mp4', // green
          '858570': 'https://resizer.atomichub.io/videos/v1/preview?ipfs=QmTueG1XrkiA9qUFsaB4WxJWp1WYJZZgcQHHoqi84cDDw3&size=370&output=mp4', // yellow
          '858569': 'https://resizer.atomichub.io/videos/v1/preview?ipfs=QmbBTshwtDtE1A1Z59sn6gx3g35rb51ZY5qAzQavAHqhWW&size=370&output=mp4', // red
          '858571': 'https://resizer.atomichub.io/videos/v1/preview?ipfs=Qmb7f5RHUYYhFu559RrMWFdb2SnNVvdAiYq64dZ34kMRxN&size=370&output=mp4', // blue
          '858568': 'https://resizer.atomichub.io/videos/v1/preview?ipfs=QmaNsmDMvSqDnbYNbC6fev7MiHW2xdgbVt3bBBKWY3XC3N&size=370&output=mp4',  // black
        };

        // Group assets by template
        const templateAssets = {};
        const stakedTemplateAssets = {};

        // Count unstaked assets by template
        userAssets.forEach(asset => {
          const templateId = asset.template?.template_id;
          if (templateId) {
            if (!templateAssets[templateId]) {
              templateAssets[templateId] = [];
            }

            // Check if this asset is staked
            const isStaked = stakedAssets.some(stakedAsset =>
              stakedAsset.asset_id === asset.asset_id
            );

            if (!isStaked) {
              templateAssets[templateId].push(asset);
            }
          }
        });

        // Count staked assets by template
        stakedAssets.forEach(stakedAsset => {
          // Find the asset in user assets to get template info
          const asset = userAssets.find(a => a.asset_id === stakedAsset.asset_id);
          if (asset && asset.template) {
            const templateId = asset.template.template_id;
            if (!stakedTemplateAssets[templateId]) {
              stakedTemplateAssets[templateId] = [];
            }
            stakedTemplateAssets[templateId].push(asset);
          }
        });

        // Create template cards
        templates.forEach(template => {
          const unstakedCount = (templateAssets[template.id] || []).length;
          const stakedCount = (stakedTemplateAssets[template.id] || []).length;
          const totalCount = unstakedCount + stakedCount;

          if (totalCount > 0) {
            const card = document.createElement('div');
            card.className = 'template-card';

            // Check if we have a video for this template
            const videoUrl = templateVideos[template.id];
            let templateImageHtml = '';

            if (videoUrl) {
              templateImageHtml = `
                    <div class="template-image video-bg">
                        <video autoplay loop muted playsinline>
                            <source src="${videoUrl}" type="video/mp4">
                        </video>
                    </div>
                `;
            } else {
              // Get image URL from the first asset of this template
              let imageUrl = '';
              const firstAsset = userAssets.find(asset =>
                asset.template && asset.template.template_id === template.id
              );

              // Special handling for specific template IDs
              if (template.id === 820134) {
                // Pixelpacks template
                imageUrl = 'https://resizer.atomichub.io/images/v1/preview?ipfs=QmcYTuSWQwnkaEuhvzkEZ9ugxjLaVPuY3Z9mbFPwVF3hED&size=370&output=webp';
              } else if (template.id === 781515) {
                // PixalPFPs template
                imageUrl = 'https://ipfs.pfpwizard.xyz/ipfs/QmTCGSmGKGozYU4KjnyhzNsJDaMqDjnTq5FrCsagG67rpj';
              } else
                if (firstAsset && firstAsset.data && firstAsset.data.img) {
                  imageUrl = `https://ipfs.io/ipfs/${firstAsset.data.img}`;
                }

              templateImageHtml = `
                    <div class="template-image img-asset-bg" style="background-image: url(${imageUrl})">
                    </div>
                `;
            }

            card.innerHTML = `
                ${templateImageHtml}
                <div class="asset-count">${totalCount} owned</div>
                <div class="staked-count">${stakedCount} staked</div>
                <div class="template-info">
                    <div class="template-name">${template.name}</div>
                    <div class="template-type">${template.type}</div>
                    <div class="template-stats">
                        <div>
                            <div class="stat-value">${template.pxj}</div>
                            <div class="stat-label">PXJ</div>
                        </div>
                        <div>
                            <div class="stat-value">${template.wuf}</div>
                            <div class="stat-label">WUF</div>
                        </div>
                    </div>
                    <div class="template-actions">
                        ${unstakedCount > 0 ? `<button class="btn" onclick="openStakeModal(${template.id})">Stake (${unstakedCount})</button>` : ''}
                        ${stakedCount > 0 ? `<button class="btn btn-secondary" onclick="openUnstakeModal(${template.id})">Unstake (${stakedCount})</button>` : ''}
                    </div>
                </div>
            `;

            templateGrid.appendChild(card);
          }
        });
      }

      // Update stats
      function updateStats() {
        if (!userAccount) return;

        const totalAssets = userAssets.length;
        const totalStaked = stakedAssets.length;
        const totalUnstaked = totalAssets - totalStaked;

        // Count unique template types
        const uniqueTypes = new Set();
        userAssets.forEach(asset => {
          if (asset.template) {
            const templateId = asset.template.template_id;
            const template = templates.find(t => t.id === parseInt(templateId));
            if (template) {
              uniqueTypes.add(template.type);
            }
          }
        });

        // Calculate total staking power
        let totalPxj = 0;
        let totalWuf = 0;

        stakedAssets.forEach(stakedAsset => {
          const asset = userAssets.find(a => a.asset_id === stakedAsset.asset_id);
          if (asset && asset.template) {
            const templateId = parseInt(asset.template.template_id);
            const template = templates.find(t => t.id === templateId);
            if (template) {
              totalPxj += template.pxj;
              totalWuf += template.wuf;
            }
          }
        });
        updateEarningsBreakdown();

        // Update UI
        totalAssetsEl.textContent = totalAssets;
        stakedAssetsEl.textContent = totalStaked;
        unstakedAssetsEl.textContent = totalUnstaked;
        templateTypesEl.textContent = uniqueTypes.size;

        totalPowerValue.textContent = totalPxj.toFixed(2);
        totalPxjValue.textContent = totalPxj.toFixed(2);
        totalWufValue.textContent = totalWuf.toFixed(2);
      }

      // Open stake modal
      window.openStakeModal = function (templateId) {
        if (!userAccount) return;

        // Reset selection
        selectedAssets = [];
        assetGrid.innerHTML = '';
        selectedCount.textContent = '0';

        // Show modal first
        assetModal.show();

        // Show loading indicator
        showModalLoading('assetModal');

        // Use setTimeout to allow the modal to render before loading assets
        setTimeout(() => {
          // Filter assets by template
          const templateAssets = userAssets.filter(asset =>
            asset.template &&
            parseInt(asset.template.template_id) === templateId &&
            !stakedAssets.some(stakedAsset => stakedAsset.asset_id === asset.asset_id)
          );

          // Create asset items
          templateAssets.forEach(asset => {
            const div = document.createElement('div');
            div.className = 'asset-item';
            div.dataset.assetId = asset.asset_id;

            let imageUrl = '';
            if (asset.data && asset.data.img) {
              imageUrl = `https://ipfs.io/ipfs/${asset.data.img}`;
              div.innerHTML = `
                <img src="${imageUrl || 'https://pixeljourney.xyz/img/logo.png'}" alt="${asset.name || 'Asset'}">
                <div class="asset-id">${asset.asset_id}</div>
            `;
            } else if (asset.data && asset.data.video) {
              imageUrl = `https://ipfs.io/ipfs/${asset.data.video}`;
              div.innerHTML = `
              <video src="https://ipfs.io/ipfs/${asset.data.video}" autoplay loop muted playsinline class="asset-video"></video>
              <div class="asset-id">${asset.asset_id}</div>
            `;
            } else {
              imageUrl = `https://ipfs.io/ipfs/${asset.data.img}`;
              console.log("No image or video found for asset:", asset);
            }



            div.addEventListener('click', () => {
              div.classList.toggle('selected');

              if (div.classList.contains('selected')) {
                selectedAssets.push(asset.asset_id);
              } else {
                selectedAssets = selectedAssets.filter(id => id !== asset.asset_id);
              }

              selectedCount.textContent = selectedAssets.length;
            });

            assetGrid.appendChild(div);
          });

          // Hide loading indicator
          hideModalLoading('assetModal');
        }, 300);
      };

      // Open unstake modal
      window.openUnstakeModal = function (templateId) {
        if (!userAccount) return;

        // Reset selection
        selectedUnstakeAssets = [];
        stakedAssetGrid.innerHTML = '';
        selectedUnstakeCount.textContent = '0';

        // Show modal first
        unstakeModal.show();

        // Show loading indicator
        showModalLoading('unstakeModal');

        // Use setTimeout to allow the modal to render before loading assets
        setTimeout(() => {
          // Filter staked assets by template
          const templateStakedAssets = stakedAssets.filter(stakedAsset => {
            const asset = userAssets.find(a => a.asset_id === stakedAsset.asset_id);
            return asset &&
              asset.template &&
              parseInt(asset.template.template_id) === templateId;
          });

          // Create asset items
          templateStakedAssets.forEach(stakedAsset => {
            const asset = userAssets.find(a => a.asset_id === stakedAsset.asset_id);
            if (!asset) return;

            const div = document.createElement('div');
            div.className = 'asset-item';
            div.dataset.assetId = stakedAsset.asset_id;

            let mediaElement = '';
            if (asset.data && asset.data.video) {
              mediaElement = `<video src="https://ipfs.io/ipfs/${asset.data.video}" autoplay loop muted playsinline class="asset-video"></video>`;
            } else if (asset.data && asset.data.img) {
              mediaElement = `<img src="https://ipfs.io/ipfs/${asset.data.img}" alt="${asset.name || 'Asset'}">`;
            } else {
              mediaElement = `<img src="https://pixeljourney.xyz/img/logo.png" alt="${asset.name || 'Asset'}">`;
            }

            div.innerHTML = `
                ${mediaElement}
                <div class="asset-id">${stakedAsset.asset_id}</div>
            `;

            div.addEventListener('click', () => {
              div.classList.toggle('selected');

              if (div.classList.contains('selected')) {
                selectedUnstakeAssets.push(stakedAsset.asset_id);
              } else {
                selectedUnstakeAssets = selectedUnstakeAssets.filter(id => id !== stakedAsset.asset_id);
              }

              selectedUnstakeCount.textContent = selectedUnstakeAssets.length;
            });

            stakedAssetGrid.appendChild(div);
          });

          // Hide loading indicator
          hideModalLoading('unstakeModal');
        }, 300);
      };

      async function stakeAssets(assetIds) {
        if (!wax.api || !userAccount || assetIds.length === 0) return;

        try {
          // Hide modal first
          assetModal.hide();

          // Show global loading
          showGlobalLoading('Staking assets...');

          const result = await wax.api.transact({
            actions: [{
              account: 'farms.waxdao',
              name: 'stakenfts',
              authorization: [{
                actor: userAccount,
                permission: 'active',
              }],
              data: {
                user: userAccount,
                farmname: 'pixeljourney',
                assets_to_stake: assetIds
              },
            }]
          }, {
            blocksBehind: 3,
            expireSeconds: 90,
          });

          console.log('Stake success:', result);

          // Update local data without refetching everything
          assetIds.forEach(assetId => {
            // Add to staked assets
            stakedAssets.push({
              owner: userAccount,
              farmname: 'pixeljourney',
              asset_id: assetId
            });
          });

          // Update UI
          updateTemplateGrid();
          updateStats();

          // Hide loading and show success
          hideGlobalLoading();
          showSuccessMessage('Assets staked successfully!');
        } catch (error) {
          console.error('Stake failed:', error);
          hideGlobalLoading();
          showErrorMessage(`Stake failed: ${error.message}`);
        }
      }

      // Replace your unstakeAssets function with this enhanced version
      async function unstakeAssets(assetIds) {
        if (!wax.api || !userAccount || assetIds.length === 0) return;

        try {
          // Hide modal first
          unstakeModal.hide();

          // Show global loading
          showGlobalLoading('Unstaking assets...');

          const result = await wax.api.transact({
            actions: [{
              account: 'farms.waxdao',
              name: 'unstake',
              authorization: [{
                actor: userAccount,
                permission: 'active',
              }],
              data: {
                user: userAccount,
                farmname: 'pixeljourney',
                assets_to_unstake: assetIds
              },
            }]
          }, {
            blocksBehind: 3,
            expireSeconds: 90,
          });

          console.log('Unstake success:', result);

          // Update local data without refetching everything
          //stakedAssets = stakedAssets.filter(asset => !assetIds.includes(asset.asset_id));

          // Update UI
          updateTemplateGrid();
          updateStats();

          // Hide loading and show success
          hideGlobalLoading();
          showSuccessMessage('Assets unstaked successfully!');
        } catch (error) {
          console.error('Unstake failed:', error);
          hideGlobalLoading();
          showErrorMessage(`Unstake failed: ${error.message}`);
        }
      }

      // Select all assets
      function selectAllAssets() {
        const assetItems = assetGrid.querySelectorAll('.asset-item');
        selectedAssets = [];

        assetItems.forEach(item => {
          item.classList.add('selected');
          selectedAssets.push(item.dataset.assetId);
        });

        selectedCount.textContent = selectedAssets.length;
      }

      // Deselect all assets
      function deselectAllAssets() {
        const assetItems = assetGrid.querySelectorAll('.asset-item');

        assetItems.forEach(item => {
          item.classList.remove('selected');
        });

        selectedAssets = [];
        selectedCount.textContent = '0';
      }

      // Select all staked assets
      function selectAllStakedAssets() {
        const assetItems = stakedAssetGrid.querySelectorAll('.asset-item');
        selectedUnstakeAssets = [];

        assetItems.forEach(item => {
          item.classList.add('selected');
          selectedUnstakeAssets.push(item.dataset.assetId);
        });

        selectedUnstakeCount.textContent = selectedUnstakeAssets.length;
      }

      // Deselect all staked assets
      function deselectAllStakedAssets() {
        const assetItems = stakedAssetGrid.querySelectorAll('.asset-item');

        assetItems.forEach(item => {
          item.classList.remove('selected');
        });

        selectedUnstakeAssets = [];
        selectedUnstakeCount.textContent = '0';
      }

      // Show processing message
      function showProcessingMessage(message) {
        const processingDiv = document.createElement('div');
        processingDiv.id = 'processingMessage';
        processingDiv.style.position = 'fixed';
        processingDiv.style.top = '50%';
        processingDiv.style.left = '50%';
        processingDiv.style.transform = 'translate(-50%, -50%)';
        processingDiv.style.background = 'rgba(0, 0, 0, 0.8)';
        processingDiv.style.color = 'white';
        processingDiv.style.padding = '20px';
        processingDiv.style.borderRadius = '10px';
        processingDiv.style.zIndex = '9999';
        processingDiv.innerHTML = `
            <div class="loading-spinner"></div>
            <span>${message}</span>
        `;

        document.body.appendChild(processingDiv);
      }

      // Hide processing message
      function hideProcessingMessage() {
        const processingDiv = document.getElementById('processingMessage');
        if (processingDiv) {
          processingDiv.remove();
        }
      }

      // Show success message
      function showSuccessMessage(message) {
        const successDiv = document.createElement('div');
        successDiv.style.position = 'fixed';
        successDiv.style.top = '20px';
        successDiv.style.right = '20px';
        successDiv.style.background = 'rgba(16, 163, 127, 0.9)';
        successDiv.style.color = 'white';
        successDiv.style.padding = '15px 20px';
        successDiv.style.borderRadius = '5px';
        successDiv.style.zIndex = '9999';
        successDiv.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
        successDiv.textContent = message;

        document.body.appendChild(successDiv);

        setTimeout(() => {
          successDiv.style.opacity = '0';
          successDiv.style.transition = 'opacity 0.5s ease';
          setTimeout(() => {
            successDiv.remove();
          }, 500);
        }, 3000);
      }

      // Show error message
      function showErrorMessage(message) {
        const errorDiv = document.createElement('div');
        errorDiv.style.position = 'fixed';
        errorDiv.style.top = '20px';
        errorDiv.style.right = '20px';
        errorDiv.style.background = 'rgba(220, 53, 69, 0.9)';
        errorDiv.style.color = 'white';
        errorDiv.style.padding = '15px 20px';
        errorDiv.style.borderRadius = '5px';
        errorDiv.style.zIndex = '9999';
        errorDiv.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
        errorDiv.textContent = message;

        document.body.appendChild(errorDiv);

        setTimeout(() => {
          errorDiv.style.opacity = '0';
          errorDiv.style.transition = 'opacity 0.5s ease';
          setTimeout(() => {
            errorDiv.remove();
          }, 500);
        }, 5000);
      }
    });

    // Show loading indicator in modal
    function showModalLoading(modalId) {
      const modalBody = document.querySelector(`#${modalId} .modal-body`);
      if (!modalBody) return;

      // Create loading overlay
      const loadingOverlay = document.createElement('div');
      loadingOverlay.className = 'loading-overlay';
      loadingOverlay.innerHTML = `
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading assets...</div>
    `;

      modalBody.appendChild(loadingOverlay);
    }

    // Hide loading indicator in modal
    function hideModalLoading(modalId) {
      const loadingOverlay = document.querySelector(`#${modalId} .loading-overlay`);
      if (loadingOverlay) {
        loadingOverlay.remove();
      }
    }

    // Show global loading indicator
    function showGlobalLoading(message = 'Processing...') {
      // Remove any existing loading overlay
      hideGlobalLoading();

      // Create loading overlay
      const loadingOverlay = document.createElement('div');
      loadingOverlay.id = 'globalLoadingOverlay';
      loadingOverlay.className = 'global-loading-overlay';
      loadingOverlay.innerHTML = `
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">${message}</div>
        </div>
    `;

      document.body.appendChild(loadingOverlay);
    }

    // Hide global loading indicator
    function hideGlobalLoading() {
      const loadingOverlay = document.getElementById('globalLoadingOverlay');
      if (loadingOverlay) {
        loadingOverlay.remove();
      }
    }

    function updateEarningsBreakdown() {
      // Get the hourly values
      const pxjPerHour = parseFloat(document.getElementById('totalPxjValue').textContent);
      const wufPerHour = parseFloat(document.getElementById('totalWufValue').textContent);

      // Calculate other time periods
      const pxjPerSecond = (pxjPerHour / 3600).toFixed(6);
      const wufPerSecond = (wufPerHour / 3600).toFixed(6);

      const pxjPerMinute = (pxjPerHour / 60).toFixed(4);
      const wufPerMinute = (wufPerHour / 60).toFixed(4);

      const pxjPerDay = (pxjPerHour * 24).toFixed(2);
      const wufPerDay = (wufPerHour * 24).toFixed(2);

      const pxjPerWeek = (pxjPerHour * 24 * 7).toFixed(2);
      const wufPerWeek = (wufPerHour * 24 * 7).toFixed(2);

      const pxjPerMonth = (pxjPerHour * 24 * 30).toFixed(2);
      const wufPerMonth = (wufPerHour * 24 * 30).toFixed(2);

      const pxjPerYear = (pxjPerHour * 24 * 365).toFixed(2);
      const wufPerYear = (wufPerHour * 24 * 365).toFixed(2);

      // Update the table values
      document.getElementById('pxjPerSecond').textContent = pxjPerSecond;
      document.getElementById('wufPerSecond').textContent = wufPerSecond;

      document.getElementById('pxjPerMinute').textContent = pxjPerMinute;
      document.getElementById('wufPerMinute').textContent = wufPerMinute;

      document.getElementById('pxjPerHour').textContent = pxjPerHour.toFixed(2);
      document.getElementById('wufPerHour').textContent = wufPerHour.toFixed(2);

      document.getElementById('pxjPerDay').textContent = pxjPerDay;
      document.getElementById('wufPerDay').textContent = wufPerDay;

      document.getElementById('pxjPerWeek').textContent = pxjPerWeek;
      document.getElementById('wufPerWeek').textContent = wufPerWeek;

      document.getElementById('pxjPerMonth').textContent = pxjPerMonth;
      document.getElementById('wufPerMonth').textContent = wufPerMonth;

      document.getElementById('pxjPerYear').textContent = pxjPerYear;
      document.getElementById('wufPerYear').textContent = wufPerYear;
    }


  </script>
</body>

</html>