<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pixel Journey || NFT Staking Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
  <link rel="icon" type="image/x-icon" href="https://pixeljourney.xyz/img/logo.png">
  <style>
    :root {
      /* Modern color palette */
      --primary-color: #10a37f;
      --primary-dark: #0d8c6e;
      --primary-light: #1cbe94;
      --bg-dark: #1a1b1e;
      --bg-light: #ffffff;
      --card-dark: #27292d;
      --card-light: #f5f7fa;
      --text-dark: #e4e6eb;
      --text-light: #1f2937;
      --accent-dark: #2d2f31;
      --accent-light: #f2f3f5;
      --border-dark: #3a3d40;
      --border-light: #e5e7eb;
      --hover-dark: #2f3134;
      --hover-light: #eaeaea;
      --shadow-dark: 0 4px 12px rgba(0, 0, 0, 0.3);
      --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.1);
      --gradient-primary: linear-gradient(135deg, #10a37f, #14b885);
      --gradient-secondary: linear-gradient(135deg, #2d2f31, #3a3d40);
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --transition-fast: 0.2s ease;
      --transition-normal: 0.3s ease;
      --font-main: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    /* Base styles */
    body {
      background-color: var(--bg-dark);
      color: var(--text-dark);
      font-family: var(--font-main);
      line-height: 1.6;
      transition: all var(--transition-normal);
      margin: 25px;
      padding: 0;
      min-height: 100vh;
    }

    body.light-mode {
      background-color: var(--bg-light);
      color: var(--text-light);
    }

    /* Typography */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-weight: 600;
      margin-top: 0;
      color: var(--primary-color);
    }

    a {
      color: var(--primary-color);
      text-decoration: none;
      transition: all var(--transition-fast);
    }

    a:hover {
      color: var(--primary-light);
      text-decoration: none;
    }

    /* Layout components */
    .container {
      max-width: 1400px;
      padding: 0 30px;
      margin: 0 auto;
    }

    /* Header improvements */
    header {
      background: var(--gradient-secondary);
      padding: 20px 0;
      box-shadow: var(--shadow-dark);
      position: relative;
      z-index: 10;
      margin-bottom: 20px;
    }

    .account-info-container {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-right: 10px;
    }

    .token-balance {
      font-size: 0.85rem;
      color: var(--primary-light);
      margin-top: 2px;
    }

    .header-logo {
      display: flex;
      align-items: center;
      text-decoration: none;
    }

    .logo-img {
      height: 40px;
      margin-right: 15px;
      transition: transform var(--transition-fast);
    }

    .logo-img:hover {
      transform: scale(1.1);
    }

    header h1 {
      font-size: 28px;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      display: inline-block;
      margin-bottom: 0;
    }

    .light-mode header {
      background: var(--card-light);
      background-color: var(--card-light);
      box-shadow: var(--shadow-light);
    }

    /* Stats bar improvements - currently hidden as per request */
    .stats-bar {
      display: none; /* Hidden by default as requested */
      align-items: center;
      padding: 15px 25px;
      background: rgba(39, 41, 45, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(58, 61, 64, 0.5);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-dark);
      margin: 20px auto;
      max-width: 1200px;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .stats-bar .stat {
      display: flex;
      align-items: center;
      padding: 8px 15px;
      background: rgba(16, 163, 127, 0.1);
      border: 1px solid rgba(16, 163, 127, 0.2);
      border-radius: var(--radius-sm);
      font-weight: 500;
      transition: all var(--transition-fast);
      margin: 5px;
      min-width: 180px;
    }

    .stats-bar .stat:hover {
      background: rgba(16, 163, 127, 0.2);
      transform: translateY(-2px);
    }

    .stats-bar img {
      height: 32px;
      margin-right: 15px;
      transition: transform var(--transition-fast);
    }

    .stats-bar img:hover {
      transform: scale(1.1);
    }

    .stats-bar.light-mode {
      background: rgba(245, 247, 250, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(229, 231, 235, 0.5);
      box-shadow: var(--shadow-light);
    }

    .light-mode .stat {
      background: var(--accent-light);
      color: var(--text-light);
    }

    /* Rewards section styling */
    .rewards-section, .quick-claim-section {
      background: rgba(39, 41, 45, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(58, 61, 64, 0.5);
      border-radius: var(--radius-md);
      padding: 15px 25px;
      margin: 20px auto;
      text-align: center;
      box-shadow: var(--shadow-dark);
      flex: 1;
      min-width: 250px;
    }

    /* Quick Claim section styling */
    .quick-claim-section {
      margin-top: 20px;
      padding: 15px;
      text-align: center;
    }

    .quick-claim-section h4 {
      margin-bottom: 15px;
      color: var(--primary-color);
      font-size: 1.1rem;
    }

    /* Hide rewards section by default */
    #rewardsSection {
      display: none;
    }

    .rewards-section h3 {
      margin-bottom: 15px;
      color: var(--primary-color);
      margin-top: 0;
    }

    .rewards-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .simulation-toggle {
      cursor: pointer;
      position: relative;
      width: 50px;
      height: 24px;
      background-color: #ccc;
      border-radius: 12px;
      transition: background-color 0.3s;
      display: flex;
      align-items: center;
      padding: 0 4px;
    }

    .simulation-toggle::before {
      content: "";
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background-color: white;
      left: 2px;
      transition: transform 0.3s;
    }

    .simulation-toggle.active {
      background-color: var(--primary-color);
    }

    .simulation-toggle.active::before {
      transform: translateX(26px);
    }

    .simulation-toggle:hover {
      opacity: 0.9;
    }

    .simulation-toggle.active {
      background: #e74c3c;
      opacity: 1;
    }

    .simulation-status {
      font-size: 0.9rem;
      margin-top: 10px;
      text-align: center;
      color: var(--primary-color);
      font-weight: bold;
      padding: 5px;
      border-radius: 5px;
      background-color: rgba(16, 163, 127, 0.1);
    }

    #claimableRewards {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--text-dark);
    }

    .claim-btn, .quick-claim-btn {
      background: var(--gradient-primary);
      color: white;
      border: none;
      padding: 10px 25px;
      border-radius: var(--radius-md);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-fast);
      box-shadow: 0 4px 10px rgba(16, 163, 127, 0.3);
    }

    .claim-btn:hover, .quick-claim-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(16, 163, 127, 0.4);
    }

    .claim-btn:active, .quick-claim-btn:active {
      transform: translateY(1px);
    }

    .quick-claim-btn {
      padding: 8px 20px;
      font-size: 0.9rem;
    }

    .light-mode .rewards-section {
      background: rgba(245, 247, 250, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(229, 231, 235, 0.5);
    }

    .light-mode #claimableRewards {
      color: var(--text-light);
    }

    /* Buttons */
    button,
    .btn {
      border: none;
      color: white;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: var(--radius-sm);
      background: var(--gradient-primary);
      font-weight: 500;
      transition: all var(--transition-fast), transform 0.1s ease;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      text-transform: none;
      letter-spacing: 0.3px;
    }

    button:hover,
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      background: var(--primary-color);
    }

    button:active,
    .btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    .btn-secondary {
      background: var(--gradient-secondary);
      margin: 0 5px 5px 0;
      place-content: center;
    }

    .btn-secondary:hover {
      background: var(--accent-dark);
    }

    .light-mode .btn-secondary {
      background: var(--accent-light);
      color: var(--text-light);
    }

    .light-mode .btn-secondary:hover {
      background: var(--hover-light);
    }

    .btn-info {
      background: linear-gradient(135deg, #0099cc, #006699);
      margin: 0 5px 5px 0;
    }

    .btn-info:hover {
      background: #0099cc;
    }

    .btn-warning {
      background: linear-gradient(135deg, #ff9900, #cc7700);
      margin: 0 5px 5px 0;
    }

    .btn-warning:hover {
      background: #ff9900;
    }

    .btn-outline-secondary {
      background: transparent;
      border: 1px solid var(--accent-color);
      color: var(--accent-color);
      margin: 0 5px 5px 0;
    }

    .btn-outline-secondary:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .light-mode .btn-outline-secondary {
      border-color: var(--accent-dark);
      color: var(--text-light);
    }

    .light-mode .btn-outline-secondary:hover {
      background: rgba(0, 0, 0, 0.05);
      color: var(--text-light);
    }

    /* Cards */
    .card {
      background: var(--card-dark);
      color: var(--text-dark);
      padding: 20px;
      border: none;
      border-radius: var(--radius-md);
      margin-bottom: 20px;
      transition: all var(--transition-normal);
      box-shadow: var(--shadow-dark);
    }

    .light-mode .card {
      background: rgba(245, 247, 250, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(229, 231, 235, 0.5);
      box-shadow: var(--shadow-light);
    }

    .card-body {
      padding: 0;
    }

    /* Dark mode toggle */
    .dark-mode-toggle {
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: var(--primary-color);
      color: white;
      border: none;
      padding: 10px 15px;
      margin: 0;
      margin-right: 10px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      height: 38px; /* Match the height of other nav buttons */
    }

    .dark-mode-toggle:hover {
      background: var(--primary-light);
      transform: translateY(-2px);
    }

    /* Dark mode toggle icon is now handled by JavaScript */

    /* Template grid */
    .template-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .template-card {
      background: var(--card-dark);
      border-radius: var(--radius-md);
      overflow: hidden;
      transition: all var(--transition-fast);
      box-shadow: var(--shadow-dark);
      position: relative;
      display: flex;
      flex-direction: column;
    }

    .template-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    }

    .template-card .template-image {
      height: 160px;
      background-size: cover;
      background-position: center;
      background-color: var(--accent-dark);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-dark);
      font-weight: bold;
      font-size: 18px;
    }

    .template-card .template-info {
      padding: 15px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .template-card .template-name {
      font-weight: 600;
      font-size: 18px;
      margin-bottom: 5px;
      color: var(--primary-color);
    }

    .template-card .template-type {
      font-size: 14px;
      color: var(--text-dark);
      opacity: 0.8;
      margin-bottom: 10px;
    }

    .light-mode .template-card .template-type {
      color: var(--text-light);
    }

    .template-card .template-stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .template-card .stat-value {
      font-weight: 600;
      font-size: 16px;
      color: var(--primary-light);
    }

    .template-card .stat-label {
      font-size: 12px;
      opacity: 0.7;
    }

    .template-card .template-actions {
      margin-top: auto;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      justify-content: center;
    }

    .template-card .template-actions .btn {
      padding: 8px 12px;
      font-size: 0.9rem;
      flex-grow: 1;
      min-width: 80px;
      text-align: center;
    }

    .template-card .asset-count {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(16, 163, 127, 0.9);
      color: white;
      border-radius: 20px;
      padding: 3px 10px;
      font-size: 12px;
      font-weight: 600;
    }

    .template-card .staked-count {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(45, 47, 49, 0.9);
      color: white;
      border-radius: 20px;
      padding: 3px 10px;
      font-size: 12px;
      font-weight: 600;
    }

    /* Asset selection modal */
    .modal-content {
      background: var(--card-dark);
      color: var(--text-dark);
      border: none;
      border-radius: var(--radius-md);
    }

    .modal-header {
      border-bottom: 1px solid var(--border-dark);
    }

    .modal-footer {
      border-top: 1px solid var(--border-dark);
    }

    .asset-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
      max-height: 400px;
      overflow-y: auto;
      padding: 10px;
    }

    .asset-item {
      border: 2px solid transparent;
      border-radius: var(--radius-sm);
      overflow: hidden;
      cursor: pointer;
      position: relative;
      transition: all var(--transition-fast);
    }

    .asset-item:hover {
      transform: scale(1.05);
    }

    .asset-item.selected {
      border-color: var(--primary-color);
    }

    .asset-item img {
      width: 100%;
      height: auto;
      display: block;
    }

    .asset-item .asset-id {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 10px;
      padding: 2px 5px;
      text-align: center;
    }

    .selection-controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    /* Loading spinner */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Header connection styles */
    .header-connection {
      display: flex;
      align-items: center;
      margin-left: 10px;
    }

    .header-connection #headerAccountInfo {
      display: flex;
      align-items: center;
      color: var(--text-dark);
      font-size: 0.9rem;
    }

    .account-label {
      margin-right: 5px;
      opacity: 0.8;
    }

    .mobile-connection {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid var(--border-dark);
    }

    .light-mode .header-connection #headerAccountInfo {
      color: var(--text-light);
    }

    /* Dashboard layout */
    .dashboard-row {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin: 20px auto;
      max-width: 1200px;
    }

    .dashboard-row > div {
      flex: 1;
      min-width: 250px;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .stats-bar {
        flex-direction: column;
        align-items: center;
        padding: 10px;
      }

      .stats-bar .stat {
        margin-bottom: 5px;
        width: 100%;
        justify-content: center;
      }

      .template-grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      }

      .dashboard-row {
        flex-direction: column;
      }

      .header-connection {
        display: none; /* Hide header connection on mobile */
      }
    }

    /* Total staking power highlight */
    .total-power {
      background: var(--gradient-primary);
      color: white;
      padding: 15px 25px;
      border-radius: var(--radius-md);
      text-align: center;
      margin: 20px 0;
      box-shadow: var(--shadow-dark);
      cursor: pointer;
    }

    .total-power h3 {
      margin: 0;
      color: white;
      font-size: 24px;
    }

    .total-power .power-value {
      font-size: 36px;
      font-weight: 700;
      margin: 10px 0;
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(16, 163, 127, 0.4);
      }

      70% {
        box-shadow: 0 0 0 10px rgba(16, 163, 127, 0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(16, 163, 127, 0);
      }
    }

    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      border-radius: var(--radius-md);
    }

    .global-loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .loading-content {
      background: var(--card-dark);
      padding: 30px;
      border-radius: var(--radius-md);
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: var(--shadow-dark);
    }

    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid rgba(16, 163, 127, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 1s ease-in-out infinite;
      margin-bottom: 15px;
    }

    .loading-text {
      color: var(--text-dark);
      font-weight: 500;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Video backgrounds for template cards */
    .template-image.video-bg {
      position: relative;
      overflow: hidden;
    }

    .template-image.video-bg video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .template-image::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.2);
      z-index: 1;
      pointer-events: none;
    }

    .template-image.video-bg .template-name-overlay {
      position: absolute;
      bottom: 10px;
      left: 10px;
      color: white;
      font-weight: bold;
      z-index: 2;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
    }

    .template-container:hover .template-name-overlay {
      background: rgba(16, 163, 127, 0.8);
    }

    .template-image.img-asset-bg {
      position: relative;
      overflow: hidden;
    }


    /* Add this to your existing CSS */
    .power-value-container {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 10px 0;
    }

    .power-value {
      font-size: 36px;
      font-weight: 700;
      margin: 0 5px;
    }

    .power-rate {
      font-size: 16px;
      opacity: 0.8;
      align-self: flex-end;
      margin-bottom: 8px;
    }

    /* .info-icon {
    margin-left: 10px;
    cursor: pointer;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    transition: all var(--transition-fast);
}

.info-icon:hover {
    background: rgba(255, 255, 255, 0.4);
    transform: scale(1.1);
} */

    .earnings-table {
      width: 100%;
      border-collapse: collapse;
    }

    .earnings-table th,
    .earnings-table td {
      padding: 8px 12px;
      text-align: right;
    }

    .earnings-table th:first-child,
    .earnings-table td:first-child {
      text-align: left;
    }

    .earnings-table th {
      background: var(--primary-dark);
      color: white;
    }

    .earnings-table tr:nth-child(even) {
      background: rgba(16, 163, 127, 0.1);
    }

    .earnings-table tr:hover {
      background: rgba(16, 163, 127, 0.2);
    }

    .earnings-total {
      font-weight: 700;
      background: var(--primary-dark) !important;
      color: white;
    }

    .earnings-total td {
      border-top: 2px solid var(--primary-color);
    }

    /* Add this to your existing CSS */
    .asset-item video {
      width: 100%;
      height: auto;
      display: block;
      object-fit: cover;
      aspect-ratio: 1/1;
      background-color: var(--accent-dark);
    }

    /* For better hover effects on videos */
    .asset-item:hover video {
      transform: scale(1.05);
      transition: transform var(--transition-fast);
    }

    /* Make sure videos don't overflow their containers */
    .asset-item {
      /* ... existing code ... */
      overflow: hidden;
      position: relative;
    }

    /* Add a subtle overlay to make text more readable over videos */
    .asset-item.video-asset::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to bottom, transparent 70%, rgba(0, 0, 0, 0.7) 100%);
      pointer-events: none;
    }

    /* Add a small video indicator */
    .asset-item.video-asset::before {
      content: '▶';
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      font-size: 10px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
    }

    /* Ensure videos in modals display properly */
    .modal .asset-item video {
      max-height: 200px;
    }

    .modal .asset-item .img-asset-bg {
      max-height: 200px;
    }


    /* Add loading state for videos */
    .asset-item video.loading {
      min-height: 100px;
      background: var(--accent-dark) url('https://pixeljourney.xyz/img/loading.gif') center no-repeat;
      background-size: 32px;
    }

    /* Add loading state for videos */
    .asset-item video.loading {
      min-height: 100px;
      background: var(--accent-dark) url('https://pixeljourney.xyz/img/loading.gif') center no-repeat;
      background-size: 32px;
    }

    /* Preview Section Styling */
    .preview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .preview-card {
      background: linear-gradient(135deg, rgba(16, 163, 127, 0.1), rgba(16, 163, 127, 0.2));
      border-radius: var(--radius-md);
      overflow: hidden;
      transition: all var(--transition-fast);
      box-shadow: var(--shadow-dark);
      border: 1px solid rgba(16, 163, 127, 0.3);
    }

    .light-mode .preview-card {
      background: linear-gradient(135deg, rgba(16, 163, 127, 0.05), rgba(16, 163, 127, 0.1));
      border: 1px solid rgba(16, 163, 127, 0.2);
      box-shadow: var(--shadow-light);
    }

    .preview-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      border-color: var(--primary-color);
    }

    .preview-image {
      height: 160px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.2);
      padding: 20px;
    }

    .light-mode .preview-image {
      background: rgba(255, 255, 255, 0.2);
    }

    .preview-image img {
      max-height: 120px;
      max-width: 120px;
      object-fit: contain;
      transition: transform var(--transition-fast);
    }

    .preview-card:hover .preview-image img {
      transform: scale(1.1);
    }

    .preview-info {
      padding: 15px;
    }

    .preview-info h4 {
      margin: 0 0 5px 0;
      font-size: 18px;
      color: var(--primary-color);
    }

    .preview-info p {
      margin: 0 0 10px 0;
      font-size: 14px;
      opacity: 0.8;
    }

    .preview-rate {
      font-weight: 600;
      color: var(--primary-light);
      font-size: 16px;
      padding: 5px 10px;
      background: rgba(16, 163, 127, 0.1);
      border-radius: var(--radius-sm);
      display: inline-block;
    }

    /* Benefits Section */
    .benefits-section {
      padding-top: 20px;
      border-top: 1px solid var(--border-dark);
    }

    .light-mode .benefits-section {
      border-top: 1px solid var(--border-light);
    }

    .benefits-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .benefit-item {
      display: flex;
      align-items: center;
      padding: 10px;
      background: rgba(16, 163, 127, 0.05);
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
    }

    .benefit-item:hover {
      background: rgba(16, 163, 127, 0.1);
      transform: translateY(-2px);
    }

    .benefit-icon {
      font-size: 24px;
      margin: 6px;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--primary-color);
      color: white;
      border-radius: 50%;
    }

    .benefit-text {
      font-size: 14px;
    }

    /* Lead text styling */
    .lead {
      font-size: 18px;
      font-weight: 300;
      line-height: 1.6;
    }

    @media (max-width: 768px) {
      .preview-grid {
        grid-template-columns: 1fr;
      }

      .benefits-grid {
        grid-template-columns: 1fr;
      }

      .lead {
        font-size: 16px;
      }
    }

    /* Add these styles for the pixel ingredients preview section */
    .preview-item {
      position: relative;
      overflow: hidden;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-dark);
      aspect-ratio: 1 / 1;
    }

    .preview-item img,
    .preview-item video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      transition: transform 0.3s ease;
    }

    .preview-item:hover img,
    .preview-item:hover video {
      transform: scale(1.05);
    }

    /* Life Cycle of Journey Crafting Economy Section */
    .section-title {
      font-size: 28px;
      margin-bottom: 20px;
      color: var(--primary-color);
      text-align: center;
      position: relative;
      padding-bottom: 15px;
    }

    .section-title:after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background: var(--gradient-primary);
      border-radius: 3px;
    }

    .journey-steps {
      display: flex;
      flex-direction: column;
      gap: 40px;
      margin: 30px 0;
    }

    .journey-step {
      position: relative;
      background: rgba(16, 163, 127, 0.05);
      border-radius: var(--radius-md);
      padding: 30px;
      border-left: 4px solid var(--primary-color);
      box-shadow: var(--shadow-dark);
    }

    .light-mode .journey-step {
      background: rgba(16, 163, 127, 0.03);
      box-shadow: var(--shadow-light);
    }

    .step-number {
      position: absolute;
      top: -15px;
      left: 30px;
      background: var(--gradient-primary);
      color: white;
      font-weight: bold;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 14px;
      box-shadow: 0 4px 8px rgba(16, 163, 127, 0.3);
    }

    .journey-step h3 {
      margin-top: 10px;
      margin-bottom: 20px;
      font-size: 22px;
    }

    .route-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }

    @media (max-width: 768px) {
      .route-options {
        grid-template-columns: 1fr;
      }
    }

    .route-option {
      background: rgba(0, 0, 0, 0.1);
      border-radius: var(--radius-sm);
      padding: 20px;
      transition: all var(--transition-fast);
    }

    .light-mode .route-option {
      background: rgba(255, 255, 255, 0.5);
      border: 1px solid rgba(16, 163, 127, 0.1);
    }

    .route-option:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    .route-option h4 {
      font-size: 18px;
      margin-bottom: 15px;
      color: var(--primary-light);
    }

    .route-steps {
      padding-left: 20px;
      margin-bottom: 15px;
    }

    .route-steps li {
      margin-bottom: 10px;
    }

    .route-link,
    .marketplace-link,
    .craft-link,
    .waxdao-link {
      display: inline-block;
      background: rgba(16, 163, 127, 0.1);
      color: var(--primary-color);
      padding: 3px 10px;
      border-radius: 15px;
      font-size: 14px;
      transition: all var(--transition-fast);
      text-decoration: none;
    }

    .route-link:hover,
    .marketplace-link:hover,
    .craft-link:hover,
    .waxdao-link:hover {
      background: rgba(16, 163, 127, 0.2);
      transform: translateY(-2px);
      color: var(--primary-light);
      text-decoration: none;
    }

    /* Improved Marketplace Links Styling */
    .marketplace-links-container {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 15px;
      margin: 20px 0;
    }

    @media (max-width: 768px) {
      .marketplace-links-container {
        grid-template-columns: 1fr;
      }
    }

    .marketplace-link-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px;
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
      text-decoration: none;
      height: 100%;
      min-height: 120px;
      justify-content: center;
    }

    .marketplace-link-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      text-decoration: none;
    }

    .marketplace-logo {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      background: white;
      padding: 5px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .marketplace-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .marketplace-name {
      font-weight: 600;
      font-size: 16px;
      text-align: center;
    }

    /* Marketplace specific styling */
    .marketplace-link-card.nfthive {
      background: rgba(255, 193, 0, 0.1);
      border: 1px solid rgba(255, 193, 0, 0.3);
    }

    .marketplace-link-card.nfthive .marketplace-name {
      color: #FFC100;
    }

    .marketplace-link-card.nfthive:hover {
      background: rgba(255, 193, 0, 0.2);
    }

    .marketplace-link-card.atomichub {
      background: rgba(247, 143, 32, 0.1);
      border: 1px solid rgba(247, 143, 32, 0.3);
    }

    .marketplace-link-card.atomichub .marketplace-name {
      color: #F78F20;
    }

    .marketplace-link-card.atomichub:hover {
      background: rgba(247, 143, 32, 0.2);
    }

    .marketplace-link-card.neftyblocks {
      background: rgba(33, 255, 255, 0.1);
      border: 1px solid rgba(33, 255, 255, 0.3);
    }

    .marketplace-link-card.neftyblocks .marketplace-name {
      color: #21FFFF;
    }

    .marketplace-link-card.neftyblocks:hover {
      background: rgba(33, 255, 255, 0.2);
    }

    .info-box {
      background: rgba(16, 163, 127, 0.05);
      border-radius: var(--radius-sm);
      padding: 15px;
      margin-top: 15px;
      border-left: 3px solid var(--primary-color);
    }

    .light-mode .info-box {
      background: rgba(16, 163, 127, 0.03);
    }

    .upgrade-paths {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin: 25px 0;
    }

    .upgrade-path {
      background: rgba(0, 0, 0, 0.1);
      border-radius: var(--radius-sm);
      padding: 20px;
      transition: all var(--transition-fast);
    }

    .light-mode .upgrade-path {
      background: rgba(255, 255, 255, 0.5);
      border: 1px solid rgba(16, 163, 127, 0.1);
    }

    .upgrade-path:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .upgrade-path.rare {
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.3));
      border: 1px dashed gold;
    }

    .light-mode .upgrade-path.rare {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.05), rgba(255, 215, 0, 0.1));
      border: 1px dashed gold;
    }

    .upgrade-visual {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .ingredient {
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      font-weight: bold;
      font-size: 14px;
      color: white;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    .ingredient {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      overflow: hidden;
      position: relative;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease;
    }

    .ingredient:hover {
      transform: scale(1.1);
      z-index: 5;
    }

    .ingredient video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .upgrade-visual {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin: 20px 0;
    }

    .plus-sign,
    .equals-sign {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary-color);
    }

    .pxj-cost {
      background: rgba(16, 163, 127, 0.1);
      padding: 8px 15px;
      border-radius: 20px;
      font-weight: bold;
      color: var(--primary-color);
    }

    .craft-label {
      text-align: center;
      font-size: 14px;
      margin-top: 10px;
      opacity: 0.8;
      color: var(--text-dark);
    }

    .light-mode .craft-label {
      color: var(--text-light);
      opacity: 0.9;
    }

    /* Stacked ingredients for the rare black pixel craft */
    .ingredient-group {
      position: relative;
      width: 100px;
      height: 100px;
      margin: 30px;
    }

    .ingredient-stack {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .ingredient.front {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 3;
    }

    .ingredient.middle {
      position: absolute;
      top: 30px;
      left: 30px;
      z-index: 2;
    }

    .ingredient.back {
      position: absolute;
      top: 60px;
      left: 60px;
      z-index: 1;
    }

    .more-indicator {
      position: absolute;
      bottom: -50px;
      right: -60px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 12px;
      font-weight: bold;
      padding: 3px 8px;
      border-radius: 10px;
      z-index: 4;
    }

    /* Specific styling for different ingredient tiers */
    .ingredient.primary {
      border: 2px solid var(--primary-light);
    }

    .ingredient.secondary {
      border: 2px solid var(--primary-light);
    }

    .ingredient.tertiary {
      border: 2px solid var(--primary-light);
    }

    .ingredient.black {
      border: 2px solid #fff;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
    }

    .plus-sign,
    .equals-sign {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary-color);
    }

    .pxj-cost {
      background: rgba(16, 163, 127, 0.1);
      padding: 8px 15px;
      border-radius: 20px;
      font-weight: bold;
      color: var(--primary-color);
    }

    .rare-note {
      text-align: center;
      font-style: italic;
      margin-top: 10px;
      font-size: 14px;
      color: gold;
      text-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
    }

    .light-mode .rare-note {
      color: #b8860b; /* Darker gold for better contrast on light background */
      text-shadow: none;
    }

    .craft-links {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .craft-link {
      padding: 8px 20px;
      font-weight: 500;
    }

    .or-divider {
      color: var(--text-dark);
      opacity: 0.6;
    }

    .light-mode .or-divider {
      color: var(--text-light);
    }

    .waxdao-link {
      display: inline-block;
      background: linear-gradient(135deg, rgba(16, 163, 127, 0.2), rgba(16, 163, 127, 0.3));
      color: white;
      padding: 10px 25px;
      border-radius: var(--radius-sm);
      font-weight: 600;
      margin: 15px 0;
      text-align: center;
    }

    .waxdao-link:hover {
      background: linear-gradient(135deg, rgba(16, 163, 127, 0.3), rgba(16, 163, 127, 0.4));
      color: white;
    }

    .staking-benefits,
    .expansion-benefits {
      background: rgba(16, 163, 127, 0.05);
      border-radius: var(--radius-sm);
      padding: 15px 20px;
      margin-top: 20px;
    }

    .light-mode .staking-benefits,
    .light-mode .expansion-benefits {
      background: rgba(16, 163, 127, 0.03);
    }

    .staking-benefits h4,
    .expansion-benefits h4 {
      color: var(--primary-color);
      margin-bottom: 10px;
      font-size: 16px;
    }

    .staking-benefits ul,
    .expansion-benefits ul {
      padding-left: 20px;
      margin-bottom: 0;
    }

    .staking-benefits li,
    .expansion-benefits li {
      margin-bottom: 8px;
    }

    /* Info Box Container */
    .info-box-container {
      margin-top: 40px;
      border-radius: var(--radius-md);
      overflow: hidden;
      box-shadow: var(--shadow-dark);
    }

    .light-mode .info-box-container {
      box-shadow: var(--shadow-light);
    }

    .info-box-header {
      background: var(--gradient-primary);
      padding: 15px 20px;
    }

    .info-box-header h3 {
      color: white;
      margin: 0;
      font-size: 20px;
    }

    .info-box-content {
      background: rgba(16, 163, 127, 0.05);
      padding: 20px;
    }

    .light-mode .info-box-content {
      background: rgba(255, 255, 255, 0.7);
    }

    .info-point {
      display: flex;
      margin-bottom: 20px;
    }

    .info-point:last-child {
      margin-bottom: 0;
    }

    .info-icon {
      font-size: 24px;
      margin-right: 15px;
      background: rgba(16, 163, 127, 0.1);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .info-text {
      flex: 1;
    }

    .info-text strong {
      color: var(--primary-color);
      display: block;
      margin-bottom: 5px;
    }

    @media (max-width: 768px) {
      .journey-step {
        padding: 25px 15px;
      }

      .upgrade-visual {
        flex-direction: column;
      }

      .ingredient {
        width: 60px;
        height: 60px;
        font-size: 12px;
      }

      .info-point {
        flex-direction: column;
      }

      .info-icon {
        margin-bottom: 10px;
      }

      .ingredient-group {
        margin-bottom: 0px;
      }

      .more-indicator {
        position: absolute;
        bottom: -30px;
        right: -45px;
      }
    }

    /* Connection Loading Animation */
    /* Full screen loading overlay */
    .connection-loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.9);
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: opacity 0.3s ease-out;
    }

    .light-mode .connection-loading-overlay {
      background-color: rgba(255, 255, 255, 0.9);
    }

    .connection-loading-content {
      background: var(--card-dark);
      border-radius: var(--radius-md);
      padding: 30px;
      width: 90%;
      max-width: 500px;
      box-shadow: var(--shadow-dark);
      text-align: center;
    }

    .light-mode .connection-loading-content {
      background: var(--card-light);
      box-shadow: var(--shadow-light);
    }

    .connection-loading-header {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 20px;
    }

    .connection-loading-progress-container {
      height: 10px;
      background-color: var(--accent-dark);
      border-radius: 5px;
      margin: 20px 0;
      overflow: hidden;
    }

    .light-mode .connection-loading-progress-container {
      background-color: var(--accent-light);
    }

    .connection-loading-progress-bar {
      height: 100%;
      width: 0%;
      background: var(--gradient-primary);
      border-radius: 5px;
      transition: width 0.5s ease;
    }

    .connection-loading-text {
      color: var(--text-dark);
      font-weight: 600;
      font-size: 18px;
      margin-bottom: 10px;
    }

    .light-mode .connection-loading-text {
      color: var(--text-light);
    }

    .connection-loading-status {
      color: var(--primary-color);
      font-size: 14px;
      margin-bottom: 20px;
      opacity: 0.8;
      display:none;
    }

    .connection-loading-steps {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 20px;
      text-align: left;
    }

    .loading-step {
      display: flex;
      align-items: center;
      padding: 10px;
      border-radius: var(--radius-sm);
      background-color: var(--accent-dark);
      transition: all 0.3s ease;
    }

    .light-mode .loading-step {
      background-color: var(--accent-light);
    }

    .loading-step.active {
      background-color: rgba(16, 163, 127, 0.2);
      border-left: 4px solid var(--primary-color);
    }

    .loading-step.completed {
      background-color: rgba(16, 163, 127, 0.1);
      border-left: 4px solid var(--primary-color);
    }

    .step-indicator {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background-color: var(--card-dark);
      color: var(--text-dark);
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: 600;
      margin-right: 10px;
    }

    .light-mode .step-indicator {
      background-color: var(--card-light);
      color: var(--text-light);
    }

    .loading-step.active .step-indicator,
    .loading-step.completed .step-indicator {
      background-color: var(--primary-color);
      color: white;
    }

    .step-label {
      flex: 1;
      font-weight: 500;
      color: var(--text-dark);
    }

    .light-mode .step-label {
      color: var(--text-light);
    }

    .step-status {
      font-size: 12px;
      color: var(--text-dark);
      opacity: 0.7;
    }

    .loading-step.active .step-status {
      color: var(--primary-color);
      opacity: 1;
    }

    .loading-step.completed .step-status {
      color: var(--primary-color);
      opacity: 0.8;
    }

    .light-mode .step-status {
      color: var(--text-light);
    }

    /* Pixel Loading Animation */
    .pixel-loader {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 5px;
      width: 120px;
      height: 120px;
    }

    .pixel {
      background-color: var(--primary-color);
      border-radius: 4px;
      animation: pixel-fade 1.8s infinite;
    }

    .pixel-1 {
      animation-delay: 0.0s;
    }

    .pixel-2 {
      animation-delay: 0.2s;
    }

    .pixel-3 {
      animation-delay: 0.4s;
    }

    .pixel-4 {
      animation-delay: 0.6s;
    }

    .pixel-5 {
      animation-delay: 0.8s;
    }

    .pixel-6 {
      animation-delay: 1.0s;
    }

    .pixel-7 {
      animation-delay: 1.2s;
    }

    .pixel-8 {
      animation-delay: 1.4s;
    }

    .pixel-9 {
      animation-delay: 1.6s;
    }

    @keyframes pixel-fade {

      0%,
      100% {
        opacity: 0.3;
        transform: scale(0.8);
      }

      50% {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Leaderboard button */
    .header-buttons {
      display: flex;
      gap: 10px;
    }

    .leaderboard-btn {
      background: var(--gradient-primary);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      font-weight: 500;
    }

    .leaderboard-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(16, 163, 127, 0.3);
      background: var(--primary-light);
      color: white;
    }

    /* Preview Card Links */
    .preview-card-link {
      text-decoration: none;
      color: inherit;
      display: block;
    }

    .preview-card-link:hover {
      text-decoration: none;
      color: inherit;
    }

    /* Keep the existing preview-card styling but adjust for link behavior */
    .preview-card-link .preview-card {
      cursor: pointer;
      position: relative;
    }

    /* Add a subtle indicator that the card is clickable */
    .preview-card-link .preview-card::after {
      content: '';
      position: absolute;
      top: 10px;
      right: 10px;
      width: 24px;
      height: 24px;
      background: rgba(16, 163, 127, 0.8);
      border-radius: 50%;
      opacity: 0;
      transition: opacity var(--transition-fast);
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z'/%3E%3Cpath d='M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z'/%3E%3C/svg%3E");
      background-position: center;
      background-repeat: no-repeat;
      background-size: 14px;
    }

    .preview-card-link:hover .preview-card::after {
      opacity: 1;
    }

    /* Disable the link for collectibles that aren't ready yet */
    .preview-card-link.collectibles-link {
      cursor: default;
    }

    .preview-card-link.collectibles-link .preview-card::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z'/%3E%3C/svg%3E");
    }

    /* Add this to your CSS */
    .logout-btn {
      background: var(--gradient-secondary);
      color: var(--text-dark);
    }

    .light-mode .logout-btn {
      background: var(--accent-light);
      color: var(--text-light);
    }

    .logout-btn:hover {
      background: var(--accent-dark);
      color: white;
    }

    .light-mode .logout-btn:hover {
      background: var(--hover-light);
      color: var(--text-light);
    }

        /* Improved Light Mode Readability */
        .light-mode p {
      color: #333333;
      line-height: 1.7;
    }

    .light-mode .benefit-text,
    .light-mode .journey-step p {
      color: #444444;
      font-weight: 400;
    }

    .light-mode .info-text {
      color: #444444;
      font-weight: 400;
    }

    .light-mode .journey-step li {
      color: #444444;
      margin-bottom: 8px;
    }

    .light-mode .template-info {
      background: rgba(245, 247, 250, 0.95);
      border: 1px solid rgba(229, 231, 235, 0.7);
      color: #333333;
      box-shadow: var(--shadow-light);
    }

    header.light-mode {
      background: linear-gradient(135deg, #f5f7fa, #e5e7eb);
      box-shadow: var(--shadow-light);
    }

    header.light-mode h1 {
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .light-mode .stats-bar {
      background: rgba(245, 247, 250, 0.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(229, 231, 235, 0.7);
      box-shadow: var(--shadow-light);
    }

    .light-mode .stat {
      color: #333333;
    }

        /* Mobile Header Account Styles */
    .mobile-header-account {
      display: none;
      margin-right: 15px;
    }

    .mobile-account-info {
      display: none; /* Hide by default */
      flex-direction: column;
      align-items: flex-end;
      text-align: right;
    }

    /* Only show mobile-account-info on mobile */
    @media (max-width: 768px) {
      .mobile-account-info {
        display: flex;
      }
    }

    .mobile-token-balance {
      font-size: 0.85rem;
      color: var(--primary-color);
    }

    /* Burger Menu Styles */
    .burger-menu {
      display: none;
      flex-direction: column;
      justify-content: space-between;
      width: 30px;
      height: 21px;
      cursor: pointer;
      z-index: 1001;
    }

    .burger-bar {
      width: 100%;
      height: 3px;
      background-color: var(--text-dark);
      border-radius: 3px;
      transition: all 0.3s ease-in-out;
    }

    .light-mode .burger-bar {
      background-color: var(--text-light);
    }

    .mobile-menu {
      position: fixed;
      top: 0;
      right: -300px;
      width: 250px;
      height: 100vh;
      background: var(--card-dark);
      z-index: 1000;
      padding: 60px 20px 20px;
      transition: right 0.3s ease-in-out;
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .light-mode .mobile-menu {
      background: var(--card-light);
    }

    .mobile-menu.active {
      right: 0;
    }

    .mobile-menu a,
    .mobile-menu button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 12px 15px;
      margin-bottom: 8px;
      border-radius: var(--radius-sm);
      font-weight: 500;
      transition: all var(--transition-fast);
    }

    .mobile-menu a {
      color: var(--text-dark);
      text-decoration: none;
      background: var(--accent-dark);
    }

    .light-mode .mobile-menu a {
      color: var(--text-light);
      background: var(--accent-light);
    }

    .mobile-menu a:hover {
      background: var(--primary-color);
      color: white;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease-in-out;
    }

    .overlay.active {
      opacity: 1;
      visibility: visible;
    }

    @media (max-width: 768px) {
      .header-buttons {
        display: none !important;
      }

      .burger-menu {
        display: flex;
      }
    }
  </style>


  <script src="https://unpkg.com/anchor-link@3"></script>
  <script src="https://unpkg.com/anchor-link-browser-transport@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/@greymass//dist/eosio.min.js"></script>
</head>

<body>
  <header>
    <div class="container d-flex justify-content-between align-items-center">
      <a href="https://stake.pixeljourney.xyz" class="header-logo">
        <img src="https://pixeljourney.xyz/img/logo.png" alt="Pixel Journey Logo" class="logo-img">
        <h1>Pixel Staking Portal</h1>
      </a>

      <!-- Mobile Account Info -->
      <div class="mobile-header-account" id="mobileHeaderAccount" style="display: none;">
        <div class="mobile-account-info">
          <span id="mobileHeaderAccountName" class="fw-bold"></span>
          <div class="mobile-token-balance"><span id="mobileHeaderPxjBalance">0.0</span> PXJ</div>
        </div>
      </div>

      <!-- Burger Menu Icon -->
      <div class="burger-menu">
        <div class="burger-bar"></div>
        <div class="burger-bar"></div>
        <div class="burger-bar"></div>
      </div>

      <!-- Desktop Menu with Connection Status -->
      <div class="d-flex header-buttons align-items-center">
        <a href="index.html" class="btn btn-secondary me-2">Home</a>
        <a href="https://lb.pixeljourney.xyz" class="btn btn-secondary leaderboard-btn me-2" target="_blank">
          <i class="fas fa-trophy"></i>🏆 Leaderboards
        </a>
        <button class="dark-mode-toggle btn btn-secondary me-2" id="darkModeToggle">🌞</button>
        <!-- Connection Status for Desktop -->
        <div class="header-connection" id="headerConnection">
          <button class="btn" id="headerLoginButton">Connect Wallet</button>
          <div id="headerAccountInfo" style="display: none;">
            <div class="account-info-container">
              <span id="headerAccountName" class="fw-bold"></span>
              <div id="headerTokenBalance" class="token-balance"><span id="pxjBalance">0.0</span> PXJ</div>
            </div>
            <button class="btn btn-sm btn-secondary ms-2" id="logoutButton">Log Out</button>
          </div>
        </div>
      </div>
    </div>
  </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu">
      <a href="index.html">Home</a>
      <a href="https://lb.pixeljourney.xyz" target="_blank">
        <i class="fas fa-trophy"></i> Leaderboards
      </a>
      <button class="dark-mode-toggle btn btn-secondary" id="mobileDarkModeToggle">🌞</button>
      <!-- Connection Status for Mobile -->
      <div class="mobile-connection">
        <button class="btn" id="mobileLoginButton">Connect Wallet</button>
        <div id="mobileAccountInfo" style="display: none;">
          <div><span id="mobileAccountName" class="fw-bold"></span></div>
          <button class="btn btn-sm btn-secondary mt-2" id="mobileLogoutButton">Log Out</button>
        </div>
      </div>
    </div>

  <!-- Overlay -->
  <div class="overlay"></div>

  <!-- Loading overlay -->
  <div id="connectionLoadingOverlay" class="connection-loading-overlay" style="display: none;">
    <div class="connection-loading-content">
      <div class="connection-loading-header">Loading Your Pixel Journey</div>
      <div class="connection-loading-progress-container">
        <div id="loadingProgressBar" class="connection-loading-progress-bar"></div>
      </div>
      <div class="connection-loading-text">Connecting to WAX Blockchain...</div>
      <div class="connection-loading-status">Initializing...</div>
      <div class="connection-loading-steps">
        <div class="loading-step" id="stepWalletConnection">
          <div class="step-indicator">1</div>
          <div class="step-label">Wallet Connection</div>
          <div class="step-status">Pending</div>
        </div>
        <div class="loading-step" id="stepUserData">
          <div class="step-indicator">2</div>
          <div class="step-label">User Data</div>
          <div class="step-status">Waiting</div>
        </div>
        <div class="loading-step" id="stepInventory">
          <div class="step-indicator">3</div>
          <div class="step-label">NFT Inventory</div>
          <div class="step-status">Waiting</div>
        </div>
        <div class="loading-step" id="stepStakingPower">
          <div class="step-indicator">4</div>
          <div class="step-label">Staking Power</div>
          <div class="step-status">Waiting</div>
        </div>
      </div>

      <!-- Quick Claim Section -->
      <div class="quick-claim-section" id="quickClaimSection" style="display: none;">
        <h4>Quick Claim Rewards</h4>
        <button class="quick-claim-btn" id="quickClaimButton">Claim Rewards</button>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Mobile Connection Status (only visible on mobile) -->
    <div class="card mb-4 d-md-none" id="mobileConnectionCard">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <h3>Connect to WAX</h3>
          <button class="btn" id="loginButton">Connect Wallet</button>
        </div>
        <div id="accountInfo" class="mt-3" style="display: none;">
          <p><span id="accountName" class="fw-bold"></span></p>
        </div>
      </div>
    </div>

    <!-- Dashboard Row with Stats -->
    <div class="dashboard-row" id="dashboardRow" style="display: none;">
      <!-- Rewards Section (Inside Dashboard Row) -->
      <div class="rewards-section" id="rewardsSection" style="display: none;">
        <div class="rewards-header">
          <h3>Claimable Rewards</h3>
        </div>
        <div id="claimableRewards">Loading rewards...</div>
        <button class="claim-btn" id="claimButton">Claim Rewards</button>
        <div class="simulation-status" id="simulationStatus" style="display: none;"></div>
      </div>
      <!-- Total Staking Power -->
      <div class="total-power" id="totalPowerCard">
        <h3>Your Total Staking Power</h3>
        <div class="power-value-container">
          <div class="power-value" id="totalPowerValue">0</div>
          <div class="power-rate"> /hour</div>
        </div>
        <div class="d-flex justify-content-center gap-3">
          <div><span id="totalPxjValue">0</span> PXJ</div>
          <div><span id="totalWufValue">0</span> WUF</div>
        </div>
      </div>

      <!-- Stats Bar (moved into dashboard row) -->
      <div class="stats-bar" id="statsBar">
        <div class="stat">
          <div>
            <div class="fw-bold">Total Assets</div>
            <div id="totalAssets">0</div>
          </div>
        </div>
        <div class="stat">
          <div>
            <div class="fw-bold">Staked Assets</div>
            <div id="stakedAssets">0</div>
          </div>
        </div>
        <div class="stat">
          <div>
            <div class="fw-bold">Unstaked Assets</div>
            <div id="unstakedAssets">0</div>
          </div>
        </div>
        <div class="stat">
          <div>
            <div class="fw-bold">Template Types</div>
            <div id="templateTypes">0</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Earnings Breakdown Modal -->
    <div class="modal fade" id="earningsModal" tabindex="-1" aria-labelledby="earningsModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="earningsModalLabel">Earnings Breakdown</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <table class="earnings-table">
              <thead>
                <tr>
                  <th>Time Period</th>
                  <th>PXJ</th>
                  <th>WUF</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Per Second</td>
                  <td id="pxjPerSecond">0</td>
                  <td id="wufPerSecond">0</td>
                </tr>
                <tr>
                  <td>Per Minute</td>
                  <td id="pxjPerMinute">0</td>
                  <td id="wufPerMinute">0</td>
                </tr>
                <tr>
                  <td>Per Hour</td>
                  <td id="pxjPerHour">0</td>
                  <td id="wufPerHour">0</td>
                </tr>
                <tr>
                  <td>Per Day</td>
                  <td id="pxjPerDay">0</td>
                  <td id="wufPerDay">0</td>
                </tr>
                <tr>
                  <td>Per Week</td>
                  <td id="pxjPerWeek">0</td>
                  <td id="wufPerWeek">0</td>
                </tr>
                <tr>
                  <td>Per Month (30 days)</td>
                  <td id="pxjPerMonth">0</td>
                  <td id="wufPerMonth">0</td>
                </tr>
                <tr>
                  <td>Per Year</td>
                  <td id="pxjPerYear">0</td>
                  <td id="wufPerYear">0</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Template Grid Section -->

    <!-- Template Grid -->
    <div class="card" id="templateCard" style="display: none;">
      <div class="card-body">
        <h3 class="mb-4">Stakable Templates</h3>
        <div class="template-grid" id="templateGrid">
          <!-- Template cards will be generated here -->
        </div>
      </div>
    </div>


    <!-- Preview Section (New) -->
    <div class="card mb-4" id="previewSection">
      <div class="card-body">
        <h3 class="mb-4">Stake Your Pixel Journey NFTs</h3>
        <p class="lead mb-4">Connect your wallet to start earning PXJ and WUF tokens by staking your Pixel Journey NFTs!
        </p>

        <div class="preview-grid"> <!-- Make the entire card a clickable link -->
          <a href="https://www.pfpwizard.xyz/pfp/pixals/buy/" target="_blank" class="preview-card-link">
            <!-- Preview Cards -->
            <div class="preview-card">
              <div class="preview-item">
                <img src="https://pixeljourney.xyz/img/toppixals/20.webp" alt="Pixel Dust">
              </div>
              <div class="preview-info">
                <h4>Pixal PFPs</h4>
                <p>Stake Pixals to earn PXJ tokens</p>
                <div class="preview-rate">~+ 1.0 PXJ/hour</div>
              </div>
            </div>
          </a>

          <a href="https://nfthive.io/crafts?collection=pixeljourney" target="_blank" class="preview-card-link">
            <div class="preview-card">
              <div class="preview-item">
                <video autoplay loop muted playsinline>
                  <source src="https://pixeljourney.xyz/ingredients/Pixel_Blue_vid_25fps_300px.mp4" type="video/mp4">
                  Your browser does not support the video tag.
                </video>
              </div>
              <div class="preview-info">
                <h4>Pixel Ingredients</h4>
                <p>Stake PFPs to earn PXJ and WUF</p>
                <div class="preview-rate">~+ 0.5 - 142 PXJ/hour</div>
              </div>
            </div>
          </a>

          <a href="#" class="preview-card-link collectibles-link">
            <div class="preview-card">
              <div class="preview-item">
                <img src="https://pixeljourney.xyz/img/SUNSET-PIXEL.png" alt="Pixel Land">
              </div>
              <div class="preview-info">
                <h4>Pixel Collectibles</h4>
                <p>Craft and stake collectibles to boost your earnings</p>
                <div class="preview-rate">coming soon</div>
<!--                 <div class="preview-rate">~+ 0.5 - 1500 PXJ/hour</div> -->
              </div>
            </div>
        </div>
        </a>

        <div class="benefits-section mt-4">
          <h4>Benefits of Staking</h4>
          <div class="benefits-grid">
            <div class="benefit-item">
              <div class="benefit-icon">💰</div>
              <div class="benefit-text">Earn passive bonus journey income in PXJ and WUF tokens</div>
            </div>
            <div class="benefit-item">
              <div class="benefit-icon">🔒</div>
              <div class="benefit-text">Keep your NFTs safe in your wallet while (non-custodially) staking </div>
            </div>
            <div class="benefit-item">
              <div class="benefit-icon">🚀</div>
              <div class="benefit-text">Boost your earnings by progressing & growing your pixel collection</div>
            </div>
            <div class="benefit-item">
              <div class="benefit-icon">🎮</div>
              <div class="benefit-text">Support the Pixel Journey ecosystem!</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Life Cycle of Our Journey Crafting Economy Section -->
    <div class="card mb-4" id="craftingEconomySection">
      <div class="card-body">
        <h2 class="section-title">The Life Cycle of Our Journey Crafting Economy</h2>
        <p class="lead mb-4">Discover how our crafting economy works and how you can participate in the Pixel Journey
          ecosystem.</p>

        <div class="journey-steps">
          <!-- Step 1: Get Ingredients -->
          <div class="journey-step">
            <div class="step-number">Step 1</div>
            <h3>Getting Ingredients</h3>

            <div class="route-options">
              <div class="route-option">
                <h4>Route A: Recycle Pixal PFPs</h4>
                <ol class="route-steps">
                  <li>Find a Pixal PFP - <a href="https://www.pfpwizard.xyz/pfp/pixals/buy/" target="_blank"
                      class="route-link">Buy them here</a></li>
                  <li>Recycle to a Pixel Ingredients Pack - <a
                      href="https://neftyblocks.com/collection/pixeljourney/blends/blend.nefty/37700" target="_blank"
                      class="route-link">Recycle here</a></li>
                  <li>Unpack your packs - <a
                      href="https://neftyblocks.com/collection/pixeljourney/packs/neftyblocksp/2349" target="_blank"
                      class="route-link">Open packs here</a></li>
                </ol>
                <div class="info-box">
                  <p>Each pack gives you 10 random Pixel Ingredients:</p>
                  <ul>
                    <li>~33% Red Primary Ingredients</li>
                    <li>~33% Blue Primary Ingredients</li>
                    <li>~33% Yellow Primary Ingredients</li>
                    <li>1% chance for a Black Pixel Ingredient (worth 87x more than a Primary!)</li>
                  </ul>
                </div>
              </div>

              <div class="route-option">
                <h4>Route B: Buy Directly on Secondary Markets</h4>
                <div class="marketplace-links-container">
                  <a href="https://nfthive.io/collection/pixeljourney?tab=open_market&schema=ingredients&verified=all&order_by=offer_asc"
                    target="_blank" class="marketplace-link-card nfthive">
                    <div class="marketplace-logo">
                      <img src="https://nfthive.io/favicon.ico" alt="NFTHive Logo">
                    </div>
                    <div class="marketplace-name">NFTHive</div>
                  </a>

                  <a href="https://atomichub.io/market?blockchain=wax-mainnet&collection_name=pixeljourney&order=asc&primary_chain=wax-mainnet&schema_name=ingredients&sort=price&symbol=WAX#sales"
                    target="_blank" class="marketplace-link-card atomichub">
                    <div class="marketplace-logo">
                      <img src="https://atomichub.io/favicon.ico" alt="Atomichub Logo">
                    </div>
                    <div class="marketplace-name">Atomichub</div>
                  </a>

                  <a href="https://neftyblocks.com/marketplace/listing?collection_name=pixeljourney&page=1&schema_name=ingredients"
                    target="_blank" class="marketplace-link-card neftyblocks">
                    <div class="marketplace-logo">
                      <img src="https://neftyblocks.com/favicon.ico" alt="NeftyBlocks Logo">
                    </div>
                    <div class="marketplace-name">NeftyBlocks</div>
                  </a>
                </div>
              </div>
            </div>
          </div>

          <!-- Step 2: Upgrading Ingredients -->
          <div class="journey-step">
            <div class="step-number">Step 2</div>
            <h3>Upgrading Your Pixel Ingredients</h3>
            <p>Check out the latest APRs for each on our <a href="https://lb.pixeljourney.xyz/"
                target="_blank">Leaderboards</a></p>

            <div class="upgrade-paths">
              <div class="upgrade-path">
                <div class="upgrade-visual">
                  <div class="ingredient primary">
                    <video autoplay loop muted playsinline>
                      <source src="https://pixeljourney.xyz/ingredients/Pixel_Red_vid_25fps_300px.mp4" type="video/mp4">
                      Primary (Red)
                    </video>
                  </div>
                  <div class="plus-sign">+</div>
                  <div class="ingredient primary">
                    <video autoplay loop muted playsinline>
                      <source src="https://pixeljourney.xyz/ingredients/Pixel_Blue_vid_25fps_300px.mp4"
                        type="video/mp4">
                      Primary (Blue)
                    </video>
                  </div>
                  <div class="plus-sign">+</div>
                  <div class="pxj-cost">25,000 PXJ</div>
                  <div class="equals-sign">=</div>
                  <div class="ingredient secondary">
                    <video autoplay loop muted playsinline>
                      <source src="https://pixeljourney.xyz/ingredients/Pixel_Purple_vid_25fps_300px.mp4"
                        type="video/mp4">
                      Secondary (Purple)
                    </video>
                  </div>
                </div>
                <div class="craft-label">Primary + Primary = Secondary</div>
              </div>

              <div class="upgrade-path">
                <div class="upgrade-visual">
                  <div class="ingredient secondary">
                    <video autoplay loop muted playsinline>
                      <source src="https://pixeljourney.xyz/ingredients/Pixel_Purple_vid_25fps_300px.mp4"
                        type="video/mp4">
                      Secondary (Purple)
                    </video>
                  </div>
                  <div class="plus-sign">+</div>
                  <div class="ingredient primary">
                    <video autoplay loop muted playsinline>
                      <source src="https://pixeljourney.xyz/ingredients/Pixel_Blue_vid_25fps_300px.mp4"
                        type="video/mp4">
                      Primary (Blue)
                    </video>
                  </div>
                  <div class="plus-sign">+</div>
                  <div class="pxj-cost">125,000 PXJ</div>
                  <div class="equals-sign">=</div>
                  <div class="ingredient tertiary">
                    <video autoplay loop muted playsinline>
                      <source src="https://pixeljourney.xyz/ingredients/Pixel_Violet_vid_25fps_300px.mp4"
                        type="video/mp4">
                      Tertiary (Violet)
                    </video>
                  </div>
                </div>
                <div class="craft-label">Secondary + Primary = Tertiary</div>
              </div>

              <div class="upgrade-path rare">
                <div class="upgrade-visual">
                  <div class="ingredient-group primary-group">
                    <div class="ingredient-stack">
                      <div class="ingredient primary front">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Red_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Primary (Red)
                        </video>
                      </div>
                      <div class="ingredient primary middle">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Blue_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Primary (Blue)
                        </video>
                      </div>
                      <div class="ingredient primary back">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Yellow_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Primary (Yellow)
                        </video>
                      </div>
                    </div>
                  </div>
                  <div class="plus-sign">+</div>
                  <div class="ingredient-group secondary-group">
                    <div class="ingredient-stack">
                      <div class="ingredient secondary front">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Purple_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Purple
                        </video>
                      </div>
                      <div class="ingredient secondary middle">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Green_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Orange
                        </video>
                      </div>
                      <div class="ingredient secondary back">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Orange_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Green
                        </video>
                      </div>
                    </div>
                  </div>
                  <div class="plus-sign">+</div>
                  <div class="ingredient-group tertiary-group">
                    <div class="ingredient-stack">
                      <div class="ingredient tertiary front">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Violet_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Violet
                        </video>
                      </div>
                      <div class="ingredient tertiary middle">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Teal_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Teal
                        </video>
                      </div>
                      <div class="ingredient tertiary back">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Amber_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Amber
                        </video>
                      </div>
                      <div class="more-indicator">+3</div>
                    </div>
                  </div>
                  <div class="plus-sign">+</div>
                  <div class="pxj-cost">500,000+ PXJ</div>
                  <div class="equals-sign">=</div>
                  <div class="ingredient black">
                    <video autoplay loop muted playsinline>
                      <source src="https://pixeljourney.xyz/ingredients/Pixel_Black_White_vid_25fps_300px.mp4"
                        type="video/mp4">
                      Black
                    </video>
                  </div>
                </div>
                <div class="craft-label">One of every Primary/Secondary/Tertiary Ingredient (12 total)</div>
                <div class="rare-note">* Additional PXJ cost rises per supply appearance for Black Ingredients!</div>
              </div>
            </div>

            <div class="craft-links">
              <p>Find crafts on:</p>
              <a href="https://nfthive.io/crafts?collection=pixeljourney" target="_blank" class="craft-link">NFTHive</a>
              <span class="or-divider">or</span>
              <a href="https://neftyblocks.com/collection/pixeljourney/blends?category=Pixel+Ingredient+Blends"
                target="_blank" class="craft-link">NeftyBlocks</a>
            </div>
          </div>

          <!-- Step 3: Staking -->
          <div class="journey-step">
            <div class="step-number">Step 3</div>
            <h3>Stake Your Ingredients</h3>
            <p>Stake them to our PixelJourney WaxDAO Farm directly by logging in via this portal, or by visiting the
              original/official WaxDAO Farm UI on:</p>
            <a href="https://waxdao.io/v2/farm/pixeljourney" target="_blank" class="waxdao-link">WaxDAO</a>

            <div class="staking-benefits">
              <h4>Staking Benefits:</h4>
              <ul>
                <li>Earn PXJ back along the way</li>
                <li>Receive your PXJ locked into ingredients or collectibles back across a ~2.5-3 year duration (or
                  better!)</li>
                <li>Get increasingly bigger bonus rewards based on the amount of PXJ locked up</li>
                <li>Bigger crafts will yield even better rewards!</li>
              </ul>
            </div>
          </div>

          <!-- Step 4: Expansion -->
          <div class="journey-step">
            <div class="step-number">Step 4</div>
            <h3>Keep Expanding Your Collection</h3>
            <p>Continue expanding on those Pixel Ingredients (for now) and journey collections (soon to come)!</p>

            <div class="expansion-benefits">
              <h4>Benefits of Expansion:</h4>
              <ul>
                <li>Be best prepared for continued crafts</li>
                <li>Let your pixels continue their journeys</li>
                <li>Ingredients and collectibles will continue to play roles in future journey dApps</li>
                <li>Get perks/utility and ever more uses in future mechanics to come!</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Info Box -->
        <div class="info-box-container">
          <div class="info-box-header">
            <h3>Important Information About PXJ Economy</h3>
          </div>
          <div class="info-box-content">
            <div class="info-point">
              <div class="info-icon">💡</div>
              <div class="info-text">
                <strong>Early Participation is Better:</strong> Locking PXJ up into NFTs along the Pixel Journey earlier
                is better, as it allows holders to stake/re-earn as much PXJ as possible from intermediary steps before
                they may need those ingredients (or other collectibles) in the future to continue crafting.
              </div>
            </div>

            <div class="info-point">
              <div class="info-icon">🔒</div>
              <div class="info-text">
                <strong>Long-term Value:</strong> Locking PXJ into journey NFTs can be compared to a long-time PXJ
                lockup stake. While there isn't directly the option to unstake the PXJ before it is paid out via the
                farms, the NFTs remain holding value and can be traded/sold.
              </div>
            </div>

            <div class="info-point">
              <div class="info-icon">🛡️</div>
              <div class="info-text">
                <strong>Protection from Impermanent Loss:</strong> Contrary to PXJ DeFi with LP Farms and positions, PXJ
                locked into our NFT crafts keeps that PXJ more safe from direct impermanent losses that could occur if
                PXJ is potentially bought away from owners staking in liquidity pools.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>



  </div>

  <!-- Asset Selection Modal -->
  <div class="modal fade" id="assetModal" tabindex="-1" aria-labelledby="assetModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="assetModalLabel">Select Assets to Stake</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="selection-controls">
            <div>
              <button class="btn btn-sm btn-secondary" id="selectAllBtn">Select All</button>
              <button class="btn btn-sm btn-secondary ms-2" id="deselectAllBtn">Deselect All</button>
            </div>
            <div>
              <span id="selectedCount">0</span> assets selected
            </div>
          </div>
          <div class="asset-grid" id="assetGrid">
            <!-- Asset items will be generated here -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn" id="confirmStakeBtn">Stake Selected</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Unstake Modal -->
  <div class="modal fade" id="unstakeModal" tabindex="-1" aria-labelledby="unstakeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="unstakeModalLabel">Select Assets to Unstake</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="selection-controls">
            <div>
              <button class="btn btn-sm btn-secondary" id="selectAllUnstakeBtn">Select All</button>
              <button class="btn btn-sm btn-secondary ms-2" id="deselectAllUnstakeBtn">Deselect All</button>
            </div>
            <div>
              <span id="selectedUnstakeCount">0</span> assets selected
            </div>
          </div>
          <div class="asset-grid" id="stakedAssetGrid">
            <!-- Staked asset items will be generated here -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn" id="confirmUnstakeBtn">Unstake Selected</button>
        </div>
      </div>
    </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://notify.waxsweden.org/static/assets/waxjs.js"></script>
  <script>

    // Burger menu functionality
    document.addEventListener('DOMContentLoaded', function() {
      const burgerMenu = document.querySelector('.burger-menu');
      const mobileMenu = document.querySelector('.mobile-menu');
      const overlay = document.querySelector('.overlay');
      const mobileDarkModeToggle = document.getElementById('mobileDarkModeToggle');

      // Toggle mobile menu
      burgerMenu.addEventListener('click', function() {
        mobileMenu.classList.toggle('active');
        overlay.classList.toggle('active');
        document.body.style.overflow = mobileMenu.classList.contains('active') ? 'hidden' : '';
      });

      // Close menu when clicking overlay
      overlay.addEventListener('click', function() {
        mobileMenu.classList.remove('active');
        overlay.classList.remove('active');
        document.body.style.overflow = '';
      });

      // Make mobile dark mode toggle work the same as desktop
      if (mobileDarkModeToggle && darkModeToggle) {
        mobileDarkModeToggle.addEventListener('click', function() {
          document.body.classList.toggle('light-mode');
          localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
        });
      }
    });

    // Initialize wallet variables

    // Template data
    const templates = [
      { id: 781515, pxj: 1, wuf: 22.0, pxjUpgrade: 0, name: "Pixal PFP", type: "pixals" },
      { id: 820134, pxj: 2.22, wuf: 5.0, pxjUpgrade: 0, name: "Pixel Ingredient Pack", type: "pixelpack" },
      { id: 858568, pxj: 142.0, wuf: 142.0, pxjUpgrade: 0, name: "Black", type: "primary ingredient" },
      { id: 858569, pxj: 0.42, wuf: 1.0, pxjUpgrade: 0, name: "Blue", type: "primary ingredient" },
      { id: 858570, pxj: 0.42, wuf: 1.0, pxjUpgrade: 0, name: "Red", type: "primary ingredient" },
      { id: 858571, pxj: 0.42, wuf: 1.0, pxjUpgrade: 0, name: "Yellow", type: "primary ingredient" },
      { id: 858572, pxj: 2.22, wuf: 1.0, pxjUpgrade: 25000, name: "Green", type: "secondary ingredient" },
      { id: 858573, pxj: 2.22, wuf: 1.0, pxjUpgrade: 25000, name: "Orange", type: "secondary ingredient" },
      { id: 858574, pxj: 2.22, wuf: 1.0, pxjUpgrade: 25000, name: "Purple", type: "secondary ingredient" },
      { id: 858575, pxj: 14.2, wuf: 14.2, pxjUpgrade: 150000, name: "Amber", type: "tertiary ingredient" },
      { id: 858576, pxj: 14.2, wuf: 14.2, pxjUpgrade: 150000, name: "Chartreuse", type: "tertiary ingredient" },
      { id: 858577, pxj: 14.2, wuf: 14.2, pxjUpgrade: 150000, name: "Violet", type: "tertiary ingredient" },
      { id: 858578, pxj: 14.2, wuf: 14.2, pxjUpgrade: 150000, name: "Teal", type: "tertiary ingredient" },
      { id: 858580, pxj: 14.2, wuf: 14.2, pxjUpgrade: 150000, name: "Vermillion", type: "tertiary ingredient" },
      { id: 859273, pxj: 14.2, wuf: 14.2, pxjUpgrade: 150000, name: "Magenta", type: "tertiary ingredient" }
    ];


    // Global variables
    let wallet;
    let wax;
    let anchorLink;
    let anchorSession;
    let userAccount = null;
    let stakedAssets = [];
    let userAssets = [];
    let selectedAssets = [];
    let selectedUnstakeAssets = [];
    let isLoggingOut = false;
    let autoLoginInterval = null;
    let loginAttempts = 0;
    const MAX_LOGIN_ATTEMPTS = 2;

    document.addEventListener('DOMContentLoaded', function () {

      // DOM elements
      const loginButton = document.getElementById('loginButton');
      const headerLoginButton = document.getElementById('headerLoginButton');
      const mobileLoginButton = document.getElementById('mobileLoginButton');
      const accountName = document.getElementById('accountName');
      const headerAccountName = document.getElementById('headerAccountName');
      const mobileAccountName = document.getElementById('mobileAccountName');
      const accountInfo = document.getElementById('accountInfo');
      const headerAccountInfo = document.getElementById('headerAccountInfo');
      const mobileAccountInfo = document.getElementById('mobileAccountInfo');
      const logoutButton = document.getElementById('logoutButton');
      const mobileLogoutButton = document.getElementById('mobileLogoutButton');
      const templateGrid = document.getElementById('templateGrid');
      const assetGrid = document.getElementById('assetGrid');
      const stakedAssetGrid = document.getElementById('stakedAssetGrid');
      const selectAllBtn = document.getElementById('selectAllBtn');
      const deselectAllBtn = document.getElementById('deselectAllBtn');
      const selectAllUnstakeBtn = document.getElementById('selectAllUnstakeBtn');
      const deselectAllUnstakeBtn = document.getElementById('deselectAllUnstakeBtn');
      const confirmStakeBtn = document.getElementById('confirmStakeBtn');
      const confirmUnstakeBtn = document.getElementById('confirmUnstakeBtn');
      const selectedCount = document.getElementById('selectedCount');
      const selectedUnstakeCount = document.getElementById('selectedUnstakeCount');
      const totalPowerCard = document.getElementById('totalPowerCard');
      const totalPowerValue = document.getElementById('totalPowerValue');
      const totalPxjValue = document.getElementById('totalPxjValue');
      const totalWufValue = document.getElementById('totalWufValue');
      const statsBar = document.getElementById('statsBar');
      const dashboardRow = document.getElementById('dashboardRow');
      const totalAssetsEl = document.getElementById('totalAssets');
      const stakedAssetsEl = document.getElementById('stakedAssets');
      const unstakedAssetsEl = document.getElementById('unstakedAssets');
      const templateTypesEl = document.getElementById('templateTypes');
      const templateCard = document.getElementById('templateCard');
      const darkModeToggle = document.getElementById('darkModeToggle');

      const connectionLoadingOverlay = document.getElementById('connectionLoadingOverlay');
      const connectionLoadingStatus = document.querySelector('.connection-loading-status');

  const rewardsDiv = document.getElementById('claimableRewards');
  const quickClaimSection = document.getElementById('quickClaimSection');

      // Bootstrap modals
      const assetModal = new bootstrap.Modal(document.getElementById('assetModal'));
      const unstakeModal = new bootstrap.Modal(document.getElementById('unstakeModal'));

      // Event listeners
      loginButton.addEventListener('click', function () {
        if (loginButton.textContent === 'Log Out') {
          logout();
        } else {
          login();
        }
      });

      headerLoginButton.addEventListener('click', function () {
        if (headerLoginButton.textContent === 'Log Out') {
          logout();
        } else {
          login();
        }
      });

      mobileLoginButton.addEventListener('click', function () {
        if (mobileLoginButton.textContent === 'Log Out') {
          logout();
        } else {
          login();
        }
      });

      if (logoutButton) {
        logoutButton.addEventListener('click', logout);
      }

      if (mobileLogoutButton) {
        mobileLogoutButton.addEventListener('click', logout);
      }
      selectAllBtn.addEventListener('click', selectAllAssets);
      deselectAllBtn.addEventListener('click', deselectAllAssets);
      selectAllUnstakeBtn.addEventListener('click', selectAllStakedAssets);
      deselectAllUnstakeBtn.addEventListener('click', deselectAllStakedAssets);
      confirmStakeBtn.addEventListener('click', () => stakeAssets(selectedAssets));
      confirmUnstakeBtn.addEventListener('click', () => unstakeAssets(selectedUnstakeAssets));
      darkModeToggle.addEventListener('click', toggleDarkMode);

      const transport = new AnchorLinkBrowserTransport({
        /** CSS class prefix, defaults to `anchor-link` */
        classPrefix: 'anchor-link',
        /** Whether to inject CSS styles in the page header, defaults to true. */
        injectStyles: true,
        /** Whether to display request success and error messages, defaults to true */
        requestStatus: false,
        /** Local storage prefix, defaults to `anchor-link`. */
        storagePrefix: 'anchor-link',
        /**
         * Whether to use Greymass Fuel for low resource accounts, defaults to false.
         *  Note that this service is not available on all networks, and will automatically
         *  determine based on chain id if it should be enabled or not.
         */
        disableGreymassFuel: false,
        /** Referral account to use for Greymass Fuel. */
        fuelReferrer: 'pixeljourney',
      })

      document.getElementById('claimButton').addEventListener('click', claimRewards);

      // Add event listener for Quick Claim button if it exists
      document.addEventListener('DOMContentLoaded', function() {
        const quickClaimButton = document.getElementById('quickClaimButton');
        if (quickClaimButton) {
          quickClaimButton.addEventListener('click', claimRewards);
        }
      });

      // Check if user is already logged in
      checkAutoLogin();

      // Dark mode toggle
      function toggleDarkMode() {
        // Toggle light-mode class on body
        document.body.classList.toggle('light-mode');

        // Toggle light-mode class on specific elements
        document.querySelectorAll('.card, .stats-bar, header, .modal-content, .template-info, .template-card, .footer, .apr-card').forEach(el => {
          el.classList.toggle('light-mode');
        });

        // Toggle between sun and moon emojis
        const isDarkMode = !document.body.classList.contains('light-mode');
        document.getElementById('darkModeToggle').textContent = isDarkMode ? '🌞' : '🌛';
        document.getElementById('mobileDarkModeToggle').textContent = isDarkMode ? '🌞' : '🌛';

        // Store the preference in localStorage
        localStorage.setItem('darkMode', isDarkMode ? 'true' : 'false');
      }

      // Apply saved dark mode preference on page load
      document.addEventListener('DOMContentLoaded', function() {

        const savedDarkMode = localStorage.getItem('darkMode');
        if (savedDarkMode === 'false') {
          toggleDarkMode(); // Switch to light mode if that was the saved preference
        }
      });

      // Loading progress tracking
      let currentLoadingStep = 0;
      const loadingSteps = [
        { id: 'stepWalletConnection', text: 'Connecting to wallet...', progress: 25 },
        { id: 'stepUserData', text: 'Loading user data...', progress: 50 },
        { id: 'stepInventory', text: 'Loading NFT inventory...', progress: 75 },
        { id: 'stepStakingPower', text: 'Calculating staking power...', progress: 100 }
      ];

      // Function to show loading overlay with custom message
      function showConnectionLoading(statusMessage) {
        // Reset loading state if not already displayed
        if (connectionLoadingOverlay.style.display === 'none') {
          currentLoadingStep = 0;
          document.getElementById('loadingProgressBar').style.width = '5%';

          // Reset all steps to waiting state
          loadingSteps.forEach((step, index) => {
            const stepEl = document.getElementById(step.id);
            stepEl.classList.remove('active', 'completed');
            stepEl.querySelector('.step-status').textContent = index === 0 ? 'Pending' : 'Waiting';
          });
        }

        // Update status message
        connectionLoadingStatus.textContent = statusMessage;
        connectionLoadingOverlay.style.display = 'flex';
      }

      // Function to update loading progress
      function updateLoadingProgress(step, customMessage = null) {
        if (step >= 0 && step < loadingSteps.length) {
          // Only update if we're moving forward in the steps or staying on the same step
          // This prevents steps from going backward which causes the blinking effect
          if (step >= currentLoadingStep) {
            currentLoadingStep = step;

            // Update progress bar
            document.getElementById('loadingProgressBar').style.width = loadingSteps[step].progress + '%';

            // Update loading text
            document.querySelector('.connection-loading-text').textContent = customMessage || loadingSteps[step].text;

            // Update step statuses
            loadingSteps.forEach((stepInfo, index) => {
              const stepEl = document.getElementById(stepInfo.id);
              if (index < step) {
                // Completed steps
                stepEl.classList.remove('active');
                stepEl.classList.add('completed');
                stepEl.querySelector('.step-status').textContent = 'Completed';
              } else if (index === step) {
                // Current step
                stepEl.classList.add('active');
                stepEl.classList.remove('completed');
                stepEl.querySelector('.step-status').textContent = 'In Progress';
              } else {
                // Future steps
                stepEl.classList.remove('active', 'completed');
                stepEl.querySelector('.step-status').textContent = 'Waiting';
              }
            });
          }
        }
      }

      // Function to hide loading overlay
      function hideConnectionLoading() {
        // Add fade-out animation
        connectionLoadingOverlay.style.opacity = '0';
        setTimeout(() => {
          connectionLoadingOverlay.style.display = 'none';
          connectionLoadingOverlay.style.opacity = '1';
        }, 300);
      }

      // Set up the earnings info button
      const totalPowerCardBtn = document.getElementById('totalPowerCard');
      const earningsModal = new bootstrap.Modal(document.getElementById('earningsModal'));

      if (totalPowerCardBtn) {
        totalPowerCardBtn.addEventListener('click', function () {
          updateEarningsBreakdown(); // Ensure values are up to date
          earningsModal.show();
        });
      }

      // Login function with both wallet options
      async function login() {
        try {
          // Reset connection loading overlay if coming from logout
          if (document.getElementById('connectionLoadingOverlay').style.display === 'none') {
            // Reset loading progress bar and steps
            currentLoadingStep = 0;
            document.getElementById('loadingProgressBar').style.width = '5%';

            // Reset all steps to waiting state
            loadingSteps.forEach((step, index) => {
              const stepEl = document.getElementById(step.id);
              stepEl.classList.remove('active', 'completed');
              stepEl.querySelector('.step-status').textContent = index === 0 ? 'Pending' : 'Waiting';
            });
          }

          // WAX Cloud Wallet login
          wax = new waxjs.WaxJS({
            rpcEndpoint: 'https://wax.greymass.com',
            tryAutoLogin: false // Disable auto-login to prevent conflicts
          });

          // Create wallet selection modal
          const walletChoice = await showWalletSelection();

          if (walletChoice === 'wax') {
            showConnectionLoading('Connecting to WAX Cloud Wallet...');
            updateLoadingProgress(0, 'Connecting to WAX Cloud Wallet...');
            userAccount = await wax.login();

            wallet = 'wax';
          } else if (walletChoice === 'anchor') {
            showConnectionLoading('Connecting to Anchor Wallet...');
            updateLoadingProgress(0, 'Connecting to Anchor Wallet...');
            // Anchor Wallet login
            anchorLink = new AnchorLink({
              transport,
              chains: [
                {
                  chainId: '1064487b3cd1a897ce03ae5b6a865651747e2e152090f99c1d19d44e01aea5a4',
                  nodeUrl: 'https://wax.greymass.com',
                },
              ],
            });

            const identity = await anchorLink.login('pixeljourney');
            anchorSession = identity.session;
            userAccount = identity.session.auth.toString().split('@')[0];
            wallet = 'anchor';
          }
          else if (walletChoice === 'wombat') {
            showConnectionLoading('Connecting to Wombat Wallet...');
            updateLoadingProgress(0, 'Connecting to Wombat Wallet...');
            userAccount = await loginWithWombat();
            wallet = 'wombat';
          } else {
            hideConnectionLoading();
            return; // User cancelled
          }

          // Update loading progress to user data step
          updateLoadingProgress(1, 'Loading user data...');

          // Common post-login actions
          // Update all account displays
          accountName.textContent = userAccount;
          headerAccountName.textContent = userAccount;
          mobileAccountName.textContent = userAccount;
          mobileHeaderAccountName.textContent = userAccount;


  // Show quick claim section after wallet connection
  quickClaimSection.style.display = 'block';

          // Show account info sections
          accountInfo.style.display = 'block';
          headerAccountInfo.style.display = 'flex';
          mobileAccountInfo.style.display = 'block';
          mobileHeaderAccount.style.display = 'flex';

          // Hide mobile connection card as it's no longer needed after login
          document.getElementById('mobileConnectionCard').style.display = 'none';

          // Update PXJ balance and start refresh interval
          startBalanceRefresh();

          // Show account info sections
          accountInfo.style.display = 'block';
          headerAccountInfo.style.display = 'flex';
          mobileAccountInfo.style.display = 'block';

          // Update login buttons
          loginButton.textContent = 'Log Out';
          headerLoginButton.style.display = 'none';
          mobileLoginButton.style.display = 'none';
          loginButton.classList.remove('btn');
          loginButton.classList.add('logout-btn');

          // Don't show dashboard row until inventory is loaded
          dashboardRow.style.display = 'none';

          // Update loading progress to inventory step
          updateLoadingProgress(2, 'Loading NFT inventory...');

          // Load staked assets
          await fetchStakedAssets();

          // Fetch rewards immediately after login
          await fetchClaimableRewards();

          // Show rewards section as soon as it's ready
          document.getElementById('rewardsSection').style.display = 'block';

          // Update loading progress to staking power step
          updateLoadingProgress(3, 'Calculating staking power...');

          // Show UI elements
          totalPowerCard.style.display = 'block';
          templateCard.style.display = 'block';


          // Show all templates in greyed out form
          updateTemplateGridWithAllTemplates();

          // Load user inventory automatically
          await loadUserInventory();


          // Complete loading process
          hideConnectionLoading();
        } catch (error) {
          hideConnectionLoading();
          showErrorMessage('Failed to login. Please try again.');
        }
      }

      async function loginWithWombat() {
        return new Promise((resolve, reject) => {
          // Check if Wombat is installed
          if (!window.wombat) {
            showErrorMessage('Wombat Wallet not detected. Please install it first.');
            reject(new Error('Wombat Wallet not detected'));
            return;
          }

          // Wombat login flow
          window.wombat.getUserAccount().then(account => {
            if (account) {
              resolve(account);
            } else {
              // If no active session, request login
              window.wombat.requestLogin().then(account => {
                if (account) {
                  resolve(account);
                } else {
                  reject(new Error('User cancelled login'));
                }
              }).catch(err => {
                reject(err);
              });
            }
          }).catch(err => {
            reject(err);
          });
        });
      }

      // Show wallet selection modal
      function showWalletSelection() {
        return new Promise((resolve) => {
          const modal = document.createElement('div');
          modal.style.position = 'fixed';
          modal.style.top = '0';
          modal.style.left = '0';
          modal.style.right = '0';
          modal.style.bottom = '0';
          modal.style.backgroundColor = 'rgba(0,0,0,0.7)';
          modal.style.display = 'flex';
          modal.style.justifyContent = 'center';
          modal.style.alignItems = 'center';
          modal.style.zIndex = '99999';

          modal.innerHTML = `
      <div style="background: var(--card-dark); padding: 30px; border-radius: var(--radius-md); text-align: center; max-width: 400px; width: 90%;">
        <h3 style="margin-top: 0;">Select Wallet</h3>
        <button id="waxWalletBtn" style="margin: 10px; padding: 15px; width: 100%;" class="btn">
          <img src="https://waxblock.io/common/images/mycloudwallet.png" style="height: 24px; vertical-align: middle; margin-right: 10px;">
          WAX Cloud Wallet
        </button>
        <button id="anchorWalletBtn" style="margin: 10px; padding: 15px; width: 100%;" class="btn">
          <img src="https://play-lh.googleusercontent.com/DVLJnVhhOe99bwJjZ-00lAeaw-rqPPj2HRmlXOC0cr-xAOcWkjy8NuLGjB0kMdMBlg" style="height: 24px; vertical-align: middle; margin-right: 10px;">
          Anchor Wallet
        </button>
        <button id="wombatWalletBtn" style="margin: 10px; padding: 15px; width: 100%;" class="btn">
          <img src="https://www.yadawallets.com/wp-content/uploads/2020/11/Wombat-wallet-logo.png" style="height: 24px; vertical-align: middle; margin-right: 10px;">
          Wombat Wallet
        </button>
        <button id="cancelWalletBtn" style="margin: 10px; padding: 15px; width: 100%;" class="btn btn-secondary">
          Cancel
        </button>
      </div>
    `;

          document.body.appendChild(modal);

          document.getElementById('waxWalletBtn').addEventListener('click', () => {
            document.body.removeChild(modal);
            resolve('wax');
          });

          document.getElementById('anchorWalletBtn').addEventListener('click', () => {
            document.body.removeChild(modal);
            resolve('anchor');
          });

          document.getElementById('wombatWalletBtn').addEventListener('click', () => {
            document.body.removeChild(modal);
            resolve('wombat');
          });

          document.getElementById('cancelWalletBtn').addEventListener('click', () => {
            document.body.removeChild(modal);
            resolve(null);
          });
        });
      }

      // Check if user is already logged in
      async function checkAutoLogin() {
        if (isLoggingOut) return;

        try {
          // Check WAX Cloud Wallet first
          wax = new waxjs.WaxJS({
            rpcEndpoint: 'https://wax.greymass.com',
            tryAutoLogin: true
          });

          // First try WAX Cloud Wallet auto-login
          const isWaxAutoLogin = await wax.isAutoLoginAvailable();
          if (isWaxAutoLogin) {
            showConnectionLoading('Checking for existing session...');
            updateLoadingProgress(0, 'Checking for existing session...');
            userAccount = wax.userAccount;

            // Update loading progress to user data step
            updateLoadingProgress(1, 'Loading user data...');

            // Update all account displays
            accountName.textContent = userAccount;
            headerAccountName.textContent = userAccount;
            mobileAccountName.textContent = userAccount;
            mobileHeaderAccountName.textContent = userAccount;

            // Show account info sections
            accountInfo.style.display = 'block';
            headerAccountInfo.style.display = 'flex';
            mobileAccountInfo.style.display = 'block';
            mobileHeaderAccount.style.display = 'flex';


  // Show quick claim section after wallet connection
  quickClaimSection.style.display = 'block';

            // Update login buttons
            loginButton.textContent = 'Log Out';
            headerLoginButton.style.display = 'none';
            mobileLoginButton.style.display = 'none';
            loginButton.classList.remove('btn');
            loginButton.classList.add('logout-btn');

            // Update PXJ balance and start refresh interval
            startBalanceRefresh();

            // Don't show dashboard row until inventory is loaded
            dashboardRow.style.display = 'none';

            // Update loading progress to inventory step
            updateLoadingProgress(2, 'Loading NFT inventory...');

            // Load staked assets
            await fetchStakedAssets();

            // Fetch rewards immediately after login
            await fetchClaimableRewards();

            // Show rewards section as soon as it's ready
            document.getElementById('rewardsSection').style.display = 'block';

            // Update loading progress to staking power step
            updateLoadingProgress(3, 'Calculating staking power...');

            // Show UI elements
            totalPowerCard.style.display = 'block';
            templateCard.style.display = 'block';


            // Show all templates in greyed out form
            updateTemplateGridWithAllTemplates();

            // Load user inventory automatically
            await loadUserInventory();

            // Complete loading process
            hideConnectionLoading();
            return;
          }



          // Initialize AnchorLink if not already done
          if (!anchorLink) {
            anchorLink = new AnchorLink({
              transport: new AnchorLinkBrowserTransport(),
              chains: [{
                chainId: '1064487b3cd1a897ce03ae5b6a865651747e2e152090f99c1d19d44e01aea5a4',
                nodeUrl: 'https://wax.greymass.com',
              }],
            });
          }

          // Try to restore session
          const session = await anchorLink.restoreSession('pixeljourney');
          if (session) {
            // If WAX auto-login not available, try Anchor Wallet
            showConnectionLoading('Checking Anchor Wallet session...');
            updateLoadingProgress(0, 'Checking Anchor Wallet session...');
            anchorSession = session;
            userAccount = session.auth.toString().split('@')[0];

            // Update loading progress to user data step
            updateLoadingProgress(1, 'Loading user data...');

            // Update all account displays
            accountName.textContent = userAccount;
            headerAccountName.textContent = userAccount;
            mobileAccountName.textContent = userAccount;
            mobileHeaderAccountName.textContent = userAccount;

            // Show account info sections
            accountInfo.style.display = 'block';
            headerAccountInfo.style.display = 'flex';
            mobileAccountInfo.style.display = 'block';
            mobileHeaderAccount.style.display = 'flex';

            // Update login buttons
            loginButton.textContent = 'Log Out';
            headerLoginButton.style.display = 'none';
            mobileLoginButton.style.display = 'none';
            loginButton.classList.remove('btn');
            loginButton.classList.add('logout-btn');

                  // Update immediately
      updateBalanceDisplay();

            // Update loading progress to inventory step
            updateLoadingProgress(2, 'Loading NFT inventory...');

            // Show rewards section as soon as it's ready
            document.querySelector('.rewards-section').style.display = 'block';

            // Don't show dashboard row until inventory is loaded
            dashboardRow.style.display = 'none';

            // Update loading progress to staking power step
            updateLoadingProgress(3, 'Calculating staking power...');

            // Show UI elements
            totalPowerCard.style.display = 'block';
            // statsBar is now hidden by default
            templateCard.style.display = 'block';

            // Fetch staked assets (this is quick)
            await fetchStakedAssets();
            await fetchClaimableRewards();


            // Show all templates in greyed out form
            updateTemplateGridWithAllTemplates();

            // Load user inventory automatically
            await loadUserInventory();

            // Complete loading process
            hideConnectionLoading();
          }

          // Finally try Wombat Wallet
          if (window.wombat) {
            showConnectionLoading('Checking Wombat Wallet session...');
            const account = await window.wombat.getUserAccount();
            if (account) {
              userAccount = account;
              wallet = 'wombat';

              // Update all account displays
              accountName.textContent = userAccount;
              headerAccountName.textContent = userAccount;
              mobileAccountName.textContent = userAccount;
              mobileHeaderAccountName.textContent = userAccount;

              // Show account info sections
              accountInfo.style.display = 'block';
              headerAccountInfo.style.display = 'flex';
              mobileAccountInfo.style.display = 'block';
              mobileHeaderAccount.style.display = 'flex';


  // Show quick claim section after wallet connection
  quickClaimSection.style.display = 'block';

              // Update login buttons
              loginButton.textContent = 'Log Out';
              headerLoginButton.style.display = 'none';
              mobileLoginButton.style.display = 'none';
              loginButton.classList.remove('btn');
              loginButton.classList.add('logout-btn');

              // Update PXJ balance and start refresh interval
              startBalanceRefresh();

              // Update loading progress to inventory step
              updateLoadingProgress(2, 'Loading NFT inventory...');

              // Don't show dashboard row until inventory is loaded
              dashboardRow.style.display = 'none';

              // Load staked assets
              await fetchStakedAssets();

              // Fetch rewards immediately after login
              await fetchClaimableRewards();

              // Show rewards section as soon as it's ready
              document.querySelector('.rewards-section').style.display = 'block';

              // Update loading progress to staking power step
              updateLoadingProgress(3, 'Calculating staking power...');

              // Show UI elements
              totalPowerCard.style.display = 'block';
              templateCard.style.display = 'block';


              // Show all templates in greyed out form
              updateTemplateGridWithAllTemplates();
              // Load user inventory automatically
              await loadUserInventory();

              // Complete loading process
              hideConnectionLoading();
              return;
            }
          }
        } catch (error) {
          hideConnectionLoading();
          showErrorMessage('Auto login error:', error);
          // Don't show error message to user for auto-login failures
        }


      }

      // Modified logout function
      async function logout() {
        try {
          isLoggingOut = true;
          loginAttempts = 0; // Reset attempt counter

          // Clear any pending auto-login checks
          if (autoLoginInterval) {
            clearInterval(autoLoginInterval);
            autoLoginInterval = null;
          }

          // Disable WaxJS auto-login completely
          if (wax) {
            try {
              // First disable auto-login
              wax.autoLogin = false;

              // Then perform logout
              if (typeof wax.logout === 'function') {
                await wax.logout();
              }

              // Force WaxJS to forget user
              wax.userAccount = null;
            } catch (e) {
              console.warn('WaxJS logout cleanup error:', e);
            }
          }

          // Anchor Wallet cleanup
          if (anchorLink && anchorSession) {
            try {
              await anchorLink.removeSession('pixeljourney', anchorSession.auth);
            } catch (e) {
              console.warn('Anchor logout cleanup error:', e);
            }
          }
          /*
                        // Wombat Wallet cleanup
              if (wallet === 'wombat' && window.wombat) {
                try {
                  await window.wombat.logout();
                } catch (e) {
                  console.warn('Wombat logout cleanup error:', e);
                }
              } */

          // Clear all references
          wax = null;
          anchorLink = null;
          anchorSession = null;
          userAccount = null;
          stakedAssets = [];
          userAssets = [];

          // Clear balance refresh interval
          if (balanceRefreshInterval) {
            clearInterval(balanceRefreshInterval);
            balanceRefreshInterval = null;
          }

          // UI cleanup
          updateUIAfterLogout();
          showSuccessMessage('Logged out successfully');

        } catch (error) {
          showErrorMessage('Logout failed. Please try again.');
        } finally {
          // Small delay before allowing new logins
          setTimeout(() => {
            isLoggingOut = false;

            hideConnectionLoading();
          }, 3000);
        }
      }

      function updateUIAfterLogout() {
        // Hide account info sections
        accountInfo.style.display = 'none';
        headerAccountInfo.style.display = 'none';
        mobileAccountInfo.style.display = 'none';
        document.getElementById('mobileHeaderAccount').style.display = 'none';

        // Show mobile connection card again
        document.getElementById('mobileConnectionCard').style.display = 'block';

        // Reset login buttons
        loginButton.textContent = 'Connect Wallet';
        headerLoginButton.textContent = 'Connect Wallet';
        mobileLoginButton.textContent = 'Connect Wallet';
        headerLoginButton.style.display = 'block';
        mobileLoginButton.style.display = 'block';
        loginButton.classList.remove('logout-btn');
        loginButton.classList.add('btn');

        // Reset PXJ balance display
        const pxjBalanceElement = document.getElementById('pxjBalance');
        if (pxjBalanceElement) {
          pxjBalanceElement.textContent = '0.0';
        }

        // Reset mobile header PXJ balance
        const mobileHeaderPxjBalance = document.getElementById('mobileHeaderPxjBalance');
        if (mobileHeaderPxjBalance) {
          mobileHeaderPxjBalance.textContent = '0.0';
        }

        // Hide UI elements
        totalPowerCard.style.display = 'none';
        statsBar.style.display = 'none';
        templateCard.style.display = 'none';
        document.getElementById('rewardsSection').style.display = 'none';
        dashboardRow.style.display = 'none';
        templateGrid.innerHTML = '';
        hideConnectionLoading();
      }

      // Global variables for simulation
      let simulationInterval = null;
      let userRatesPerHour = [];
      let lastFetchedRewards = [];
      let simulationStartTime = null;

      // Function to start simulation
      function startSimulation() {
        if (!userRatesPerHour || userRatesPerHour.length === 0) {
          return;
        }

        // Clear any existing interval
        if (simulationInterval) {
          clearInterval(simulationInterval);
        }
        const HOUR_IN_MS = 60 * 60 * 1000; // 1 hour in milliseconds
        simulationStartTime = Math.floor(Date.now() / HOUR_IN_MS) * HOUR_IN_MS;

        // Start the simulation interval (update every second)
        simulationInterval = setInterval(updateSimulatedRewards, 1000);

        // Run once immediately
        updateSimulatedRewards();
      }


      // Function to update simulated rewards
      function updateSimulatedRewards() {
        if (!simulationStartTime || !userRatesPerHour || userRatesPerHour.length === 0) {
          return;
        }

        const elapsedSeconds = (Date.now() - simulationStartTime) / 1000;
        const elapsedHours = elapsedSeconds / 3600;

        // Check if less than 1 hour has passed since last claim
        const isLessThanOneHour = elapsedHours < 1;

        let simulatedRewards;

        // If lastFetchedRewards is empty (after claiming), calculate from zero
        if (!lastFetchedRewards || lastFetchedRewards.length === 0) {
          simulatedRewards = userRatesPerHour.map(rate => {
            const [amountStr, symbol] = rate.quantity.split(" ");
            const rateNum = parseFloat(amountStr);
            const precision = amountStr.split(".")[1]?.length || 0;

            // Calculate earned amount based on elapsed time
            const earned = (rateNum * elapsedHours).toFixed(precision);

            return {
              quantity: `${earned} ${symbol}`,
              contract: rate.contract
            };
          });
        } else {
          // Calculate simulated rewards based on rates per hour and initial rewards
          simulatedRewards = lastFetchedRewards.map(initialReward => {
          const [initialAmount, symbol] = initialReward.quantity.split(' ');
          const initialAmountFloat = parseFloat(initialAmount);

          // Find matching rate for this token
          const matchingRate = userRatesPerHour.find(rate => {
            const [, rateSymbol] = rate.quantity.split(' ');
            return rateSymbol === symbol;
          });

          if (matchingRate) {
            const [rateAmountStr, ] = matchingRate.quantity.split(' ');
            const rateNum = parseFloat(rateAmountStr);
            const precision = initialAmount.split(".")[1]?.length || 0;

            // Calculate additional earned amount based on elapsed time
            const additionalEarned = rateNum * elapsedHours;

            // Add to initial amount
            const totalAmount = (initialAmountFloat + additionalEarned).toFixed(precision);

            return {
              quantity: `${totalAmount} ${symbol}`,
              contract: initialReward.contract
            };
          }

          return initialReward;
        });
      }

        // Format and display the simulated rewards
        if (simulatedRewards && simulatedRewards.length > 0) {
          let formattedRewards = [];

          // Process each token balance
          simulatedRewards.forEach(balance => {
            // Extract token amount and symbol
            const [amount, symbol] = balance.quantity.split(' ');

            // Format to at most 1 decimal place
            const formattedAmount = parseFloat(amount).toFixed(1);

            // Add to formatted rewards array
            formattedRewards.push(`${symbol}: ${formattedAmount}`);
          });

          // Join with pipe separator
          const rewardsText = formattedRewards.join(' | ');

          // Check if rewards are below hourly rate and less than 1 hour has passed
          let belowHourlyRate = false;
          if (isLessThanOneHour) {
            belowHourlyRate = simulatedRewards.every((reward, index) => {
              const [amount, symbol] = reward.quantity.split(' ');
              const rewardAmount = parseFloat(amount);

              // Find matching rate for this token
              const matchingRate = userRatesPerHour.find(rate => {
                const [, rateSymbol] = rate.quantity.split(' ');
                return rateSymbol === symbol;
              });

              if (matchingRate) {
                const [rateAmount, ] = matchingRate.quantity.split(' ');
                const hourlyRate = parseFloat(rateAmount);
                return rewardAmount < hourlyRate;
              }
              return false;
            });
          }

          // Display countdown if needed
          if (isLessThanOneHour && belowHourlyRate) {
            // Calculate time until next hour
            const nextHourMs = Math.ceil(Date.now() / (60 * 60 * 1000)) * (60 * 60 * 1000);
            const timeUntilNextHour = nextHourMs - Date.now();
            const minutesRemaining = Math.floor(timeUntilNextHour / (60 * 1000));
            const secondsRemaining = Math.floor((timeUntilNextHour % (60 * 1000)) / 1000);

            // Format countdown
            const countdownText = `${minutesRemaining}m ${secondsRemaining}s until next reward`;
            rewardsDiv.innerHTML = `${rewardsText}<br><span class="countdown">${countdownText}</span>`;

            // Disable claim buttons
            document.getElementById('claimButton').disabled = true;
            if (document.getElementById('quickClaimButton')) {
              document.getElementById('quickClaimButton').disabled = true;
            }
          } else {
            rewardsDiv.innerHTML = rewardsText;
          }
        }
      }

      async function fetchClaimableRewards() {

  if (!userAccount) {
    rewardsDiv.innerHTML = 'Please log in to see rewards.';
    return;
  }

  rewardsDiv.innerHTML = 'Loading rewards...';
  console.log("Fetching rewards for account:", userAccount);

  // Update loading progress if the loading overlay is visible
  const connectionLoadingOverlay = document.getElementById('connectionLoadingOverlay');
  if (connectionLoadingOverlay && connectionLoadingOverlay.style.display === 'flex') {
    updateLoadingProgress(3, 'Calculating claimable rewards...');
  }

  try {
    const url = "https://api.hivebp.io/v1/chain/get_table_rows";

    const payload = {
      table: "stakers",
      scope: "farms.waxdao",
      code: "farms.waxdao",
      limit: 1000,
      key_type: "name",
      index_position: 3,
      lower_bound: userAccount,
      upper_bound: userAccount,
      json: true
    };

    let allRows = [];
    let nextKey = "";

    // Fetch all pages of results
    while (true) {
      if (nextKey) {
        payload.lower_bound = nextKey;
      }

      const response = await fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const data = await response.json();
      allRows = [...allRows, ...data.rows];

      if (data.more) {
        nextKey = data.next_key;
      } else {
        break;
      }
    }

    console.log("Fetched", allRows.length, "rows for user", userAccount);

    // Find the pixeljourney farm for this user
    const pixeljourneyFarm = allRows.find(row => row.farmname === "pixeljourney");

    if (pixeljourneyFarm) {
      console.log("Found pixeljourney farm data:", pixeljourneyFarm);

      // Calculate claimable rewards based on rates and elapsed time
      const now = Math.floor(Date.now() / 1000);
      const elapsedSeconds = now - pixeljourneyFarm.last_state_change;
      const elapsedHours = elapsedSeconds / 3600;

      console.log("Time since last claim:", elapsedHours.toFixed(2), "hours");

      // Check if the farm has rates_per_hour defined
      if (pixeljourneyFarm.rates_per_hour && pixeljourneyFarm.rates_per_hour.length > 0) {
        // Get API-returned claimable balances if available
        const apiClaimableBalances = pixeljourneyFarm.claimable_balance || [];
        console.log("API-returned claimable balances:", apiClaimableBalances);

        // Store rates_per_hour for simulation - only for staked assets
        console.log("Staked assets:", stakedAssets);

        // Get staked asset IDs
        const stakedAssetIds = stakedAssets.map(asset => asset.asset_id);
        console.log("Staked asset IDs:", stakedAssetIds);

        // Get staked template IDs by finding the corresponding assets in userAssets
        const stakedTemplateIds = [];
        stakedAssets.forEach(stakedAsset => {
          const asset = userAssets.find(a => a.asset_id === stakedAsset.asset_id);
          if (asset && asset.template && asset.template.template_id) {
            stakedTemplateIds.push(parseInt(asset.template.template_id));
          }
        });
        console.log("Staked template IDs:", stakedTemplateIds);

        // Log the original rates for debugging
        console.log("Original rates_per_hour:", pixeljourneyFarm.rates_per_hour);

        // Filter the rates to only include those for staked assets
        // This is a simplified approach - the actual filtering logic may need to be adjusted
        // based on how rates are associated with templates or assets in your system
        userRatesPerHour = pixeljourneyFarm.rates_per_hour;

        console.log("Filtered rates_per_hour for staked assets only:", userRatesPerHour);

        // Calculate our own claimable balances based on rates and elapsed time
        const calculatedClaimableBalances = pixeljourneyFarm.rates_per_hour.map(rate => {
          const [amountStr, symbol] = rate.quantity.split(" ");
          const rateNum = parseFloat(amountStr);
          const precision = amountStr.split(".")[1]?.length || 0;
          let earned = (rateNum * Math.floor(elapsedHours)).toFixed(precision);

          return {
            quantity: `${earned} ${symbol}`,
            contract: rate.contract
          };
        });

        console.log("Calculated claimable balances:", calculatedClaimableBalances);

        // Compare API-returned balances with calculated balances and use the greater value
        const claimableBalances = calculatedClaimableBalances.map(calcBalance => {
          const [calcAmount, calcSymbol] = calcBalance.quantity.split(' ');

          // Find matching token in API-returned balances
          const apiBalance = apiClaimableBalances.find(apiBalance => {
            const [, apiSymbol] = apiBalance.quantity.split(' ');
            return apiSymbol === calcSymbol;
          });

          if (apiBalance) {
            const [apiAmount, apiSymbol] = apiBalance.quantity.split(' ');
            const apiAmountFloat = parseFloat(apiAmount);
            const calcAmountFloat = parseFloat(calcAmount);

            // Use the greater of the two values
            if (apiAmountFloat > calcAmountFloat) {
              console.log(`Using API value for ${apiSymbol}: ${apiAmount} (calculated: ${calcAmount})`);
              return apiBalance;
            }
          }

          // Default to calculated balance if API balance is not available or smaller
          return calcBalance;
        });

        console.log("Calculated claimable balances:", claimableBalances);

        // Store the last fetched rewards for simulation
        lastFetchedRewards = [...claimableBalances];

        // Format and display the rewards
          if (claimableBalances && claimableBalances.length > 0) {
            let formattedRewards = [];

            // Process each token balance
            claimableBalances.forEach(balance => {
              // Extract token amount and symbol
              const [amount, symbol] = balance.quantity.split(' ');

              // Format to at most 1 decimal place
              const formattedAmount = parseFloat(amount).toFixed(1);

              // Add to formatted rewards array
              formattedRewards.push(`${symbol}: ${formattedAmount}`);
            });

            // Join with pipe separator
            const rewardsText = formattedRewards.join(' | ');
            rewardsDiv.innerHTML = rewardsText;

            // Enable claim button if any rewards are greater than zero
            const hasClaimableTokens = claimableBalances.some(balance => {
              const [amount, symbol] = balance.quantity.split(' ');
              return parseFloat(amount) > 0;
            });

             // startSimulation();


            // document.getElementById('claimButton').disabled = !hasClaimableTokens;
            if (document.getElementById('quickClaimButton')) {
              document.getElementById('quickClaimButton').disabled = !hasClaimableTokens;
            }
          } else {
            const noRewardsText = 'No claimable rewards found.';
            rewardsDiv.innerHTML = noRewardsText;
            document.getElementById('claimButton').disabled = true;
            if (document.getElementById('quickClaimButton')) {
              document.getElementById('quickClaimButton').disabled = true;
            }
          }
      } else {
        console.log("No rates_per_hour found for farm");
        rewardsDiv.innerHTML = 'No reward rates configured for this farm.';
        document.getElementById('claimButton').disabled = true;
      }
    } else {
      console.log("No matching stake found for user", userAccount, "in pixeljourney farm");
      const noStakeText = 'No staking position found.';
      rewardsDiv.innerHTML = noStakeText;
      document.getElementById('claimButton').disabled = true;
      if (document.getElementById('quickClaimButton')) {
        document.getElementById('quickClaimButton').disabled = true;
      }
    }
  } catch (error) {
    console.error('Error fetching rewards:', error);
    const errorText = 'Error loading rewards. Please try again.';
    rewardsDiv.innerHTML = errorText;
    document.getElementById('claimButton').disabled = true;
    if (document.getElementById('quickClaimButton')) {
      document.getElementById('quickClaimButton').disabled = true;
    }
  }
}

      async function claimRewards() {
        if (!userAccount) return showErrorMessage('Please log in first.');
        try {
          const action = {
            account: 'farms.waxdao',
            name: 'claim',
            authorization: [{ actor: userAccount, permission: 'active' }],
            data: {
              user: userAccount,
              farmname: 'pixeljourney'
            }
          };

          let result;
          if (wax && wax.api) {
            // WAX Cloud Wallet
            result = await wax.api.transact({
              actions: [action]
            }, {
              blocksBehind: 3,
              expireSeconds: 30
            });
          } else if (anchorLink && anchorSession) {
            // Anchor Wallet
            result = await anchorSession.transact({ action });
          } else {
            throw new showErrorMessage('No wallet connected');
          }

          showSuccessMessage('Rewards claimed successfully!', result);

          rewardsDiv.innerHTML = 'PXJ: 0.0 | WUF: 0.0';


          // Reset last fetched rewards
          lastFetchedRewards = [];

          // Update the PXJ balance display after claiming
          setTimeout(() => {
            updateBalanceDisplay();
            // Restart simulation after claiming
            simulationStartTime = Date.now();
           // startSimulation();
          }, 50); // delay to allow blockchain to update
        } catch (error) {
          showErrorMessage('Failed to claim rewards. Please try again.');
        }
      }

      // Fetch staked assets
      // Upgraded fetchStakedAssets function
      // Fetch staked assets
      async function fetchStakedAssets() {
        if (!userAccount) return;

        try {
          // Update loading progress if the loading overlay is visible
          const connectionLoadingOverlay = document.getElementById('connectionLoadingOverlay');
          if (connectionLoadingOverlay && connectionLoadingOverlay.style.display === 'flex') {
            updateLoadingProgress(2, 'Loading staked NFTs...');
          }

          stakedAssets = [];
          let lower_bound = '';
          let more = true;

          // Create a new wax instance if needed (without login)
          let rpcEndpoint;
          if (!wax) {
            wax = new waxjs.WaxJS({
              rpcEndpoint: 'https://wax.greymass.com',
              tryAutoLogin: false
            });
          }

          // Use the wax.rpc regardless of login method
          const rpc = wax.rpc;

          while (more) {
            const result = await rpc.get_table_rows({
              code: 'farms.waxdao',
              scope: 'farms.waxdao',
              table: 'stakednfts',
              limit: 1000,
              lower_bound,
              json: true
            });

            for (const row of result.rows) {
              if (row.owner === userAccount && row.farmname === 'pixeljourney') {
                stakedAssets.push(row);
              }
            }

            more = result.more;
            if (more) lower_bound = result.next_key;
          }

        } catch (error) {
          showErrorMessage('Failed to fetch staked assets.');
        }
      }

      // Load user assets with progress reporting
      async function loadUserAssets(reportProgress = false) {
        if (!userAccount) return;

        try {
          // Update loading progress if the loading overlay is visible and not using internal progress reporting
          const connectionLoadingOverlay = document.getElementById('connectionLoadingOverlay');
          if (connectionLoadingOverlay && connectionLoadingOverlay.style.display === 'flex' && !reportProgress) {
            updateLoadingProgress(2, 'Loading NFT inventory...');
          }

          userAssets = [];
          let page = 1;
          let totalAssets = 0;
          let loadedAssets = 0;

          // First, get the total count of assets (for progress calculation)
          if (reportProgress) {
            try {
              const countResponse = await fetch(`https://atomic-wax.a-dex.xyz/atomicassets/v1/accounts/${userAccount}?collection_name=pixeljourney`);
              const countData = await countResponse.json();
              if (countData.data && countData.data.assets) {
                totalAssets = countData.data.assets;
              }
            } catch (e) {
              console.error('Error getting asset count:', e);
              // Continue anyway, we'll just show indeterminate progress
            }
          }

          while (true) {
            // Check if loading was cancelled
            if (window.cancelLoading) {
              console.log('Loading cancelled by user');
              return;
            }

            const response = await fetch(`https://atomic-wax.a-dex.xyz/atomicassets/v1/assets?owner=${userAccount}&collection_name=pixeljourney&limit=1000&page=${page}`);
            const data = await response.json();
            const pageAssets = data.data;

            if (!pageAssets.length) break;

            userAssets = userAssets.concat(pageAssets);
            loadedAssets += pageAssets.length;
            page++;

            // Update progress if reporting is enabled
            if (reportProgress) {
              const progressBar = document.getElementById('loadingProgressBar');
              const progressText = document.getElementById('loadingProgressText');

              if (progressBar && progressText) {
                let percentComplete = totalAssets > 0 ? Math.round((loadedAssets / totalAssets) * 100) : Math.min(95, page * 10);
                progressBar.style.width = `${percentComplete}%`;
                progressText.textContent = `Loading inventory... ${percentComplete}%`;
              }
            }
          }

          // Complete the progress bar
          if (reportProgress) {
            const progressBar = document.getElementById('loadingProgressBar');
            const progressText = document.getElementById('loadingProgressText');

            if (progressBar && progressText) {
              progressBar.style.width = '100%';
              progressText.textContent = 'Loading complete!';

              // Remove the loading indicator after a short delay
              setTimeout(() => {
                const loadingContainer = document.querySelector('.loading-progress');
                if (loadingContainer) {
                  loadingContainer.parentNode.remove();
                }
              }, 300);
            }
          }

        } catch (error) {
          showErrorMessage('Failed to load your assets.');
          throw error; // Re-throw to allow caller to handle
        }
      }

      // Function to automatically load user inventory
      async function loadUserInventory() {
        try {
          // Reset cancel flag
          window.cancelLoading = false;

          // Load user assets without showing separate progress
          await loadUserAssets(false);

          // Update the UI with loaded assets
          updateTemplateGrid();
          updateStats();

          // Show dashboard row now that inventory is loaded
          dashboardRow.style.display = 'flex';

          return true;
        } catch (error) {
          console.error('Error loading inventory:', error);
          showErrorMessage('Failed to load inventory automatically.');
          return false;
        }
      }

      // Function to display all templates in greyed-out form
      function updateTemplateGridWithAllTemplates() {
        if (!userAccount || !templateGrid) return;

        templateGrid.innerHTML = '';

        // Display all templates in greyed-out form
        templates.forEach(template => {
          const card = document.createElement('div');
          card.className = 'template-card greyed-out';

          // Check if we have a video for this template
          const templateVideos = {
            '858575': './ingredients/Pixel_Amber_vid_25fps_300px.mp4', // amber
            '858576': './ingredients/Pixel_Chartreuse_vid_25fps_300px.mp4', // chartreuse
            '858577': './ingredients/Pixel_Violet_vid_25fps_300px.mp4', // violet
            '858578': './ingredients/Pixel_Teal_vid_25fps_300px.mp4', // teal
            '858580': './ingredients/Pixel_Vermillion_vid_25fps_300px.mp4', // vermillion
            '859273': './ingredients/Pixel_Magenta_vid_25fps_300px.mp4', // magenta
            '858574': './ingredients/Pixel_Purple_vid_25fps_300px.mp4', // purple
            '858573': './ingredients/Pixel_Orange_vid_25fps_300px.mp4', // orange
            '858572': './ingredients/Pixel_Green_vid_25fps_300px.mp4', // green
            '858570': './ingredients/Pixel_Red_vid_25fps_300px.mp4', // red
            '858569': './ingredients/Pixel_Blue_vid_25fps_300px.mp4', // blue
            '858571': './ingredients/Pixel_Yellow_vid_25fps_300px.mp4', // yellow
            '858568': './ingredients/Pixel_Black_White_vid_25fps_300px.mp4', // black
          };

          const videoUrl = templateVideos[template.id];
          let templateImageHtml = '';

          if (videoUrl) {
            templateImageHtml = `
              <div class="template-image video-bg">
                <video autoplay loop muted playsinline>
                  <source src="${videoUrl}" type="video/mp4">
                </video>
              </div>
            `;
          } else {
            // Special handling for specific template IDs
            let imageUrl = '';
            if (template.id === 820134) {
              // Pixelpacks template
              imageUrl = './ingredients/pixelpack.webp';
            } else if (template.id === 781515) {
              // PixalPFPs template
              imageUrl = './img/pixelgrey-bluebg-spliteyes.png';
            }

            if (imageUrl) {
              templateImageHtml = `
                <div class="template-image img-asset-bg" style="background-image: url(${imageUrl})">
                </div>
              `;
            } else {
              // Default placeholder for templates without images
              templateImageHtml = `
                <div class="template-image img-asset-bg">
                  <div class="placeholder-image">?</div>
                </div>
              `;
            }
          }

          // Determine where to link for buying or crafting
          let marketUrl = '';
          if (template.type === 'Pixel') {
            marketUrl = 'https://wax.atomichub.io/market?collection_name=pixeljourney&schema_name=pixels&template_id=' + template.id;
          } else {
            marketUrl = 'https://wax.atomichub.io/market?collection_name=pixeljourney&template_id=' + template.id;
          }

          card.innerHTML = `
            ${templateImageHtml}
            <div class="asset-count">0 owned</div>
            <div class="template-info">
              <div class="template-name">${template.name}</div>
              <div class="template-type">${template.type}</div>
              <div class="template-stats">
                <div>
                  <div class="stat-value">${template.pxj}</div>
                  <div class="stat-label">PXJ</div>
                </div>
                <div>
                  <div class="stat-value">${template.wuf}</div>
                  <div class="stat-label">WUF</div>
                </div>
              </div>
              <div class="template-actions">
                <a href="${marketUrl}" target="_blank" class="btn btn-secondary">Buy on Market</a>
              </div>
            </div>
          `;

          templateGrid.appendChild(card);
        });

        // Add CSS for greyed-out templates
        const style = document.createElement('style');
        style.textContent = `
          .template-card.greyed-out {
            opacity: 0.7;
            filter: grayscale(70%);
          }
          .template-card.greyed-out:hover {
            opacity: 0.9;
            filter: grayscale(30%);
          }
          .placeholder-image {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 48px;
            color: #ccc;
          }
          .load-inventory-container {
            width: 100%;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
          }
          .loading-progress {
            width: 100%;
            padding: 10px;
          }
          #loadingProgressText {
            margin-top: 10px;
            font-weight: bold;
          }
        `;
        document.head.appendChild(style);
      }

      // Replace your updateTemplateGrid function with this enhanced version
      function updateTemplateGrid() {
        if (!userAccount || !templateGrid) return;

        // Keep the load inventory button if it exists and no assets are loaded yet
        const loadButtonContainer = document.querySelector('.load-inventory-container');
        templateGrid.innerHTML = '';
        if (loadButtonContainer && userAssets.length === 0) {
          templateGrid.appendChild(loadButtonContainer);
        }

        // Show dashboard row when inventory is loaded
        if (userAssets.length > 0) {
          dashboardRow.style.display = 'flex';
        }

        // Template video mappings
        const templateVideos = {
          '858575': './ingredients/Pixel_Amber_vid_25fps_300px.mp4', // amber
          '858576': './ingredients/Pixel_Chartreuse_vid_25fps_300px.mp4', // chartreuse
          '858577': './ingredients/Pixel_Violet_vid_25fps_300px.mp4', // violet
          '858578': './ingredients/Pixel_Teal_vid_25fps_300px.mp4', // teal
          '858580': './ingredients/Pixel_Vermillion_vid_25fps_300px.mp4', // vermillion
          '859273': './ingredients/Pixel_Magenta_vid_25fps_300px.mp4', // magenta
          '858574': './ingredients/Pixel_Purple_vid_25fps_300px.mp4', // purple
          '858573': './ingredients/Pixel_Orange_vid_25fps_300px.mp4', // orange
          '858572': './ingredients/Pixel_Green_vid_25fps_300px.mp4', // green
          '858570': './ingredients/Pixel_Red_vid_25fps_300px.mp4', // red
          '858569': './ingredients/Pixel_Blue_vid_25fps_300px.mp4', // blue
          '858571': './ingredients/Pixel_Yellow_vid_25fps_300px.mp4', // yellow
          '858568': './ingredients/Pixel_Black_White_vid_25fps_300px.mp4', // black
        };

        // Craft URLs mapping
        const craftUrls = {
          '858572': 'https://nfthive.io/craft/1832', // Green
          '858573': 'https://nfthive.io/craft/1833', // Orange
          '858574': 'https://nfthive.io/craft/1834', // Purple
          '858575': 'https://nfthive.io/craft/1835', // Amber
          '858576': 'https://nfthive.io/craft/1836', // Chartreuse
          '858577': 'https://nfthive.io/craft/1837', // Violet
          '858578': 'https://nfthive.io/craft/1838', // Teal
          '858580': 'https://nfthive.io/craft/1839', // Vermillion
          '859273': 'https://nfthive.io/craft/1841', // Magenta
        };

        // Group assets by template
        const templateAssets = {};
        const stakedTemplateAssets = {};

        // Count unstaked assets by template
        userAssets.forEach(asset => {
          const templateId = asset.template?.template_id;
          if (templateId) {
            if (!templateAssets[templateId]) {
              templateAssets[templateId] = [];
            }

            // Check if this asset is staked
            const isStaked = stakedAssets.some(stakedAsset =>
              stakedAsset.asset_id === asset.asset_id
            );

            if (!isStaked) {
              templateAssets[templateId].push(asset);
            }
          }
        });

        // Count staked assets by template
        stakedAssets.forEach(stakedAsset => {
          // Find the asset in user assets to get template info
          const asset = userAssets.find(a => a.asset_id === stakedAsset.asset_id);
          if (asset && asset.template) {
            const templateId = asset.template.template_id;
            if (!stakedTemplateAssets[templateId]) {
              stakedTemplateAssets[templateId] = [];
            }
            stakedTemplateAssets[templateId].push(asset);
          }
        });

        // Create template cards for owned assets
        templates.forEach(template => {
          const unstakedCount = (templateAssets[template.id] || []).length;
          const stakedCount = (stakedTemplateAssets[template.id] || []).length;
          const totalCount = unstakedCount + stakedCount;

          if (totalCount > 0) {
            const card = document.createElement('div');
            card.className = 'template-card';

            // Check if we have a video for this template
            const videoUrl = templateVideos[template.id];
            let templateImageHtml = '';

            if (videoUrl) {
              templateImageHtml = `
                    <div class="template-image video-bg">
                        <video autoplay loop muted playsinline>
                            <source src="${videoUrl}" type="video/mp4">
                        </video>
                    </div>
                `;
            } else {
              // Get image URL from the first asset of this template
              let imageUrl = '';
              const firstAsset = userAssets.find(asset =>
                asset.template && asset.template.template_id === template.id
              );

              // Special handling for specific template IDs
              if (template.id === 820134) {
                // Pixelpacks template
                imageUrl = './ingredients/pixelpack.webp';
              } else if (template.id === 781515) {
                // PixalPFPs template
                imageUrl = './img/pixelgrey-bluebg-spliteyes.png';
              } else
                if (firstAsset && firstAsset.data && firstAsset.data.img) {
                  imageUrl = `https://ipfs.io/ipfs/${firstAsset.data.img}`;
                }

              templateImageHtml = `
                    <div class="template-image img-asset-bg" style="background-image: url(${imageUrl})">
                    </div>
                `;
            }

            // Determine market URL
            let marketUrl = '';
            if (template.type === 'Pixel') {
              marketUrl = 'https://wax.atomichub.io/market?collection_name=pixeljourney&schema_name=pixels&template_id=' + template.id;
            } else {
              marketUrl = 'https://wax.atomichub.io/market?collection_name=pixeljourney&template_id=' + template.id;
            }

            // Determine special buttons based on template ID
            let specialButtons = '';

            // Add Craft button if template has a craft URL
            if (craftUrls[template.id]) {
              specialButtons += `<a href="${craftUrls[template.id]}" target="_blank" class="btn btn-info">Craft</a>`;
            }

            // Add Recycle button for Pixal PFPs
            if (template.id === 781515) {
              specialButtons += `<a href="https://neftyblocks.com/collection/pixeljourney/blends/blend.nefty/37700" target="_blank" class="btn btn-warning">Recycle</a>`;
            }

            // Add Unpack button for Pixel Ingredient Packs
            if (template.id === 820134) {
              specialButtons += `<a href="https://neftyblocks.com/collection/pixeljourney/packs/neftyblocksp/2349" target="_blank" class="btn btn-info">Unpack</a>`;
            }

            card.innerHTML = `
                ${templateImageHtml}
                <div class="asset-count">${totalCount} owned</div>
                <div class="staked-count">${stakedCount} staked</div>
                <div class="template-info">
                    <div class="template-name">${template.name}</div>
                    <div class="template-type">${template.type}</div>
                    <div class="template-stats">
                        <div>
                            <div class="stat-value">${template.pxj}</div>
                            <div class="stat-label">PXJ</div>
                        </div>
                        <div>
                            <div class="stat-value">${template.wuf}</div>
                            <div class="stat-label">WUF</div>
                        </div>
                    </div>
                    <div class="template-actions">
                        ${unstakedCount > 0 ? `<button class="btn" onclick="openStakeModal(${template.id})">Stake (${unstakedCount})</button>` : ''}
                        ${stakedCount > 0 ? `<button class="btn btn-secondary" onclick="openUnstakeModal(${template.id})">Unstake (${stakedCount})</button>` : ''}
                        ${specialButtons}
                        <a href="${marketUrl}" target="_blank" class="btn btn-outline-secondary">Buy</a>
                    </div>
                </div>
            `;

            templateGrid.appendChild(card);
          }
        });

        // Now add greyed-out templates for unowned assets
        templates.forEach(template => {
          const unstakedCount = (templateAssets[template.id] || []).length;
          const stakedCount = (stakedTemplateAssets[template.id] || []).length;
          const totalCount = unstakedCount + stakedCount;

          if (totalCount === 0) {
            const card = document.createElement('div');
            card.className = 'template-card greyed-out';

            // Check if we have a video for this template
            const videoUrl = templateVideos[template.id];
            let templateImageHtml = '';

            if (videoUrl) {
              templateImageHtml = `
                    <div class="template-image video-bg">
                        <video autoplay loop muted playsinline>
                            <source src="${videoUrl}" type="video/mp4">
                        </video>
                    </div>
                `;
            } else {
              // Special handling for specific template IDs
              let imageUrl = '';
              if (template.id === 820134) {
                // Pixelpacks template
                imageUrl = './ingredients/pixelpack.webp';
              } else if (template.id === 781515) {
                // PixalPFPs template
                imageUrl = './img/pixelgrey-bluebg-spliteyes.png';
              }

              if (imageUrl) {
                templateImageHtml = `
                      <div class="template-image img-asset-bg" style="background-image: url(${imageUrl})">
                      </div>
                  `;
              } else {
                // Default placeholder for templates without images
                templateImageHtml = `
                      <div class="template-image img-asset-bg">
                        <div class="placeholder-image">?</div>
                      </div>
                  `;
              }
            }

            // Determine market URL
            let marketUrl = '';
            if (template.type === 'Pixel') {
              marketUrl = 'https://wax.atomichub.io/market?collection_name=pixeljourney&schema_name=pixels&template_id=' + template.id;
            } else {
              marketUrl = 'https://wax.atomichub.io/market?collection_name=pixeljourney&template_id=' + template.id;
            }

            // Determine special buttons based on template ID
            let specialButtons = '';

            // Add Craft button if template has a craft URL
            if (craftUrls[template.id]) {
              specialButtons += `<a href="${craftUrls[template.id]}" target="_blank" class="btn btn-info">Craft</a>`;
            }

            // Add Recycle button for Pixal PFPs
            if (template.id === 781515) {
              specialButtons += `<a href="https://neftyblocks.com/collection/pixeljourney/blends/blend.nefty/37700" target="_blank" class="btn btn-warning">Recycle</a>`;
            }

            // Add Unpack button for Pixel Ingredient Packs
            if (template.id === 820134) {
              specialButtons += `<a href="https://neftyblocks.com/collection/pixeljourney/packs/neftyblocksp/2349" target="_blank" class="btn btn-info">Unpack</a>`;
            }

            card.innerHTML = `
                ${templateImageHtml}
                <div class="asset-count">0 owned</div>
                <div class="template-info">
                    <div class="template-name">${template.name}</div>
                    <div class="template-type">${template.type}</div>
                    <div class="template-stats">
                        <div>
                            <div class="stat-value">${template.pxj}</div>
                            <div class="stat-label">PXJ</div>
                        </div>
                        <div>
                            <div class="stat-value">${template.wuf}</div>
                            <div class="stat-label">WUF</div>
                        </div>
                    </div>
                    <div class="template-actions">
                        ${specialButtons}
                        <a href="${marketUrl}" target="_blank" class="btn btn-secondary">Buy</a>
                    </div>
                </div>
            `;

            templateGrid.appendChild(card);
          }
        });
      }

      // Update stats
      function updateStats() {
        if (!userAccount) return;

        // Update loading progress if the loading overlay is visible
        const connectionLoadingOverlay = document.getElementById('connectionLoadingOverlay');
        if (connectionLoadingOverlay && connectionLoadingOverlay.style.display === 'flex') {
          updateLoadingProgress(3, 'Calculating staking power...');
        }

        // Filter assets to only include stakable templates
        const stakableAssets = userAssets.filter(asset => {
          if (asset.template) {
            const templateId = parseInt(asset.template.template_id);
            return templates.some(t => t.id === templateId);
          }
          return false;
        });

        const totalAssets = stakableAssets.length;
        const totalStaked = stakedAssets.length;
        const totalUnstaked = totalAssets - totalStaked;

        // Count unique template types
        const uniqueTypes = new Set();
        stakableAssets.forEach(asset => {
          if (asset.template) {
            const templateId = asset.template.template_id;
            const template = templates.find(t => t.id === parseInt(templateId));
            if (template) {
              uniqueTypes.add(template.type);
            }
          }
        });

        // Calculate total staking power
        let totalPxj = 0;
        let totalWuf = 0;

        stakedAssets.forEach(stakedAsset => {
          const asset = userAssets.find(a => a.asset_id === stakedAsset.asset_id);
          if (asset && asset.template) {
            const templateId = parseInt(asset.template.template_id);
            const template = templates.find(t => t.id === templateId);
            if (template) {
              totalPxj += template.pxj;
              totalWuf += template.wuf;
            }
          }
        });
        updateEarningsBreakdown();

        // Update UI
        totalAssetsEl.textContent = totalAssets;
        stakedAssetsEl.textContent = totalStaked;
        unstakedAssetsEl.textContent = totalUnstaked;
        templateTypesEl.textContent = uniqueTypes.size;

        totalPowerValue.textContent = totalPxj.toFixed(2);
        totalPxjValue.textContent = totalPxj.toFixed(2);
        totalWufValue.textContent = totalWuf.toFixed(2);
      }

      // Open stake modal
      window.openStakeModal = function (templateId) {
        if (!userAccount) return;

        // Reset selection
        selectedAssets = [];
        assetGrid.innerHTML = '';
        selectedCount.textContent = '0';

        // Show modal first
        assetModal.show();

        // Show loading indicator
        showModalLoading('assetModal');

        // Use setTimeout to allow the modal to render before loading assets
        setTimeout(() => {
          // Filter assets by template
          const templateAssets = userAssets.filter(asset =>
            asset.template &&
            parseInt(asset.template.template_id) === templateId &&
            !stakedAssets.some(stakedAsset => stakedAsset.asset_id === asset.asset_id)
          );

          // Create asset items
          templateAssets.forEach(asset => {
            const div = document.createElement('div');
            div.className = 'asset-item';
            div.dataset.assetId = asset.asset_id;

            let imageUrl = '';
            if (asset.data && asset.data.img) {
              imageUrl = `https://ipfs.io/ipfs/${asset.data.img}`;
              div.innerHTML = `
                <img src="${imageUrl || 'https://pixeljourney.xyz/img/logo.png'}" alt="${asset.name || 'Asset'}">
                <div class="asset-id">${asset.asset_id}</div>
            `;
            } else if (asset.data && asset.data.video) {
              imageUrl = `https://ipfs.io/ipfs/${asset.data.video}`;
              div.innerHTML = `
              <video src="https://ipfs.io/ipfs/${asset.data.video}" autoplay loop muted playsinline class="asset-video"></video>
              <div class="asset-id">${asset.asset_id}</div>
            `;
            } else {
              imageUrl = `https://ipfs.io/ipfs/${asset.data.img}`;
            }



            div.addEventListener('click', () => {
              div.classList.toggle('selected');

              if (div.classList.contains('selected')) {
                selectedAssets.push(asset.asset_id);
              } else {
                selectedAssets = selectedAssets.filter(id => id !== asset.asset_id);
              }

              selectedCount.textContent = selectedAssets.length;
            });

            assetGrid.appendChild(div);
          });

          // Hide loading indicator
          hideModalLoading('assetModal');
        }, 300);
      };

      // Open unstake modal
      window.openUnstakeModal = function (templateId) {
        if (!userAccount) return;

        // Reset selection
        selectedUnstakeAssets = [];
        stakedAssetGrid.innerHTML = '';
        selectedUnstakeCount.textContent = '0';

        // Show modal first
        unstakeModal.show();

        // Show loading indicator
        showModalLoading('unstakeModal');

        // Use setTimeout to allow the modal to render before loading assets
        setTimeout(() => {
          // Filter staked assets by template
          const templateStakedAssets = stakedAssets.filter(stakedAsset => {
            const asset = userAssets.find(a => a.asset_id === stakedAsset.asset_id);
            return asset &&
              asset.template &&
              parseInt(asset.template.template_id) === templateId;
          });

          // Create asset items
          templateStakedAssets.forEach(stakedAsset => {
            const asset = userAssets.find(a => a.asset_id === stakedAsset.asset_id);
            if (!asset) return;

            const div = document.createElement('div');
            div.className = 'asset-item';
            div.dataset.assetId = stakedAsset.asset_id;

            let mediaElement = '';
            if (asset.data && asset.data.video) {
              mediaElement = `<video src="https://ipfs.io/ipfs/${asset.data.video}" autoplay loop muted playsinline class="asset-video"></video>`;
            } else if (asset.data && asset.data.img) {
              mediaElement = `<img src="https://ipfs.io/ipfs/${asset.data.img}" alt="${asset.name || 'Asset'}">`;
            } else {
              mediaElement = `<img src="https://pixeljourney.xyz/img/logo.png" alt="${asset.name || 'Asset'}">`;
            }

            div.innerHTML = `
                ${mediaElement}
                <div class="asset-id">${stakedAsset.asset_id}</div>
            `;

            div.addEventListener('click', () => {
              div.classList.toggle('selected');

              if (div.classList.contains('selected')) {
                selectedUnstakeAssets.push(stakedAsset.asset_id);
              } else {
                selectedUnstakeAssets = selectedUnstakeAssets.filter(id => id !== stakedAsset.asset_id);
              }

              selectedUnstakeCount.textContent = selectedUnstakeAssets.length;
            });

            stakedAssetGrid.appendChild(div);
          });

          // Hide loading indicator
          hideModalLoading('unstakeModal');
        }, 300);
      };

      async function stakeAssets(assetIds) {
        if (!userAccount || assetIds.length === 0) return;

        try {
          assetModal.hide();
          showGlobalLoading('Staking assets...');

          const action = {
            account: 'farms.waxdao',
            name: 'stakenfts',
            authorization: [{
              actor: userAccount,
              permission: 'active',
            }],
            data: {
              user: userAccount,
              farmname: 'pixeljourney',
              assets_to_stake: assetIds
            },
          };

          let result;
          if (wax && wax.api) {
            // WAX Cloud Wallet
            result = await wax.api.transact({
              actions: [action]
            }, {
              blocksBehind: 3,
              expireSeconds: 90,
            });
          } else if (anchorLink && anchorSession) {
            // Anchor Wallet
            result = await anchorSession.transact({ action });
          } else if (window.wombat) {
            // Wombat Wallet
            result = await window.wombat.api.transact({
              actions: [action]
            }, {
              blocksBehind: 3,
              expireSeconds: 90,
            });
          } else {
            throw new Error('No wallet connected');
          }

          // Update local data
          assetIds.forEach(assetId => {
            stakedAssets.push({
              owner: userAccount,
              farmname: 'pixeljourney',
              asset_id: assetId
            });
          });

          updateTemplateGrid();
          updateStats();
          hideGlobalLoading();
          showSuccessMessage('Assets staked successfully!', result);
        } catch (error) {
          hideGlobalLoading();
          showErrorMessage(`Stake failed: ${error.message}`);
        }
      }

      async function unstakeAssets(assetIds) {
        console.log(userAccount + ' ' + assetIds.length)
        if (!userAccount || assetIds.length === 0) return;

        try {
          unstakeModal.hide();
          showGlobalLoading('Unstaking assets...');

          const action = {
            account: 'farms.waxdao',
            name: 'unstake',
            authorization: [{
              actor: userAccount,
              permission: 'active',
            }],
            data: {
              user: userAccount,
              farmname: 'pixeljourney',
              asset_ids: assetIds
            },
          };

          let result;
          if (wax && wax.api) {
            // WAX Cloud Wallet
            result = await wax.api.transact({
              actions: [action]
            }, {
              blocksBehind: 3,
              expireSeconds: 90,
            });
          } else if (anchorLink && anchorSession) {
            // Anchor Wallet
            result = await anchorSession.transact({ action });
          } else if (window.wombat) {
            // Wombat Wallet
            result = await window.wombat.api.transact({
              actions: [action]
            }, {
              blocksBehind: 3,
              expireSeconds: 90,
            });
          } else {
            throw new Error('No wallet connected');
          }

          updateTemplateGrid();
          updateStats();
          hideGlobalLoading();
          showSuccessMessage('Assets unstaked successfully!', result);
        } catch (error) {
          hideGlobalLoading();
          showErrorMessage(`Unstake failed: ${error.message}`);
        }
      }

      // Select all assets
      function selectAllAssets() {
        const assetItems = assetGrid.querySelectorAll('.asset-item');
        selectedAssets = [];

        assetItems.forEach(item => {
          item.classList.add('selected');
          selectedAssets.push(item.dataset.assetId);
        });

        selectedCount.textContent = selectedAssets.length;
      }

      // Deselect all assets
      function deselectAllAssets() {
        const assetItems = assetGrid.querySelectorAll('.asset-item');

        assetItems.forEach(item => {
          item.classList.remove('selected');
        });

        selectedAssets = [];
        selectedCount.textContent = '0';
      }

      // Select all staked assets
      function selectAllStakedAssets() {
        const assetItems = stakedAssetGrid.querySelectorAll('.asset-item');
        selectedUnstakeAssets = [];

        assetItems.forEach(item => {
          item.classList.add('selected');
          selectedUnstakeAssets.push(item.dataset.assetId);
        });

        selectedUnstakeCount.textContent = selectedUnstakeAssets.length;
      }

      // Deselect all staked assets
      function deselectAllStakedAssets() {
        const assetItems = stakedAssetGrid.querySelectorAll('.asset-item');

        assetItems.forEach(item => {
          item.classList.remove('selected');
        });

        selectedUnstakeAssets = [];
        selectedUnstakeCount.textContent = '0';
      }

      // Show processing message
      function showProcessingMessage(message) {
        const processingDiv = document.createElement('div');
        processingDiv.id = 'processingMessage';
        processingDiv.style.position = 'fixed';
        processingDiv.style.top = '50%';
        processingDiv.style.left = '50%';
        processingDiv.style.transform = 'translate(-50%, -50%)';
        processingDiv.style.background = 'rgba(0, 0, 0, 0.8)';
        processingDiv.style.color = 'white';
        processingDiv.style.padding = '20px';
        processingDiv.style.borderRadius = '10px';
        processingDiv.style.zIndex = '9999';
        processingDiv.innerHTML = `
            <div class="loading-spinner"></div>
            <span>${message}</span>
        `;

        document.body.appendChild(processingDiv);
      }

      // Hide processing message
      function hideProcessingMessage() {
        const processingDiv = document.getElementById('processingMessage');
        if (processingDiv) {
          processingDiv.remove();
        }
      }

      // Show success message
      function showSuccessMessage(message) {
        const successDiv = document.createElement('div');
        successDiv.style.position = 'fixed';
        successDiv.style.top = '20px';
        successDiv.style.right = '20px';
        successDiv.style.background = 'rgba(16, 163, 127, 0.9)';
        successDiv.style.color = 'white';
        successDiv.style.padding = '15px 20px';
        successDiv.style.borderRadius = '5px';
        successDiv.style.zIndex = '9999';
        successDiv.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
        successDiv.textContent = message;

        document.body.appendChild(successDiv);

        setTimeout(() => {
          successDiv.style.opacity = '0';
          successDiv.style.transition = 'opacity 0.5s ease';
          setTimeout(() => {
            successDiv.remove();
          }, 500);
        }, 3000);
      }

      // Show error message
      function showErrorMessage(message) {
        const errorDiv = document.createElement('div');
        errorDiv.style.position = 'fixed';
        errorDiv.style.top = '20px';
        errorDiv.style.right = '20px';
        errorDiv.style.background = 'rgba(220, 53, 69, 0.9)';
        errorDiv.style.color = 'white';
        errorDiv.style.padding = '15px 20px';
        errorDiv.style.borderRadius = '5px';
        errorDiv.style.zIndex = '9999';
        errorDiv.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
        errorDiv.textContent = message;

        document.body.appendChild(errorDiv);

        setTimeout(() => {
          errorDiv.style.opacity = '0';
          errorDiv.style.transition = 'opacity 0.5s ease';
          setTimeout(() => {
            errorDiv.remove();
          }, 500);
        }, 5000);
      }
    });

    // Show loading indicator in modal
    function showModalLoading(modalId) {
      const modalBody = document.querySelector(`#${modalId} .modal-body`);
      if (!modalBody) return;

      // Create loading overlay
      const loadingOverlay = document.createElement('div');
      loadingOverlay.className = 'loading-overlay';
      loadingOverlay.innerHTML = `
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading assets...</div>
    `;

      modalBody.appendChild(loadingOverlay);
    }

    // Hide loading indicator in modal
    function hideModalLoading(modalId) {
      const loadingOverlay = document.querySelector(`#${modalId} .loading-overlay`);
      if (loadingOverlay) {
        loadingOverlay.remove();
      }
    }

    // Show global loading indicator
    function showGlobalLoading(message = 'Processing...') {
      // Remove any existing loading overlay
      hideGlobalLoading();

      // Create loading overlay
      const loadingOverlay = document.createElement('div');
      loadingOverlay.id = 'globalLoadingOverlay';
      loadingOverlay.className = 'global-loading-overlay';
      loadingOverlay.innerHTML = `
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">${message}</div>
        </div>
    `;

      document.body.appendChild(loadingOverlay);
    }

    // Hide global loading indicator
    function hideGlobalLoading() {
      const loadingOverlay = document.getElementById('globalLoadingOverlay');
      if (loadingOverlay) {
        loadingOverlay.remove();
      }
    }

    function updateEarningsBreakdown() {
      // Get the hourly values
      const pxjPerHour = parseFloat(document.getElementById('totalPxjValue').textContent);
      const wufPerHour = parseFloat(document.getElementById('totalWufValue').textContent);

      // Calculate other time periods
      const pxjPerSecond = (pxjPerHour / 3600).toFixed(6);
      const wufPerSecond = (wufPerHour / 3600).toFixed(6);

      const pxjPerMinute = (pxjPerHour / 60).toFixed(4);
      const wufPerMinute = (wufPerHour / 60).toFixed(4);

      const pxjPerDay = (pxjPerHour * 24).toFixed(2);
      const wufPerDay = (wufPerHour * 24).toFixed(2);

      const pxjPerWeek = (pxjPerHour * 24 * 7).toFixed(2);
      const wufPerWeek = (wufPerHour * 24 * 7).toFixed(2);

      const pxjPerMonth = (pxjPerHour * 24 * 30).toFixed(2);
      const wufPerMonth = (wufPerHour * 24 * 30).toFixed(2);

      const pxjPerYear = (pxjPerHour * 24 * 365).toFixed(2);
      const wufPerYear = (wufPerHour * 24 * 365).toFixed(2);

      // Update the table values
      document.getElementById('pxjPerSecond').textContent = pxjPerSecond;
      document.getElementById('wufPerSecond').textContent = wufPerSecond;

      document.getElementById('pxjPerMinute').textContent = pxjPerMinute;
      document.getElementById('wufPerMinute').textContent = wufPerMinute;

      document.getElementById('pxjPerHour').textContent = pxjPerHour.toFixed(2);
      document.getElementById('wufPerHour').textContent = wufPerHour.toFixed(2);

      document.getElementById('pxjPerDay').textContent = pxjPerDay;
      document.getElementById('wufPerDay').textContent = wufPerDay;

      document.getElementById('pxjPerWeek').textContent = pxjPerWeek;
      document.getElementById('wufPerWeek').textContent = wufPerWeek;

      document.getElementById('pxjPerMonth').textContent = pxjPerMonth;
      document.getElementById('wufPerMonth').textContent = wufPerMonth;

      document.getElementById('pxjPerYear').textContent = pxjPerYear;
      document.getElementById('wufPerYear').textContent = wufPerYear;
    }

    // Function to fetch PXJ token balance
    async function fetchPXJBalance(account, contract = 'pixeljourney', symbol = 'PXJ') {
      try {
        const response = await fetch('https://api.waxsweden.org/v1/chain/get_currency_balance', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            code: contract,
            account: account,
            symbol: symbol
          })
        });
        const data = await response.json();
        if (data.length === 0) return 0;
        const balanceStr = data[0].split(' ')[0];
        return parseFloat(balanceStr);
      } catch (error) {
        console.error(`Error fetching PXJ balance for ${account}:`, error);
        return 0;
      }
    }

    // Function to update the PXJ balance display with formatted numbers
    async function updateBalanceDisplay() {
      const balanceSpan = document.getElementById('pxjBalance');
      const mobileHeaderBalanceSpan = document.getElementById('mobileHeaderPxjBalance');
      if (!balanceSpan) return;

      if (!userAccount) {
        balanceSpan.textContent = '0.0';
        if (mobileHeaderBalanceSpan) mobileHeaderBalanceSpan.textContent = '0.0';
        return;
      }

      try {
        const balance = await fetchPXJBalance(userAccount);

        // Format the balance with K/M suffixes for large numbers
        let formattedBalance;
        if (balance >= 1000000) {
          formattedBalance = (balance / 1000000).toFixed(1) + 'M';
        } else if (balance >= 1000) {
          formattedBalance = (balance / 1000).toFixed(1) + 'K';
        } else {
          formattedBalance = balance.toFixed(1);
        }

        balanceSpan.textContent = formattedBalance;
        mobileHeaderBalanceSpan.textContent = formattedBalance;
      } catch (error) {
        console.error('Error updating PXJ balance:', error);
      }
    }

    // Set up periodic balance refresh
    let balanceRefreshInterval = null;

    function startBalanceRefresh() {
      // Clear any existing interval
      if (balanceRefreshInterval) {
        clearInterval(balanceRefreshInterval);
      }

      // Update immediately
      updateBalanceDisplay();

      // Then refresh every 60 seconds
      balanceRefreshInterval = setInterval(() => {
        if (userAccount) {
          updateBalanceDisplay();
        } else {
          // Stop refreshing if logged out
          clearInterval(balanceRefreshInterval);
          balanceRefreshInterval = null;
        }
      }, 60000); // 60 seconds
    }

    // We'll handle the initial balance check in the main DOMContentLoaded event listener
  </script>

  <!-- APR Stats Section -->
  <div class="container mt-5">
    <div class="card">
      <div class="card-body">
        <h2 class="card-title">Current Staking APRs</h2>
        <div class="token-prices mb-3">
          <span id="waxPrice">WAX: $0.00000000</span> |
          <span id="pxjPrice">PXJ: $0.00000000</span> |
          <span id="wufPrice">WUF: $0.00000000</span> |
          <span id="wpixalPrice">WPIXAL: $0.00000000</span>
        </div>
        <div class="apr-cards">
          <div class="apr-card black-card mb-3">
            <h5>Black Ingredients</h5>
            <div class="apr-value" id="blackApr">Loading...</div>
          </div>
          <div class="apr-card primary-card mb-3">
            <h5>Primary Ingredients</h5>
            <div class="apr-value" id="primaryApr">Loading...</div>
          </div>
          <div class="apr-card secondary-card mb-3">
            <h5>Secondary Ingredients</h5>
            <div class="apr-value" id="secondaryApr">Loading...</div>
          </div>
          <div class="apr-card tertiary-card mb-3">
            <h5>Tertiary Ingredients</h5>
            <div class="apr-value" id="tertiaryApr">Loading...</div>
          </div>
        </div>
        <p class="text-center mt-3"><small>APRs are calculated based on current token prices and estimated NFT values</small></p>
      </div>
    </div>
  </div>

  <!-- Leaderboard Card -->
  <div class="container mt-4">
    <div class="card">
      <div class="card-body">
        <h2 class="card-title">Pixel Journey Leaderboards</h2>
        <div class="row">
          <div class="col-md-12">
            <div class="mb-4">
              <h4>Monthly Crafting Raffle</h4>
              <p>Every 25,000 PXJ locked up into collectibles grants you an entry into our monthly end-of-month airdrop raffle!</p>
              <p>Check out our <a href="https://lb.pixeljourney.xyz/" target="_blank">Leaderboards</a> to see:</p>
              <ul class="leaderboard-list">
                <li>Latest distribution status and statistics</li>
                <li>Live staking APRs for all stakable assets</li>
                <li>PXJ locked up in Ingredient Blends and crafts</li>
                <li>Real-time rewards per second/minute/hour/day/week/month/year</li>
                <li>Detailed NFT asset holdings for all users</li>
              </ul>
              <p class="mt-3"><strong>This is just the first of many leaderboards to come!</strong></p>
              <a href="https://lb.pixeljourney.xyz/" target="_blank" class="btn btn-primary mt-2">Visit Leaderboards</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    /* APR Card Styles */
    .token-prices {
      text-align: center;
      font-size: 0.9rem;
      opacity: 0.8;
      margin-bottom: 20px;
    }

    /* Leaderboard List Styles */
    .leaderboard-list {
      color: var(--text-dark);
      padding-left: 20px;
      margin-top: 10px;
    }

    .light-mode .leaderboard-list {
      color: var(--text-light);
    }

    .light-mode .leaderboard-list {
      color: var(--text-light);
    }

    .apr-cards {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .apr-card {
      background: var(--card-dark);
      border-radius: var(--radius-md);
      padding: 15px;
      position: relative;
      overflow: hidden;
      border: 1px solid var(--border-dark);
      transition: all 0.3s ease;
      text-align: center;
    }

    .light-mode .apr-card {
      background: var(--card-light);
      border: 1px solid var(--border-light);
    }

    .apr-card h5 {
      margin-bottom: 10px;
      font-size: 1.1rem;
    }

    .apr-value {
      font-size: 1.8rem;
      font-weight: bold;
      margin-bottom: 5px;
      color: var(--primary-color);
    }

    .apr-breakdown {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .black-card .apr-value {
      color: #34495e;
    }

    .light-mode .black-card .apr-value {
      color: #2c3e50;
    }

    .primary-card .apr-value {
      color: #3498db;
    }

    .secondary-card .apr-value {
      color: #9b59b6;
    }

    .tertiary-card .apr-value {
      color: #e74c3c;
    }

    @media (min-width: 768px) {
      .apr-cards {
        flex-direction: row;
      }

      .apr-card {
        flex: 1;
      }
    }
  </style>

  <script>
    // APR Calculation
    document.addEventListener('DOMContentLoaded', function() {
      // Global variables for token prices
      let pxjPriceUSD;
      let wufPriceUSD;
      let waxPriceUSD;
      let wpixalPriceUSD;

      // Function to fetch token prices from Alcor Exchange
      async function fetchPrices() {
        const apiUrlPXJ = "https://alcor.exchange/api/v2/tokens/pxj-pixeljourney";
        const apiUrlWUF = "https://alcor.exchange/api/v2/tokens/wuf-wuffi";
        const apiUrlWAX = "https://alcor.exchange/api/v2/tokens/wax-eosio.token";
        const apiUrlWPIXAL = "https://alcor.exchange/api/v2/tokens/wpixal-pixeljourney";

        try {
          const pxjResponse = await fetch(apiUrlPXJ);
          const wufResponse = await fetch(apiUrlWUF);
          const waxResponse = await fetch(apiUrlWAX);
          const wpixalResponse = await fetch(apiUrlWPIXAL);

          if (!pxjResponse.ok || !wufResponse.ok || !waxResponse.ok || !wpixalResponse.ok) {
            throw new Error("Failed to fetch token prices.");
          }

          const pxjData = await pxjResponse.json();
          const wufData = await wufResponse.json();
          const waxData = await waxResponse.json();
          const wpixalData = await wpixalResponse.json();

          pxjPriceUSD = pxjData.usd_price;
          wufPriceUSD = wufData.usd_price;
          waxPriceUSD = waxData.usd_price;
          wpixalPriceUSD = wpixalData.usd_price;

          document.getElementById("waxPrice").textContent = `WAX: $${waxPriceUSD.toFixed(8)}`;
          document.getElementById("pxjPrice").textContent = `PXJ: $${pxjPriceUSD.toFixed(8)}`;
          document.getElementById("wufPrice").textContent = `WUF: $${wufPriceUSD.toFixed(8)}`;
          document.getElementById("wpixalPrice").textContent = `WPIXAL: $${wpixalPriceUSD.toFixed(8)}`;

          return true;
        } catch (error) {
          console.error("Error fetching token prices:", error);
          return false;
        }
      }

      // Function to calculate APRs
      async function calculateAPRs() {
        try {
          // Fetch prices first
          const pricesFetched = await fetchPrices();

          if (!pricesFetched) {
            setTimeout(calculateAPRs, 5000); // Retry after 5 seconds
            return;
          }

          // Black - 142 WUF and 142 PXJ per hour
          const blackWufValue = 142 * 24 * 365 * wufPriceUSD; // Annual WUF value in USD
          const blackPxjValue = 142 * 24 * 365 * pxjPriceUSD; // Annual PXJ value in USD
          const blackTotalValue = blackWufValue + blackPxjValue;
          const blackNftValue = (wpixalPriceUSD * 2.7 + 1500000) * pxjPriceUSD; // Estimated NFT value in USD
          const blackApr = (blackTotalValue / blackNftValue) * 100;

          // Primary - 1 WUF and 0.42 PXJ per hour
          const primaryWufValue = 1 * 24 * 365 * wufPriceUSD; // Annual WUF value in USD
          const primaryPxjValue = 0.42 * 24 * 365 * pxjPriceUSD; // Annual PXJ value in USD
          const primaryTotalValue = primaryWufValue + primaryPxjValue;
          const primaryNftValue = (wpixalPriceUSD / 10); // Estimated NFT value in USD
          const primaryApr = (primaryTotalValue / primaryNftValue) * 100;

          // Secondary - 1 WUF and 2.22 PXJ per hour
          const secondaryWufValue = 1 * 24 * 365 * wufPriceUSD;
          const secondaryPxjValue = 2.22 * 24 * 365 * pxjPriceUSD;
          const secondaryTotalValue = secondaryWufValue + secondaryPxjValue;
          const secondaryNftValue = (wpixalPriceUSD / 5 + 25000) * pxjPriceUSD; // Estimated NFT value in USD
          const secondaryApr = (secondaryTotalValue / secondaryNftValue) * 100;

          // Tertiary - 14.2 WUF and 14.2 PXJ per hour
          const tertiaryWufValue = 14.2 * 24 * 365 * wufPriceUSD;
          const tertiaryPxjValue = 14.2 * 24 * 365 * pxjPriceUSD;
          const tertiaryTotalValue = tertiaryWufValue + tertiaryPxjValue;
          const tertiaryNftValue = (wpixalPriceUSD * 0.3 + 150000) * pxjPriceUSD; // Estimated NFT value in USD
          const tertiaryApr = (tertiaryTotalValue / tertiaryNftValue) * 100;

          // Update the UI with calculated values
          document.getElementById('blackApr').textContent = blackApr.toFixed(2) + '%';
          document.getElementById('primaryApr').textContent = primaryApr.toFixed(2) + '%';
          document.getElementById('secondaryApr').textContent = secondaryApr.toFixed(2) + '%';
          document.getElementById('tertiaryApr').textContent = tertiaryApr.toFixed(2) + '%';
        } catch (error) {
          console.error('Error calculating APRs:', error);
          setTimeout(calculateAPRs, 5000); // Retry after 5 seconds
        }
      }

      // Calculate APRs on page load
      calculateAPRs();

      // Recalculate every 5 minutes
      setInterval(calculateAPRs, 300000);
    });
  </script>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <div class="footer-info">
            <p>Pixel Journey, 2023-2025</p>
            <p>A multi-chain NFT project on Wax, Ethereum, Polygon, Base, and BNB Chain. Explore crypto education, staking, and crafting as we bridge Web3 worlds through pixel-powered collectibles.</p>
          </div>
        </div>
        <div class="col-md-6">
          <div class="footer-links">
            <h5>Important Links</h5>
            <ul>
              <li><a href="https://pixeljourney.xyz" target="_blank">Main Website</a></li>
              <li><a href="https://docs.pixeljourney.xyz" target="_blank">Documentation</a></li>
              <li><a href="https://lb.pixeljourney.xyz" target="_blank">Leaderboards</a></li>
              <li><a href="http://discord.gg/pixel-journey-1130670500776005734" target="_blank">Discord</a></li>
              <li><a href="https://x.com/PXJourney" target="_blank">Twitter</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <style>
    /* Footer Styles */
    .footer {
      background: var(--card-dark);
      padding: 30px 0;
      margin-top: 50px;
      border-top: 1px solid var(--border-dark);
    }

    .light-mode .footer {
      background: var(--card-light);
      border-top: 1px solid var(--border-light);
    }

    .footer-info p {
      margin-bottom: 10px;
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .footer-links h5 {
      margin-bottom: 15px;
      font-size: 1.1rem;
    }

    .footer-links ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-wrap: wrap;
    }

    .footer-links li {
      margin-right: 20px;
      margin-bottom: 10px;
    }

    .footer-links a {
      color: var(--primary-color);
      text-decoration: none;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }

    .footer-links a:hover {
      color: var(--primary-light);
      text-decoration: underline;
    }

    @media (max-width: 768px) {
      .footer-links ul {
        flex-direction: column;
      }

      .footer-links li {
        margin-right: 0;
      }
    }
  </style>
</body>

</html>
