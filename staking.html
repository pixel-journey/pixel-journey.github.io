<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pixel Journey || NFT Staking Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
  <link rel="icon" type="image/x-icon" href="https://pixeljourney.xyz/img/logo.png">
  <style>
    :root {
      /* Modern color palette */
      --primary-color: #10a37f;
      --primary-dark: #0d8c6e;
      --primary-light: #1cbe94;
      --bg-dark: #1a1b1e;
      --bg-light: #ffffff;
      --card-dark: #27292d;
      --card-light: #f5f7fa;
      --text-dark: #e4e6eb;
      --text-light: #1f2937;
      --accent-dark: #2d2f31;
      --accent-light: #f2f3f5;
      --border-dark: #3a3d40;
      --border-light: #e5e7eb;
      --hover-dark: #2f3134;
      --hover-light: #eaeaea;
      --shadow-dark: 0 4px 12px rgba(0, 0, 0, 0.3);
      --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.1);
      --gradient-primary: linear-gradient(135deg, #10a37f, #14b885);
      --gradient-secondary: linear-gradient(135deg, #2d2f31, #3a3d40);
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --transition-fast: 0.2s ease;
      --transition-normal: 0.3s ease;
      --font-main: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    /* Base styles */
    body {
      background-color: var(--bg-dark);
      color: var(--text-dark);
      font-family: var(--font-main);
      line-height: 1.6;
      transition: all var(--transition-normal);
      margin: 25px;
      padding: 0;
      min-height: 100vh;
    }

    body.light-mode {
      background-color: var(--bg-light);
      color: var(--text-light);
    }

    /* Typography */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-weight: 600;
      margin-top: 0;
      color: var(--primary-color);
    }

    a {
      color: var(--primary-color);
      text-decoration: none;
      transition: all var(--transition-fast);
    }

    a:hover {
      color: var(--primary-light);
      text-decoration: none;
    }

    /* Layout components */
    .container {
      max-width: 1400px;
      padding: 0 30px;
      margin: 0 auto;
    }

    /* Header improvements */
    header {
      background: var(--gradient-secondary);
      padding: 20px 0;
      box-shadow: var(--shadow-dark);
      position: relative;
      z-index: 10;
      margin-bottom: 20px;
    }

    header h1 {
      font-size: 28px;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      display: inline-block;
    }

    .light-mode header {
      background: var(--card-light);
      background-color: var(--card-light);
      box-shadow: var(--shadow-light);
    }

    /* Stats bar improvements */
    .stats-bar {
      display: flex;
      align-items: center;
      padding: 15px 25px;
      background: rgba(39, 41, 45, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(58, 61, 64, 0.5);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-dark);
      margin: 20px auto;
      max-width: 1200px;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .stats-bar .stat {
      display: flex;
      align-items: center;
      padding: 8px 15px;
      background: rgba(16, 163, 127, 0.1);
      border: 1px solid rgba(16, 163, 127, 0.2);
      border-radius: var(--radius-sm);
      font-weight: 500;
      transition: all var(--transition-fast);
      margin: 5px;
      min-width: 180px;
    }

    .stats-bar .stat:hover {
      background: rgba(16, 163, 127, 0.2);
      transform: translateY(-2px);
    }

    .stats-bar img {
      height: 32px;
      margin-right: 15px;
      transition: transform var(--transition-fast);
    }

    .stats-bar img:hover {
      transform: scale(1.1);
    }

    .stats-bar.light-mode {
      background: rgba(245, 247, 250, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(229, 231, 235, 0.5);
      box-shadow: var(--shadow-light);
    }

    .light-mode .stat {
      background: var(--accent-light);
      color: var(--text-light);
    }

    /* Rewards section styling */
    .rewards-section {
      background: rgba(39, 41, 45, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(58, 61, 64, 0.5);
      border-radius: var(--radius-md);
      padding: 15px 25px;
      margin: 20px auto;
      max-width: 1200px;
      text-align: center;
      box-shadow: var(--shadow-dark);
      display: none;
      /* Hide by default */
    }

    .rewards-section h3 {
      margin-bottom: 15px;
      color: var(--primary-color);
    }

    #claimableRewards {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--text-dark);
    }

    .claim-btn {
      background: var(--gradient-primary);
      color: white;
      border: none;
      padding: 10px 25px;
      border-radius: var(--radius-md);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-fast);
      box-shadow: 0 4px 10px rgba(16, 163, 127, 0.3);
    }

    .claim-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(16, 163, 127, 0.4);
    }

    .claim-btn:active {
      transform: translateY(1px);
    }

    .light-mode .rewards-section {
      background: rgba(245, 247, 250, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(229, 231, 235, 0.5);
    }

    .light-mode #claimableRewards {
      color: var(--text-light);
    }

    /* Buttons */
    button,
    .btn {
      border: none;
      color: white;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: var(--radius-sm);
      background: var(--gradient-primary);
      font-weight: 500;
      transition: all var(--transition-fast), transform 0.1s ease;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      text-transform: none;
      letter-spacing: 0.3px;
    }

    button:hover,
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      background: var(--primary-color);
    }

    button:active,
    .btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    .btn-secondary {
      background: var(--gradient-secondary);
      margin: 0 5px 5px 0;
      place-content: center;
    }

    .btn-secondary:hover {
      background: var(--accent-dark);
    }

    .light-mode .btn-secondary {
      background: var(--accent-light);
      color: var(--text-light);
    }

    .light-mode .btn-secondary:hover {
      background: var(--hover-light);
    }

    /* Cards */
    .card {
      background: var(--card-dark);
      color: var(--text-dark);
      padding: 20px;
      border: none;
      border-radius: var(--radius-md);
      margin-bottom: 20px;
      transition: all var(--transition-normal);
      box-shadow: var(--shadow-dark);
    }

    .light-mode .card {
      background: rgba(245, 247, 250, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(229, 231, 235, 0.5);
      box-shadow: var(--shadow-light);
    }

    .card-body {
      padding: 0;
    }

    /* Dark mode toggle */
    .dark-mode-toggle {
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: var(--primary-color);
      color: white;
      border: none;
      margin: 10px 10px;
      margin-left: 0;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .dark-mode-toggle:hover {
      background: var(--primary-light);
      transform: translateY(-2px);
    }

    .dark-mode-toggle:before {
      content: "‚òÄÔ∏è";
      font-size: 16px;
    }

    /* Template grid */
    .template-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .template-card {
      background: var(--card-dark);
      border-radius: var(--radius-md);
      overflow: hidden;
      transition: all var(--transition-fast);
      box-shadow: var(--shadow-dark);
      position: relative;
      display: flex;
      flex-direction: column;
    }

    .template-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    }

    .template-card .template-image {
      height: 160px;
      background-size: cover;
      background-position: center;
      background-color: var(--accent-dark);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-dark);
      font-weight: bold;
      font-size: 18px;
    }

    .template-card .template-info {
      padding: 15px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .template-card .template-name {
      font-weight: 600;
      font-size: 18px;
      margin-bottom: 5px;
      color: var(--primary-color);
    }

    .template-card .template-type {
      font-size: 14px;
      color: var(--text-dark);
      opacity: 0.8;
      margin-bottom: 10px;
    }

    .template-card .template-stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .template-card .stat-value {
      font-weight: 600;
      font-size: 16px;
      color: var(--primary-light);
    }

    .template-card .stat-label {
      font-size: 12px;
      opacity: 0.7;
    }

    .template-card .template-actions {
      margin-top: auto;
      display: flex;
      gap: 10px;
    }

    .template-card .asset-count {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(16, 163, 127, 0.9);
      color: white;
      border-radius: 20px;
      padding: 3px 10px;
      font-size: 12px;
      font-weight: 600;
    }

    .template-card .staked-count {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(45, 47, 49, 0.9);
      color: white;
      border-radius: 20px;
      padding: 3px 10px;
      font-size: 12px;
      font-weight: 600;
    }

    /* Asset selection modal */
    .modal-content {
      background: var(--card-dark);
      color: var(--text-dark);
      border: none;
      border-radius: var(--radius-md);
    }

    .modal-header {
      border-bottom: 1px solid var(--border-dark);
    }

    .modal-footer {
      border-top: 1px solid var(--border-dark);
    }

    .asset-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
      max-height: 400px;
      overflow-y: auto;
      padding: 10px;
    }

    .asset-item {
      border: 2px solid transparent;
      border-radius: var(--radius-sm);
      overflow: hidden;
      cursor: pointer;
      position: relative;
      transition: all var(--transition-fast);
    }

    .asset-item:hover {
      transform: scale(1.05);
    }

    .asset-item.selected {
      border-color: var(--primary-color);
    }

    .asset-item img {
      width: 100%;
      height: auto;
      display: block;
    }

    .asset-item .asset-id {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 10px;
      padding: 2px 5px;
      text-align: center;
    }

    .selection-controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    /* Loading spinner */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .stats-bar {
        flex-direction: column;
        align-items: center;
        padding: 10px;
      }

      .stats-bar .stat {
        margin-bottom: 5px;
        width: 100%;
        justify-content: center;
      }

      .template-grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      }
    }

    /* Total staking power highlight */
    .total-power {
      background: var(--gradient-primary);
      color: white;
      padding: 15px 25px;
      border-radius: var(--radius-md);
      text-align: center;
      margin: 20px 0;
      box-shadow: var(--shadow-dark);
      animation: pulse 2s infinite;
      cursor: pointer;
    }

    .total-power h3 {
      margin: 0;
      color: white;
      font-size: 24px;
    }

    .total-power .power-value {
      font-size: 36px;
      font-weight: 700;
      margin: 10px 0;
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(16, 163, 127, 0.4);
      }

      70% {
        box-shadow: 0 0 0 10px rgba(16, 163, 127, 0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(16, 163, 127, 0);
      }
    }

    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      border-radius: var(--radius-md);
    }

    .global-loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .loading-content {
      background: var(--card-dark);
      padding: 30px;
      border-radius: var(--radius-md);
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: var(--shadow-dark);
    }

    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid rgba(16, 163, 127, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 1s ease-in-out infinite;
      margin-bottom: 15px;
    }

    .loading-text {
      color: var(--text-dark);
      font-weight: 500;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Video backgrounds for template cards */
    .template-image.video-bg {
      position: relative;
      overflow: hidden;
    }

    .template-image.video-bg video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .template-image::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.2);
      z-index: 1;
      pointer-events: none;
    }

    .template-image.video-bg .template-name-overlay {
      position: absolute;
      bottom: 10px;
      left: 10px;
      color: white;
      font-weight: bold;
      z-index: 2;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
    }

    .template-container:hover .template-name-overlay {
      background: rgba(16, 163, 127, 0.8);
    }

    .template-image.img-asset-bg {
      position: relative;
      overflow: hidden;
    }


    /* Add this to your existing CSS */
    .power-value-container {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 10px 0;
    }

    .power-value {
      font-size: 36px;
      font-weight: 700;
      margin: 0 5px;
    }

    .power-rate {
      font-size: 16px;
      opacity: 0.8;
      align-self: flex-end;
      margin-bottom: 8px;
    }

    /* .info-icon {
    margin-left: 10px;
    cursor: pointer;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    transition: all var(--transition-fast);
}

.info-icon:hover {
    background: rgba(255, 255, 255, 0.4);
    transform: scale(1.1);
} */

    .earnings-table {
      width: 100%;
      border-collapse: collapse;
    }

    .earnings-table th,
    .earnings-table td {
      padding: 8px 12px;
      text-align: right;
    }

    .earnings-table th:first-child,
    .earnings-table td:first-child {
      text-align: left;
    }

    .earnings-table th {
      background: var(--primary-dark);
      color: white;
    }

    .earnings-table tr:nth-child(even) {
      background: rgba(16, 163, 127, 0.1);
    }

    .earnings-table tr:hover {
      background: rgba(16, 163, 127, 0.2);
    }

    .earnings-total {
      font-weight: 700;
      background: var(--primary-dark) !important;
      color: white;
    }

    .earnings-total td {
      border-top: 2px solid var(--primary-color);
    }

    /* Add this to your existing CSS */
    .asset-item video {
      width: 100%;
      height: auto;
      display: block;
      object-fit: cover;
      aspect-ratio: 1/1;
      background-color: var(--accent-dark);
    }

    /* For better hover effects on videos */
    .asset-item:hover video {
      transform: scale(1.05);
      transition: transform var(--transition-fast);
    }

    /* Make sure videos don't overflow their containers */
    .asset-item {
      /* ... existing code ... */
      overflow: hidden;
      position: relative;
    }

    /* Add a subtle overlay to make text more readable over videos */
    .asset-item.video-asset::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to bottom, transparent 70%, rgba(0, 0, 0, 0.7) 100%);
      pointer-events: none;
    }

    /* Add a small video indicator */
    .asset-item.video-asset::before {
      content: '‚ñ∂';
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      font-size: 10px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
    }

    /* Ensure videos in modals display properly */
    .modal .asset-item video {
      max-height: 200px;
    }

    .modal .asset-item .img-asset-bg {
      max-height: 200px;
    }


    /* Add loading state for videos */
    .asset-item video.loading {
      min-height: 100px;
      background: var(--accent-dark) url('https://pixeljourney.xyz/img/loading.gif') center no-repeat;
      background-size: 32px;
    }

    /* Add loading state for videos */
    .asset-item video.loading {
      min-height: 100px;
      background: var(--accent-dark) url('https://pixeljourney.xyz/img/loading.gif') center no-repeat;
      background-size: 32px;
    }

    /* Preview Section Styling */
    .preview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .preview-card {
      background: linear-gradient(135deg, rgba(16, 163, 127, 0.1), rgba(16, 163, 127, 0.2));
      border-radius: var(--radius-md);
      overflow: hidden;
      transition: all var(--transition-fast);
      box-shadow: var(--shadow-dark);
      border: 1px solid rgba(16, 163, 127, 0.3);
    }

    .light-mode .preview-card {
      background: linear-gradient(135deg, rgba(16, 163, 127, 0.05), rgba(16, 163, 127, 0.1));
      border: 1px solid rgba(16, 163, 127, 0.2);
      box-shadow: var(--shadow-light);
    }

    .preview-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      border-color: var(--primary-color);
    }

    .preview-image {
      height: 160px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.2);
      padding: 20px;
    }

    .light-mode .preview-image {
      background: rgba(255, 255, 255, 0.2);
    }

    .preview-image img {
      max-height: 120px;
      max-width: 120px;
      object-fit: contain;
      transition: transform var(--transition-fast);
    }

    .preview-card:hover .preview-image img {
      transform: scale(1.1);
    }

    .preview-info {
      padding: 15px;
    }

    .preview-info h4 {
      margin: 0 0 5px 0;
      font-size: 18px;
      color: var(--primary-color);
    }

    .preview-info p {
      margin: 0 0 10px 0;
      font-size: 14px;
      opacity: 0.8;
    }

    .preview-rate {
      font-weight: 600;
      color: var(--primary-light);
      font-size: 16px;
      padding: 5px 10px;
      background: rgba(16, 163, 127, 0.1);
      border-radius: var(--radius-sm);
      display: inline-block;
    }

    /* Benefits Section */
    .benefits-section {
      padding-top: 20px;
      border-top: 1px solid var(--border-dark);
    }

    .light-mode .benefits-section {
      border-top: 1px solid var(--border-light);
    }

    .benefits-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .benefit-item {
      display: flex;
      align-items: center;
      padding: 10px;
      background: rgba(16, 163, 127, 0.05);
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
    }

    .benefit-item:hover {
      background: rgba(16, 163, 127, 0.1);
      transform: translateY(-2px);
    }

    .benefit-icon {
      font-size: 24px;
      margin: 6px;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--primary-color);
      color: white;
      border-radius: 50%;
    }

    .benefit-text {
      font-size: 14px;
    }

    /* Lead text styling */
    .lead {
      font-size: 18px;
      font-weight: 300;
      line-height: 1.6;
    }

    @media (max-width: 768px) {
      .preview-grid {
        grid-template-columns: 1fr;
      }

      .benefits-grid {
        grid-template-columns: 1fr;
      }

      .lead {
        font-size: 16px;
      }
    }

    /* Add these styles for the pixel ingredients preview section */
    .preview-item {
      position: relative;
      overflow: hidden;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-dark);
      aspect-ratio: 1 / 1;
    }

    .preview-item img,
    .preview-item video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      transition: transform 0.3s ease;
    }

    .preview-item:hover img,
    .preview-item:hover video {
      transform: scale(1.05);
    }

    /* Life Cycle of Journey Crafting Economy Section */
    .section-title {
      font-size: 28px;
      margin-bottom: 20px;
      color: var(--primary-color);
      text-align: center;
      position: relative;
      padding-bottom: 15px;
    }

    .section-title:after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background: var(--gradient-primary);
      border-radius: 3px;
    }

    .journey-steps {
      display: flex;
      flex-direction: column;
      gap: 40px;
      margin: 30px 0;
    }

    .journey-step {
      position: relative;
      background: rgba(16, 163, 127, 0.05);
      border-radius: var(--radius-md);
      padding: 30px;
      border-left: 4px solid var(--primary-color);
      box-shadow: var(--shadow-dark);
    }

    .light-mode .journey-step {
      background: rgba(16, 163, 127, 0.03);
      box-shadow: var(--shadow-light);
    }

    .step-number {
      position: absolute;
      top: -15px;
      left: 30px;
      background: var(--gradient-primary);
      color: white;
      font-weight: bold;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 14px;
      box-shadow: 0 4px 8px rgba(16, 163, 127, 0.3);
    }

    .journey-step h3 {
      margin-top: 10px;
      margin-bottom: 20px;
      font-size: 22px;
    }

    .route-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }

    @media (max-width: 768px) {
      .route-options {
        grid-template-columns: 1fr;
      }
    }

    .route-option {
      background: rgba(0, 0, 0, 0.1);
      border-radius: var(--radius-sm);
      padding: 20px;
      transition: all var(--transition-fast);
    }

    .light-mode .route-option {
      background: rgba(255, 255, 255, 0.5);
      border: 1px solid rgba(16, 163, 127, 0.1);
    }

    .route-option:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    .route-option h4 {
      font-size: 18px;
      margin-bottom: 15px;
      color: var(--primary-light);
    }

    .route-steps {
      padding-left: 20px;
      margin-bottom: 15px;
    }

    .route-steps li {
      margin-bottom: 10px;
    }

    .route-link,
    .marketplace-link,
    .craft-link,
    .waxdao-link {
      display: inline-block;
      background: rgba(16, 163, 127, 0.1);
      color: var(--primary-color);
      padding: 3px 10px;
      border-radius: 15px;
      font-size: 14px;
      transition: all var(--transition-fast);
      text-decoration: none;
    }

    .route-link:hover,
    .marketplace-link:hover,
    .craft-link:hover,
    .waxdao-link:hover {
      background: rgba(16, 163, 127, 0.2);
      transform: translateY(-2px);
      color: var(--primary-light);
      text-decoration: none;
    }

    /* Improved Marketplace Links Styling */
    .marketplace-links-container {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 15px;
      margin: 20px 0;
    }

    @media (max-width: 768px) {
      .marketplace-links-container {
        grid-template-columns: 1fr;
      }
    }

    .marketplace-link-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px;
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
      text-decoration: none;
      height: 100%;
      min-height: 120px;
      justify-content: center;
    }

    .marketplace-link-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      text-decoration: none;
    }

    .marketplace-logo {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      background: white;
      padding: 5px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .marketplace-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .marketplace-name {
      font-weight: 600;
      font-size: 16px;
      text-align: center;
    }

    /* Marketplace specific styling */
    .marketplace-link-card.nfthive {
      background: rgba(255, 193, 0, 0.1);
      border: 1px solid rgba(255, 193, 0, 0.3);
    }

    .marketplace-link-card.nfthive .marketplace-name {
      color: #FFC100;
    }

    .marketplace-link-card.nfthive:hover {
      background: rgba(255, 193, 0, 0.2);
    }

    .marketplace-link-card.atomichub {
      background: rgba(247, 143, 32, 0.1);
      border: 1px solid rgba(247, 143, 32, 0.3);
    }

    .marketplace-link-card.atomichub .marketplace-name {
      color: #F78F20;
    }

    .marketplace-link-card.atomichub:hover {
      background: rgba(247, 143, 32, 0.2);
    }

    .marketplace-link-card.neftyblocks {
      background: rgba(33, 255, 255, 0.1);
      border: 1px solid rgba(33, 255, 255, 0.3);
    }

    .marketplace-link-card.neftyblocks .marketplace-name {
      color: #21FFFF;
    }

    .marketplace-link-card.neftyblocks:hover {
      background: rgba(33, 255, 255, 0.2);
    }

    .info-box {
      background: rgba(16, 163, 127, 0.05);
      border-radius: var(--radius-sm);
      padding: 15px;
      margin-top: 15px;
      border-left: 3px solid var(--primary-color);
    }

    .light-mode .info-box {
      background: rgba(16, 163, 127, 0.03);
    }

    .upgrade-paths {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin: 25px 0;
    }

    .upgrade-path {
      background: rgba(0, 0, 0, 0.1);
      border-radius: var(--radius-sm);
      padding: 20px;
      transition: all var(--transition-fast);
    }

    .light-mode .upgrade-path {
      background: rgba(255, 255, 255, 0.5);
      border: 1px solid rgba(16, 163, 127, 0.1);
    }

    .upgrade-path:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .upgrade-path.rare {
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.3));
      border: 1px dashed gold;
    }

    .light-mode .upgrade-path.rare {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.05), rgba(255, 215, 0, 0.1));
      border: 1px dashed gold;
    }

    .upgrade-visual {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .ingredient {
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      font-weight: bold;
      font-size: 14px;
      color: white;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    .ingredient {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      overflow: hidden;
      position: relative;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease;
    }

    .ingredient:hover {
      transform: scale(1.1);
      z-index: 5;
    }

    .ingredient video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .upgrade-visual {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin: 20px 0;
    }

    .plus-sign,
    .equals-sign {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary-color);
    }

    .pxj-cost {
      background: rgba(16, 163, 127, 0.1);
      padding: 8px 15px;
      border-radius: 20px;
      font-weight: bold;
      color: var(--primary-color);
    }

    .craft-label {
      text-align: center;
      font-size: 14px;
      margin-top: 10px;
      opacity: 0.8;
    }

    /* Stacked ingredients for the rare black pixel craft */
    .ingredient-group {
      position: relative;
      width: 100px;
      height: 100px;
      margin: 30px;
    }

    .ingredient-stack {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .ingredient.front {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 3;
    }

    .ingredient.middle {
      position: absolute;
      top: 30px;
      left: 30px;
      z-index: 2;
    }

    .ingredient.back {
      position: absolute;
      top: 60px;
      left: 60px;
      z-index: 1;
    }

    .more-indicator {
      position: absolute;
      bottom: -50px;
      right: -60px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 12px;
      font-weight: bold;
      padding: 3px 8px;
      border-radius: 10px;
      z-index: 4;
    }

    /* Specific styling for different ingredient tiers */
    .ingredient.primary {
      border: 2px solid var(--primary-light);
    }

    .ingredient.secondary {
      border: 2px solid var(--primary-light);
    }

    .ingredient.tertiary {
      border: 2px solid var(--primary-light);
    }

    .ingredient.black {
      border: 2px solid #fff;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
    }

    .plus-sign,
    .equals-sign {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary-color);
    }

    .pxj-cost {
      background: rgba(16, 163, 127, 0.1);
      padding: 8px 15px;
      border-radius: 20px;
      font-weight: bold;
      color: var(--primary-color);
    }

    .rare-note {
      text-align: center;
      font-style: italic;
      margin-top: 10px;
      font-size: 14px;
      color: gold;
    }

    .craft-links {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .craft-link {
      padding: 8px 20px;
      font-weight: 500;
    }

    .or-divider {
      color: var(--text-dark);
      opacity: 0.6;
    }

    .light-mode .or-divider {
      color: var(--text-light);
    }

    .waxdao-link {
      display: inline-block;
      background: linear-gradient(135deg, rgba(16, 163, 127, 0.2), rgba(16, 163, 127, 0.3));
      color: white;
      padding: 10px 25px;
      border-radius: var(--radius-sm);
      font-weight: 600;
      margin: 15px 0;
      text-align: center;
    }

    .waxdao-link:hover {
      background: linear-gradient(135deg, rgba(16, 163, 127, 0.3), rgba(16, 163, 127, 0.4));
      color: white;
    }

    .staking-benefits,
    .expansion-benefits {
      background: rgba(16, 163, 127, 0.05);
      border-radius: var(--radius-sm);
      padding: 15px 20px;
      margin-top: 20px;
    }

    .light-mode .staking-benefits,
    .light-mode .expansion-benefits {
      background: rgba(16, 163, 127, 0.03);
    }

    .staking-benefits h4,
    .expansion-benefits h4 {
      color: var(--primary-color);
      margin-bottom: 10px;
      font-size: 16px;
    }

    .staking-benefits ul,
    .expansion-benefits ul {
      padding-left: 20px;
      margin-bottom: 0;
    }

    .staking-benefits li,
    .expansion-benefits li {
      margin-bottom: 8px;
    }

    /* Info Box Container */
    .info-box-container {
      margin-top: 40px;
      border-radius: var(--radius-md);
      overflow: hidden;
      box-shadow: var(--shadow-dark);
    }

    .light-mode .info-box-container {
      box-shadow: var(--shadow-light);
    }

    .info-box-header {
      background: var(--gradient-primary);
      padding: 15px 20px;
    }

    .info-box-header h3 {
      color: white;
      margin: 0;
      font-size: 20px;
    }

    .info-box-content {
      background: rgba(16, 163, 127, 0.05);
      padding: 20px;
    }

    .light-mode .info-box-content {
      background: rgba(255, 255, 255, 0.7);
    }

    .info-point {
      display: flex;
      margin-bottom: 20px;
    }

    .info-point:last-child {
      margin-bottom: 0;
    }

    .info-icon {
      font-size: 24px;
      margin-right: 15px;
      background: rgba(16, 163, 127, 0.1);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .info-text {
      flex: 1;
    }

    .info-text strong {
      color: var(--primary-color);
      display: block;
      margin-bottom: 5px;
    }

    @media (max-width: 768px) {
      .journey-step {
        padding: 25px 15px;
      }

      .upgrade-visual {
        flex-direction: column;
      }

      .ingredient {
        width: 60px;
        height: 60px;
        font-size: 12px;
      }

      .info-point {
        flex-direction: column;
      }

      .info-icon {
        margin-bottom: 10px;
      }

      .ingredient-group {
        margin-bottom: 0px;
      }

      .more-indicator {
        position: absolute;
        bottom: -30px;
        right: -45px;
      }
    }

    /* Connection Loading Animation */
    .connection-loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      backdrop-filter: blur(5px);
    }

    .light-mode .connection-loading-overlay {
      background: rgba(255, 255, 255, 0.9);
    }

    .connection-loading-content {
      background: var(--card-dark);
      padding: 40px;
      border-radius: var(--radius-md);
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: var(--shadow-dark);
      max-width: 90%;
      width: 400px;
      border: 1px solid var(--primary-color);
    }

    .light-mode .connection-loading-content {
      background: var(--card-light);
      box-shadow: var(--shadow-light);
    }

    .connection-loading-text {
      color: var(--text-dark);
      font-weight: 500;
      margin-top: 20px;
      font-size: 18px;
    }

    .light-mode .connection-loading-text {
      color: var(--text-light);
    }

    .connection-loading-status {
      color: var(--primary-color);
      font-size: 14px;
      margin-top: 10px;
      opacity: 0.8;
    }

    /* Pixel Loading Animation */
    .pixel-loader {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 5px;
      width: 120px;
      height: 120px;
    }

    .pixel {
      background-color: var(--primary-color);
      border-radius: 4px;
      animation: pixel-fade 1.8s infinite;
    }

    .pixel-1 {
      animation-delay: 0.0s;
    }

    .pixel-2 {
      animation-delay: 0.2s;
    }

    .pixel-3 {
      animation-delay: 0.4s;
    }

    .pixel-4 {
      animation-delay: 0.6s;
    }

    .pixel-5 {
      animation-delay: 0.8s;
    }

    .pixel-6 {
      animation-delay: 1.0s;
    }

    .pixel-7 {
      animation-delay: 1.2s;
    }

    .pixel-8 {
      animation-delay: 1.4s;
    }

    .pixel-9 {
      animation-delay: 1.6s;
    }

    @keyframes pixel-fade {

      0%,
      100% {
        opacity: 0.3;
        transform: scale(0.8);
      }

      50% {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Leaderboard button */
    .header-buttons {
      display: flex;
      gap: 10px;
    }

    .leaderboard-btn {
      background: var(--gradient-primary);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      font-weight: 500;
    }

    .leaderboard-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(16, 163, 127, 0.3);
      background: var(--primary-light);
      color: white;
    }

    /* Preview Card Links */
    .preview-card-link {
      text-decoration: none;
      color: inherit;
      display: block;
    }

    .preview-card-link:hover {
      text-decoration: none;
      color: inherit;
    }

    /* Keep the existing preview-card styling but adjust for link behavior */
    .preview-card-link .preview-card {
      cursor: pointer;
      position: relative;
    }

    /* Add a subtle indicator that the card is clickable */
    .preview-card-link .preview-card::after {
      content: '';
      position: absolute;
      top: 10px;
      right: 10px;
      width: 24px;
      height: 24px;
      background: rgba(16, 163, 127, 0.8);
      border-radius: 50%;
      opacity: 0;
      transition: opacity var(--transition-fast);
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z'/%3E%3Cpath d='M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z'/%3E%3C/svg%3E");
      background-position: center;
      background-repeat: no-repeat;
      background-size: 14px;
    }

    .preview-card-link:hover .preview-card::after {
      opacity: 1;
    }

    /* Disable the link for collectibles that aren't ready yet */
    .preview-card-link.collectibles-link {
      cursor: default;
    }

    .preview-card-link.collectibles-link .preview-card::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z'/%3E%3C/svg%3E");
    }

    /* Add this to your CSS */
    .logout-btn {
      background: var(--gradient-secondary);
      color: var(--text-dark);
    }

    .light-mode .logout-btn {
      background: var(--accent-light);
      color: var(--text-light);
    }

    .logout-btn:hover {
      background: var(--accent-dark);
      color: white;
    }

    .light-mode .logout-btn:hover {
      background: var(--hover-light);
      color: var(--text-light);
    }

        /* Improved Light Mode Readability */
        .light-mode p {
      color: #333333;
      line-height: 1.7;
    }
    
    .light-mode .benefit-text,
    .light-mode .journey-step p {
      color: #444444;
      font-weight: 400;
    }
    
    .light-mode .info-text {
      color: #444444;
      font-weight: 400;
    }
    
    .light-mode .journey-step li {
      color: #444444;
      margin-bottom: 8px;
    }
    
    .light-mode .template-info {
      background: rgba(245, 247, 250, 0.95);
      border: 1px solid rgba(229, 231, 235, 0.7);
      color: #333333;
      box-shadow: var(--shadow-light);
    }
    
    header.light-mode {
      background: linear-gradient(135deg, #f5f7fa, #e5e7eb);
      box-shadow: var(--shadow-light);
    }
    
    header.light-mode h1 {
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .light-mode .stats-bar {
      background: rgba(245, 247, 250, 0.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(229, 231, 235, 0.7);
      box-shadow: var(--shadow-light);
    }
    
    .light-mode .stat {
      color: #333333;
    }

        /* Burger Menu Styles */
        .burger-menu {
      display: none;
      flex-direction: column;
      justify-content: space-between;
      width: 30px;
      height: 21px;
      cursor: pointer;
      z-index: 1001;
    }
    
    .burger-bar {
      width: 100%;
      height: 3px;
      background-color: var(--text-dark);
      border-radius: 3px;
      transition: all 0.3s ease-in-out;
    }
    
    .light-mode .burger-bar {
      background-color: var(--text-light);
    }
    
    .mobile-menu {
      position: fixed;
      top: 0;
      right: -300px;
      width: 250px;
      height: 100vh;
      background: var(--card-dark);
      z-index: 1000;
      padding: 60px 20px 20px;
      transition: right 0.3s ease-in-out;
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .light-mode .mobile-menu {
      background: var(--card-light);
    }
    
    .mobile-menu.active {
      right: 0;
    }
    
    .mobile-menu a, 
    .mobile-menu button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 12px 15px;
      margin-bottom: 8px;
      border-radius: var(--radius-sm);
      font-weight: 500;
      transition: all var(--transition-fast);
    }
    
    .mobile-menu a {
      color: var(--text-dark);
      text-decoration: none;
      background: var(--accent-dark);
    }
    
    .light-mode .mobile-menu a {
      color: var(--text-light);
      background: var(--accent-light);
    }
    
    .mobile-menu a:hover {
      background: var(--primary-color);
      color: white;
    }
    
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease-in-out;
    }
    
    .overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    @media (max-width: 768px) {
      .header-buttons {
        display: none !important;
      }
      
      .burger-menu {
        display: flex;
      }
    }
  </style>


  <script src="https://unpkg.com/anchor-link@3"></script>
  <script src="https://unpkg.com/anchor-link-browser-transport@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/@greymass//dist/eosio.min.js"></script>
</head>

<body>
  <header>
    <div class="container d-flex justify-content-between align-items-center">
      <h1>Pixel Journey Staking Dashboard</h1>
      
      <!-- Burger Menu Icon -->
      <div class="burger-menu">
        <div class="burger-bar"></div>
        <div class="burger-bar"></div>
        <div class="burger-bar"></div>
      </div>
      
      <!-- Desktop Menu -->
      <div class="d-flex header-buttons">
        <a href="index.html" class="btn btn-secondary me-2">Home</a>
        <button class="dark-mode-toggle" id="darkModeToggle">Toggle Theme</button>
        <a href="https://lb.pixeljourney.xyz" class="btn btn-secondary leaderboard-btn" target="_blank">
          <i class="fas fa-trophy"></i>üèÜ Leaderboards
        </a>
      </div>
    </div>
  </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu">
      <a href="index.html">Home</a>
      <button class="dark-mode-toggle" id="mobileDarkModeToggle">Toggle Theme</button>
      <a href="https://lb.pixeljourney.xyz" target="_blank">
        <i class="fas fa-trophy"></i> Leaderboards
      </a>
    </div>

  <!-- Overlay -->
  <div class="overlay"></div>

  <!-- Add this loading overlay -->
  <div id="connectionLoadingOverlay" class="connection-loading-overlay" style="display: none;">
    <div class="connection-loading-content">
      <div class="connection-loading-animation">
        <div class="pixel-loader">
          <div class="pixel pixel-1"></div>
          <div class="pixel pixel-2"></div>
          <div class="pixel pixel-3"></div>
          <div class="pixel pixel-4"></div>
          <div class="pixel pixel-5"></div>
          <div class="pixel pixel-6"></div>
          <div class="pixel pixel-7"></div>
          <div class="pixel pixel-8"></div>
          <div class="pixel pixel-9"></div>
        </div>
      </div>
      <div class="connection-loading-text">Connecting to WAX Blockchain...</div>
      <div class="connection-loading-status">Fetching your NFT data...</div>
    </div>
  </div>

  <div class="container">
    <!-- Connection Status -->
    <div class="card mb-4" id="connectionCard">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <h3>Connect to WAX</h3>
          <button class="btn" id="loginButton">Connect Wallet</button>
        </div>
        <div id="accountInfo" class="mt-3" style="display: none;">
          <p>Connected as: <span id="accountName" class="fw-bold"></span></p>
        </div>
      </div>
    </div>

    <!-- Total Staking Power -->
    <div class="total-power" id="totalPowerCard" style="display: none;">
      <h3>Your Total Staking Power</h3>
      <div class="power-value-container">
        <div class="power-value" id="totalPowerValue">0</div>
        <div class="power-rate"> /hour</div>
      </div>
      <div class="d-flex justify-content-center gap-3">
        <div><span id="totalPxjValue">0</span> PXJ</div>
        <div><span id="totalWufValue">0</span> WUF</div>
      </div>
    </div>

    <!-- Rewards Section -->
    <div class="rewards-section">
      <h3>Claimable Rewards</h3>
      <div id="claimableRewards">Loading rewards...</div>
      <button class="claim-btn" id="claimButton">Claim Rewards</button>
    </div>

    <!-- Earnings Breakdown Modal -->
    <div class="modal fade" id="earningsModal" tabindex="-1" aria-labelledby="earningsModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="earningsModalLabel">Earnings Breakdown</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <table class="earnings-table">
              <thead>
                <tr>
                  <th>Time Period</th>
                  <th>PXJ</th>
                  <th>WUF</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Per Second</td>
                  <td id="pxjPerSecond">0</td>
                  <td id="wufPerSecond">0</td>
                </tr>
                <tr>
                  <td>Per Minute</td>
                  <td id="pxjPerMinute">0</td>
                  <td id="wufPerMinute">0</td>
                </tr>
                <tr>
                  <td>Per Hour</td>
                  <td id="pxjPerHour">0</td>
                  <td id="wufPerHour">0</td>
                </tr>
                <tr>
                  <td>Per Day</td>
                  <td id="pxjPerDay">0</td>
                  <td id="wufPerDay">0</td>
                </tr>
                <tr>
                  <td>Per Week</td>
                  <td id="pxjPerWeek">0</td>
                  <td id="wufPerWeek">0</td>
                </tr>
                <tr>
                  <td>Per Month (30 days)</td>
                  <td id="pxjPerMonth">0</td>
                  <td id="wufPerMonth">0</td>
                </tr>
                <tr>
                  <td>Per Year</td>
                  <td id="pxjPerYear">0</td>
                  <td id="wufPerYear">0</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar" id="statsBar" style="display: none;">
      <div class="stat">
        <div>
          <div class="fw-bold">Total Assets</div>
          <div id="totalAssets">0</div>
        </div>
      </div>
      <div class="stat">
        <div>
          <div class="fw-bold">Staked Assets</div>
          <div id="stakedAssets">0</div>
        </div>
      </div>
      <div class="stat">
        <div>
          <div class="fw-bold">Unstaked Assets</div>
          <div id="unstakedAssets">0</div>
        </div>
      </div>
      <div class="stat">
        <div>
          <div class="fw-bold">Template Types</div>
          <div id="templateTypes">0</div>
        </div>
      </div>
    </div>

    <!-- Template Grid -->
    <div class="card" id="templateCard" style="display: none;">
      <div class="card-body">
        <h3 class="mb-4">Stakable Templates</h3>
        <div class="template-grid" id="templateGrid">
          <!-- Template cards will be generated here -->
        </div>
      </div>
    </div>


    <!-- Preview Section (New) -->
    <div class="card mb-4" id="previewSection">
      <div class="card-body">
        <h3 class="mb-4">Stake Your Pixel Journey NFTs</h3>
        <p class="lead mb-4">Connect your wallet to start earning PXJ and WUF tokens by staking your Pixel Journey NFTs!
        </p>

        <div class="preview-grid"> <!-- Make the entire card a clickable link -->
          <a href="https://www.pfpwizard.xyz/pfp/pixals/buy/" target="_blank" class="preview-card-link">
            <!-- Preview Cards -->
            <div class="preview-card">
              <div class="preview-item">
                <img src="https://pixeljourney.xyz/img/toppixals/20.webp" alt="Pixel Dust">
              </div>
              <div class="preview-info">
                <h4>Pixal PFPs</h4>
                <p>Stake Pixals to earn PXJ tokens</p>
                <div class="preview-rate">~+ 0.25 PXJ/hour</div>
              </div>
            </div>
          </a>

          <a href="https://nfthive.io/crafts?collection=pixeljourney" target="_blank" class="preview-card-link">
            <div class="preview-card">
              <div class="preview-item">
                <video autoplay loop muted playsinline>
                  <source src="https://pixeljourney.xyz/ingredients/Pixel_Blue_vid_25fps_300px.mp4" type="video/mp4">
                  Your browser does not support the video tag.
                </video>
              </div>
              <div class="preview-info">
                <h4>Pixel Ingredients</h4>
                <p>Stake PFPs to earn PXJ and WUF</p>
                <div class="preview-rate">~+ 0.2 - 124 PXJ/hour</div>
              </div>
            </div>
          </a>

          <a href="#" class="preview-card-link collectibles-link">
            <div class="preview-card">
              <div class="preview-item">
                <img src="https://pixeljourney.xyz/img/SUNSET-PIXEL.png" alt="Pixel Land">
              </div>
              <div class="preview-info">
                <h4>Pixel Collectibles</h4>
                <p>Craft and stake collectibles to boost your earnings</p>
                <div class="preview-rate">coming soon</div>
<!--                 <div class="preview-rate">~+ 0.5 - 1500 PXJ/hour</div> -->
              </div>
            </div>
        </div>
        </a>

        <div class="benefits-section mt-4">
          <h4>Benefits of Staking</h4>
          <div class="benefits-grid">
            <div class="benefit-item">
              <div class="benefit-icon">üí∞</div>
              <div class="benefit-text">Earn passive bonus journey income in PXJ and WUF tokens</div>
            </div>
            <div class="benefit-item">
              <div class="benefit-icon">üîí</div>
              <div class="benefit-text">Keep your NFTs safe in your wallet while (non-custodially) staking </div>
            </div>
            <div class="benefit-item">
              <div class="benefit-icon">üöÄ</div>
              <div class="benefit-text">Boost your earnings by progressing & growing your pixel collection</div>
            </div>
            <div class="benefit-item">
              <div class="benefit-icon">üéÆ</div>
              <div class="benefit-text">Support the Pixel Journey ecosystem!</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Life Cycle of Our Journey Crafting Economy Section -->
    <div class="card mb-4" id="craftingEconomySection">
      <div class="card-body">
        <h2 class="section-title">The Life Cycle of Our Journey Crafting Economy</h2>
        <p class="lead mb-4">Discover how our crafting economy works and how you can participate in the Pixel Journey
          ecosystem.</p>

        <div class="journey-steps">
          <!-- Step 1: Get Ingredients -->
          <div class="journey-step">
            <div class="step-number">Step 1</div>
            <h3>Getting Ingredients</h3>

            <div class="route-options">
              <div class="route-option">
                <h4>Route A: Recycle Pixal PFPs</h4>
                <ol class="route-steps">
                  <li>Find a Pixal PFP - <a href="https://www.pfpwizard.xyz/pfp/pixals/buy/" target="_blank"
                      class="route-link">Buy them here</a></li>
                  <li>Recycle to a Pixel Ingredients Pack - <a
                      href="https://neftyblocks.com/collection/pixeljourney/blends/blend.nefty/37700" target="_blank"
                      class="route-link">Recycle here</a></li>
                  <li>Unpack your packs - <a
                      href="https://neftyblocks.com/collection/pixeljourney/packs/neftyblocksp/2349" target="_blank"
                      class="route-link">Open packs here</a></li>
                </ol>
                <div class="info-box">
                  <p>Each pack gives you 10 random Pixel Ingredients:</p>
                  <ul>
                    <li>~33% Red Primary Ingredients</li>
                    <li>~33% Blue Primary Ingredients</li>
                    <li>~33% Yellow Primary Ingredients</li>
                    <li>1% chance for a Black Pixel Ingredient (worth 87x more than a Primary!)</li>
                  </ul>
                </div>
              </div>

              <div class="route-option">
                <h4>Route B: Buy Directly on Secondary Markets</h4>
                <div class="marketplace-links-container">
                  <a href="https://nfthive.io/collection/pixeljourney?tab=open_market&schema=ingredients&verified=all&order_by=offer_asc"
                    target="_blank" class="marketplace-link-card nfthive">
                    <div class="marketplace-logo">
                      <img src="https://nfthive.io/favicon.ico" alt="NFTHive Logo">
                    </div>
                    <div class="marketplace-name">NFTHive</div>
                  </a>

                  <a href="https://atomichub.io/market?blockchain=wax-mainnet&collection_name=pixeljourney&order=asc&primary_chain=wax-mainnet&schema_name=ingredients&sort=price&symbol=WAX#sales"
                    target="_blank" class="marketplace-link-card atomichub">
                    <div class="marketplace-logo">
                      <img src="https://atomichub.io/favicon.ico" alt="Atomichub Logo">
                    </div>
                    <div class="marketplace-name">Atomichub</div>
                  </a>

                  <a href="https://neftyblocks.com/marketplace/listing?collection_name=pixeljourney&page=1&schema_name=ingredients"
                    target="_blank" class="marketplace-link-card neftyblocks">
                    <div class="marketplace-logo">
                      <img src="https://neftyblocks.com/favicon.ico" alt="NeftyBlocks Logo">
                    </div>
                    <div class="marketplace-name">NeftyBlocks</div>
                  </a>
                </div>
              </div>
            </div>
          </div>

          <!-- Step 2: Upgrading Ingredients -->
          <div class="journey-step">
            <div class="step-number">Step 2</div>
            <h3>Upgrading Your Pixel Ingredients</h3>
            <p>Check out the latest APRs for each on our <a href="https://lb.pixeljourney.xyz/"
                target="_blank">Leaderboards</a></p>

            <div class="upgrade-paths">
              <div class="upgrade-path">
                <div class="upgrade-visual">
                  <div class="ingredient primary">
                    <video autoplay loop muted playsinline>
                      <source src="https://pixeljourney.xyz/ingredients/Pixel_Red_vid_25fps_300px.mp4" type="video/mp4">
                      Primary (Red)
                    </video>
                  </div>
                  <div class="plus-sign">+</div>
                  <div class="ingredient primary">
                    <video autoplay loop muted playsinline>
                      <source src="https://pixeljourney.xyz/ingredients/Pixel_Blue_vid_25fps_300px.mp4"
                        type="video/mp4">
                      Primary (Blue)
                    </video>
                  </div>
                  <div class="plus-sign">+</div>
                  <div class="pxj-cost">25,000 PXJ</div>
                  <div class="equals-sign">=</div>
                  <div class="ingredient secondary">
                    <video autoplay loop muted playsinline>
                      <source src="https://pixeljourney.xyz/ingredients/Pixel_Purple_vid_25fps_300px.mp4"
                        type="video/mp4">
                      Secondary (Purple)
                    </video>
                  </div>
                </div>
                <div class="craft-label">Primary + Primary = Secondary</div>
              </div>

              <div class="upgrade-path">
                <div class="upgrade-visual">
                  <div class="ingredient secondary">
                    <video autoplay loop muted playsinline>
                      <source src="https://pixeljourney.xyz/ingredients/Pixel_Purple_vid_25fps_300px.mp4"
                        type="video/mp4">
                      Secondary (Purple)
                    </video>
                  </div>
                  <div class="plus-sign">+</div>
                  <div class="ingredient primary">
                    <video autoplay loop muted playsinline>
                      <source src="https://pixeljourney.xyz/ingredients/Pixel_Blue_vid_25fps_300px.mp4"
                        type="video/mp4">
                      Primary (Blue)
                    </video>
                  </div>
                  <div class="plus-sign">+</div>
                  <div class="pxj-cost">125,000 PXJ</div>
                  <div class="equals-sign">=</div>
                  <div class="ingredient tertiary">
                    <video autoplay loop muted playsinline>
                      <source src="https://pixeljourney.xyz/ingredients/Pixel_Violet_vid_25fps_300px.mp4"
                        type="video/mp4">
                      Tertiary (Violet)
                    </video>
                  </div>
                </div>
                <div class="craft-label">Secondary + Primary = Tertiary</div>
              </div>

              <div class="upgrade-path rare">
                <div class="upgrade-visual">
                  <div class="ingredient-group primary-group">
                    <div class="ingredient-stack">
                      <div class="ingredient primary front">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Red_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Primary (Red)
                        </video>
                      </div>
                      <div class="ingredient primary middle">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Blue_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Primary (Blue)
                        </video>
                      </div>
                      <div class="ingredient primary back">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Yellow_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Primary (Yellow)
                        </video>
                      </div>
                    </div>
                  </div>
                  <div class="plus-sign">+</div>
                  <div class="ingredient-group secondary-group">
                    <div class="ingredient-stack">
                      <div class="ingredient secondary front">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Purple_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Purple
                        </video>
                      </div>
                      <div class="ingredient secondary middle">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Green_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Orange
                        </video>
                      </div>
                      <div class="ingredient secondary back">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Orange_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Green
                        </video>
                      </div>
                    </div>
                  </div>
                  <div class="plus-sign">+</div>
                  <div class="ingredient-group tertiary-group">
                    <div class="ingredient-stack">
                      <div class="ingredient tertiary front">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Violet_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Violet
                        </video>
                      </div>
                      <div class="ingredient tertiary middle">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Teal_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Teal
                        </video>
                      </div>
                      <div class="ingredient tertiary back">
                        <video autoplay loop muted playsinline>
                          <source src="https://pixeljourney.xyz/ingredients/Pixel_Amber_vid_25fps_300px.mp4"
                            type="video/mp4">
                          Amber
                        </video>
                      </div>
                      <div class="more-indicator">+3</div>
                    </div>
                  </div>
                  <div class="plus-sign">+</div>
                  <div class="pxj-cost">500,000+ PXJ</div>
                  <div class="equals-sign">=</div>
                  <div class="ingredient black">
                    <video autoplay loop muted playsinline>
                      <source src="https://pixeljourney.xyz/ingredients/Pixel_Black_White_vid_25fps_300px.mp4"
                        type="video/mp4">
                      Black
                    </video>
                  </div>
                </div>
                <div class="craft-label">One of every Primary/Secondary/Tertiary Ingredient (12 total)</div>
                <div class="rare-note">* Additional PXJ cost rises per supply appearance for Black Ingredients!</div>
              </div>
            </div>

            <div class="craft-links">
              <p>Find crafts on:</p>
              <a href="https://nfthive.io/crafts?collection=pixeljourney" target="_blank" class="craft-link">NFTHive</a>
              <span class="or-divider">or</span>
              <a href="https://neftyblocks.com/collection/pixeljourney/blends?category=Pixel+Ingredient+Blends"
                target="_blank" class="craft-link">NeftyBlocks</a>
            </div>
          </div>

          <!-- Step 3: Staking -->
          <div class="journey-step">
            <div class="step-number">Step 3</div>
            <h3>Stake Your Ingredients</h3>
            <p>Stake them to our PixelJourney WaxDAO Farm directly by logging in via this portal, or by visiting the
              original/official WaxDAO Farm UI on:</p>
            <a href="https://waxdao.io/v2/farm/pixeljourney" target="_blank" class="waxdao-link">WaxDAO</a>

            <div class="staking-benefits">
              <h4>Staking Benefits:</h4>
              <ul>
                <li>Earn PXJ back along the way</li>
                <li>Receive your PXJ locked into ingredients or collectibles back across a ~2.5-3 year duration (or
                  better!)</li>
                <li>Get increasingly bigger bonus rewards based on the amount of PXJ locked up</li>
                <li>Bigger crafts will yield even better rewards!</li>
              </ul>
            </div>
          </div>

          <!-- Step 4: Expansion -->
          <div class="journey-step">
            <div class="step-number">Step 4</div>
            <h3>Keep Expanding Your Collection</h3>
            <p>Continue expanding on those Pixel Ingredients (for now) and journey collections (soon to come)!</p>

            <div class="expansion-benefits">
              <h4>Benefits of Expansion:</h4>
              <ul>
                <li>Be best prepared for continued crafts</li>
                <li>Let your pixels continue their journeys</li>
                <li>Ingredients and collectibles will continue to play roles in future journey dApps</li>
                <li>Get perks/utility and ever more uses in future mechanics to come!</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Info Box -->
        <div class="info-box-container">
          <div class="info-box-header">
            <h3>Important Information About PXJ Economy</h3>
          </div>
          <div class="info-box-content">
            <div class="info-point">
              <div class="info-icon">üí°</div>
              <div class="info-text">
                <strong>Early Participation is Better:</strong> Locking PXJ up into NFTs along the Pixel Journey earlier
                is better, as it allows holders to stake/re-earn as much PXJ as possible from intermediary steps before
                they may need those ingredients (or other collectibles) in the future to continue crafting.
              </div>
            </div>

            <div class="info-point">
              <div class="info-icon">üîí</div>
              <div class="info-text">
                <strong>Long-term Value:</strong> Locking PXJ into journey NFTs can be compared to a long-time PXJ
                lockup stake. While there isn't directly the option to unstake the PXJ before it is paid out via the
                farms, the NFTs remain holding value and can be traded/sold.
              </div>
            </div>

            <div class="info-point">
              <div class="info-icon">üõ°Ô∏è</div>
              <div class="info-text">
                <strong>Protection from Impermanent Loss:</strong> Contrary to PXJ DeFi with LP Farms and positions, PXJ
                locked into our NFT crafts keeps that PXJ more safe from direct impermanent losses that could occur if
                PXJ is potentially bought away from owners staking in liquidity pools.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>



  </div>

  <!-- Asset Selection Modal -->
  <div class="modal fade" id="assetModal" tabindex="-1" aria-labelledby="assetModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="assetModalLabel">Select Assets to Stake</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="selection-controls">
            <div>
              <button class="btn btn-sm btn-secondary" id="selectAllBtn">Select All</button>
              <button class="btn btn-sm btn-secondary ms-2" id="deselectAllBtn">Deselect All</button>
            </div>
            <div>
              <span id="selectedCount">0</span> assets selected
            </div>
          </div>
          <div class="asset-grid" id="assetGrid">
            <!-- Asset items will be generated here -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn" id="confirmStakeBtn">Stake Selected</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Unstake Modal -->
  <div class="modal fade" id="unstakeModal" tabindex="-1" aria-labelledby="unstakeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="unstakeModalLabel">Select Assets to Unstake</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="selection-controls">
            <div>
              <button class="btn btn-sm btn-secondary" id="selectAllUnstakeBtn">Select All</button>
              <button class="btn btn-sm btn-secondary ms-2" id="deselectAllUnstakeBtn">Deselect All</button>
            </div>
            <div>
              <span id="selectedUnstakeCount">0</span> assets selected
            </div>
          </div>
          <div class="asset-grid" id="stakedAssetGrid">
            <!-- Staked asset items will be generated here -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn" id="confirmUnstakeBtn">Unstake Selected</button>
        </div>
      </div>
    </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://notify.waxsweden.org/static/assets/waxjs.js"></script>
  <script>

    // Burger menu functionality
    document.addEventListener('DOMContentLoaded', function() {
      const burgerMenu = document.querySelector('.burger-menu');
      const mobileMenu = document.querySelector('.mobile-menu');
      const overlay = document.querySelector('.overlay');
      const mobileDarkModeToggle = document.getElementById('mobileDarkModeToggle');
      
      // Toggle mobile menu
      burgerMenu.addEventListener('click', function() {
        mobileMenu.classList.toggle('active');
        overlay.classList.toggle('active');
        document.body.style.overflow = mobileMenu.classList.contains('active') ? 'hidden' : '';
      });
      
      // Close menu when clicking overlay
      overlay.addEventListener('click', function() {
        mobileMenu.classList.remove('active');
        overlay.classList.remove('active');
        document.body.style.overflow = '';
      });
      
      // Make mobile dark mode toggle work the same as desktop
      if (mobileDarkModeToggle && darkModeToggle) {
        mobileDarkModeToggle.addEventListener('click', function() {
          document.body.classList.toggle('light-mode');
          localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
        });
      }
    });

    // Initialize wallet variables

    // Template data
    const templates = [
      { id: 781515, pxj: 0.25, wuf: 5.0, pxjUpgrade: 0, name: "Pixal PFP", type: "pixals" },
      { id: 820134, pxj: 2.5, wuf: 20.0, pxjUpgrade: 0, name: "Pixel Ingredient Pack", type: "pixelpack" },
      { id: 858568, pxj: 124.0, wuf: 100.0, pxjUpgrade: 0, name: "Black (Primary)", type: "primary" },
      { id: 858569, pxj: 0.2, wuf: 2.0, pxjUpgrade: 0, name: "Blue (Primary)", type: "primary" },
      { id: 858570, pxj: 0.2, wuf: 2.0, pxjUpgrade: 0, name: "Red (Primary)", type: "primary" },
      { id: 858571, pxj: 0.2, wuf: 2.0, pxjUpgrade: 0, name: "Yellow (Primary)", type: "primary" },
      { id: 858572, pxj: 2.5, wuf: 9.0, pxjUpgrade: 25000, name: "Green (Secondary)", type: "secondary" },
      { id: 858573, pxj: 2.5, wuf: 9.0, pxjUpgrade: 25000, name: "Orange (Secondary)", type: "secondary" },
      { id: 858574, pxj: 2.5, wuf: 9.0, pxjUpgrade: 25000, name: "Purple (Secondary)", type: "secondary" },
      { id: 858575, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Amber (Tertiary)", type: "tertiary" },
      { id: 858576, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Chartreuse (Tertiary)", type: "tertiary" },
      { id: 858577, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Violet (Tertiary)", type: "tertiary" },
      { id: 858578, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Teal (Tertiary)", type: "tertiary" },
      { id: 858580, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Vermillion (Tertiary)", type: "tertiary" },
      { id: 859273, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Magenta (Tertiary)", type: "tertiary" }
    ];

    document.addEventListener('DOMContentLoaded', function () {
      let wallet;
      let wax;
      let anchorLink;
      let anchorSession;
      let userAccount = null;
      let stakedAssets = [];
      let userAssets = [];
      let selectedAssets = [];
      let selectedUnstakeAssets = [];
      let isLoggingOut = false;
      let autoLoginInterval = null;
      let loginAttempts = 0;
      const MAX_LOGIN_ATTEMPTS = 2;

      // DOM elements
      const loginButton = document.getElementById('loginButton');
      const accountName = document.getElementById('accountName');
      const accountInfo = document.getElementById('accountInfo');
      const templateGrid = document.getElementById('templateGrid');
      const assetGrid = document.getElementById('assetGrid');
      const stakedAssetGrid = document.getElementById('stakedAssetGrid');
      const selectAllBtn = document.getElementById('selectAllBtn');
      const deselectAllBtn = document.getElementById('deselectAllBtn');
      const selectAllUnstakeBtn = document.getElementById('selectAllUnstakeBtn');
      const deselectAllUnstakeBtn = document.getElementById('deselectAllUnstakeBtn');
      const confirmStakeBtn = document.getElementById('confirmStakeBtn');
      const confirmUnstakeBtn = document.getElementById('confirmUnstakeBtn');
      const selectedCount = document.getElementById('selectedCount');
      const selectedUnstakeCount = document.getElementById('selectedUnstakeCount');
      const totalPowerCard = document.getElementById('totalPowerCard');
      const totalPowerValue = document.getElementById('totalPowerValue');
      const totalPxjValue = document.getElementById('totalPxjValue');
      const totalWufValue = document.getElementById('totalWufValue');
      const statsBar = document.getElementById('statsBar');
      const totalAssetsEl = document.getElementById('totalAssets');
      const stakedAssetsEl = document.getElementById('stakedAssets');
      const unstakedAssetsEl = document.getElementById('unstakedAssets');
      const templateTypesEl = document.getElementById('templateTypes');
      const templateCard = document.getElementById('templateCard');
      const darkModeToggle = document.getElementById('darkModeToggle');

      const connectionLoadingOverlay = document.getElementById('connectionLoadingOverlay');
      const connectionLoadingStatus = document.querySelector('.connection-loading-status');

      // Bootstrap modals
      const assetModal = new bootstrap.Modal(document.getElementById('assetModal'));
      const unstakeModal = new bootstrap.Modal(document.getElementById('unstakeModal'));

      // Event listeners
      loginButton.addEventListener('click', function () {
        if (loginButton.textContent === 'Log Out') {
          logout();
        } else {
          login();
        }
      });
      selectAllBtn.addEventListener('click', selectAllAssets);
      deselectAllBtn.addEventListener('click', deselectAllAssets);
      selectAllUnstakeBtn.addEventListener('click', selectAllStakedAssets);
      deselectAllUnstakeBtn.addEventListener('click', deselectAllStakedAssets);
      confirmStakeBtn.addEventListener('click', () => stakeAssets(selectedAssets));
      confirmUnstakeBtn.addEventListener('click', () => unstakeAssets(selectedUnstakeAssets));
      darkModeToggle.addEventListener('click', toggleDarkMode);

      const transport = new AnchorLinkBrowserTransport({
        /** CSS class prefix, defaults to `anchor-link` */
        classPrefix: 'anchor-link',
        /** Whether to inject CSS styles in the page header, defaults to true. */
        injectStyles: true,
        /** Whether to display request success and error messages, defaults to true */
        requestStatus: false,
        /** Local storage prefix, defaults to `anchor-link`. */
        storagePrefix: 'anchor-link',
        /**
         * Whether to use Greymass Fuel for low resource accounts, defaults to false.
         *  Note that this service is not available on all networks, and will automatically
         *  determine based on chain id if it should be enabled or not.
         */
        disableGreymassFuel: false,
        /** Referral account to use for Greymass Fuel. */
        fuelReferrer: 'pixeljourney',
      })

      document.getElementById('claimButton').addEventListener('click', claimRewards);

      // Check if user is already logged in
      checkAutoLogin();

      // Dark mode toggle
      function toggleDarkMode() {
        document.body.classList.toggle('light-mode');
        document.querySelectorAll('.card, .stats-bar, header, .modal-content').forEach(el => {
          el.classList.toggle('light-mode');
        });
      }

      // Function to show loading overlay with custom message
      function showConnectionLoading(statusMessage) {
        connectionLoadingStatus.textContent = statusMessage;
        connectionLoadingOverlay.style.display = 'flex';
      }

      // Function to hide loading overlay
      function hideConnectionLoading() {
        connectionLoadingOverlay.style.display = 'none';
      }

      // Set up the earnings info button
      const totalPowerCardBtn = document.getElementById('totalPowerCard');
      const earningsModal = new bootstrap.Modal(document.getElementById('earningsModal'));

      if (totalPowerCardBtn) {
        totalPowerCardBtn.addEventListener('click', function () {
          updateEarningsBreakdown(); // Ensure values are up to date
          earningsModal.show();
        });
      }

      // Login function with both wallet options
      async function login() {
        try {

          // WAX Cloud Wallet login
          wax = new waxjs.WaxJS({
            rpcEndpoint: 'https://wax.greymass.com',
            tryAutoLogin: false // Disable auto-login to prevent conflicts
          });

          // Create wallet selection modal
          const walletChoice = await showWalletSelection();

          if (walletChoice === 'wax') {
            showConnectionLoading('Connecting to wallet...');
            userAccount = await wax.login();

            wallet = 'wax';
          } else if (walletChoice === 'anchor') {
            showConnectionLoading('Connecting to wallet...');
            // Anchor Wallet login
            anchorLink = new AnchorLink({
              transport,
              chains: [
                {
                  chainId: '1064487b3cd1a897ce03ae5b6a865651747e2e152090f99c1d19d44e01aea5a4',
                  nodeUrl: 'https://wax.greymass.com',
                },
              ],
            });

            const identity = await anchorLink.login('pixeljourney');
            anchorSession = identity.session;
            userAccount = identity.session.auth.toString().split('@')[0];
            wallet = 'anchor';
          }
          else if (walletChoice === 'wombat') {
            showConnectionLoading('Connecting to Wombat Wallet...');
            userAccount = await loginWithWombat();
            wallet = 'wombat';
          } else {
            hideConnectionLoading();
            return; // User cancelled
          }

          // Common post-login actions
          accountName.textContent = userAccount;
          accountInfo.style.display = 'block';
          loginButton.textContent = 'Log Out';
          loginButton.classList.remove('btn');
          loginButton.classList.add('logout-btn');

          // Show UI elements
          totalPowerCard.style.display = 'block';
          statsBar.style.display = 'flex';
          templateCard.style.display = 'block';
          document.querySelector('.rewards-section').style.display = 'block';

          // Load data
          showConnectionLoading('Fetching your NFT data...');
          await fetchStakedAssets();
          showConnectionLoading('Loading your staked assets...');
          await loadUserAssets();
          updateTemplateGrid();
          updateStats();
          fetchClaimableRewards();
          hideConnectionLoading();
        } catch (error) {
          hideConnectionLoading();
          showErrorMessage('Failed to login. Please try again.');
        }
      }

      async function loginWithWombat() {
        return new Promise((resolve, reject) => {
          // Check if Wombat is installed
          if (!window.wombat) {
            showErrorMessage('Wombat Wallet not detected. Please install it first.');
            reject(new Error('Wombat Wallet not detected'));
            return;
          }

          // Wombat login flow
          window.wombat.getUserAccount().then(account => {
            if (account) {
              resolve(account);
            } else {
              // If no active session, request login
              window.wombat.requestLogin().then(account => {
                if (account) {
                  resolve(account);
                } else {
                  reject(new Error('User cancelled login'));
                }
              }).catch(err => {
                reject(err);
              });
            }
          }).catch(err => {
            reject(err);
          });
        });
      }

      // Show wallet selection modal
      function showWalletSelection() {
        return new Promise((resolve) => {
          const modal = document.createElement('div');
          modal.style.position = 'fixed';
          modal.style.top = '0';
          modal.style.left = '0';
          modal.style.right = '0';
          modal.style.bottom = '0';
          modal.style.backgroundColor = 'rgba(0,0,0,0.7)';
          modal.style.display = 'flex';
          modal.style.justifyContent = 'center';
          modal.style.alignItems = 'center';
          modal.style.zIndex = '99999';

          modal.innerHTML = `
      <div style="background: var(--card-dark); padding: 30px; border-radius: var(--radius-md); text-align: center; max-width: 400px; width: 90%;">
        <h3 style="margin-top: 0;">Select Wallet</h3>
        <button id="waxWalletBtn" style="margin: 10px; padding: 15px; width: 100%;" class="btn">
          <img src="https://waxblock.io/common/images/mycloudwallet.png" style="height: 24px; vertical-align: middle; margin-right: 10px;">
          WAX Cloud Wallet
        </button>
        <button id="anchorWalletBtn" style="margin: 10px; padding: 15px; width: 100%;" class="btn">
          <img src="https://play-lh.googleusercontent.com/DVLJnVhhOe99bwJjZ-00lAeaw-rqPPj2HRmlXOC0cr-xAOcWkjy8NuLGjB0kMdMBlg" style="height: 24px; vertical-align: middle; margin-right: 10px;">
          Anchor Wallet
        </button>
        <button id="wombatWalletBtn" style="margin: 10px; padding: 15px; width: 100%;" class="btn">
          <img src="https://www.yadawallets.com/wp-content/uploads/2020/11/Wombat-wallet-logo.png" style="height: 24px; vertical-align: middle; margin-right: 10px;">
          Wombat Wallet
        </button>
        <button id="cancelWalletBtn" style="margin: 10px; padding: 15px; width: 100%;" class="btn btn-secondary">
          Cancel
        </button>
      </div>
    `;

          document.body.appendChild(modal);

          document.getElementById('waxWalletBtn').addEventListener('click', () => {
            document.body.removeChild(modal);
            resolve('wax');
          });

          document.getElementById('anchorWalletBtn').addEventListener('click', () => {
            document.body.removeChild(modal);
            resolve('anchor');
          });

          document.getElementById('wombatWalletBtn').addEventListener('click', () => {
            document.body.removeChild(modal);
            resolve('wombat');
          });

          document.getElementById('cancelWalletBtn').addEventListener('click', () => {
            document.body.removeChild(modal);
            resolve(null);
          });
        });
      }

      // Check if user is already logged in
      async function checkAutoLogin() {
        if (isLoggingOut) return;

        try {
          // Check WAX Cloud Wallet first
          wax = new waxjs.WaxJS({
            rpcEndpoint: 'https://wax.greymass.com',
            tryAutoLogin: true
          });

          // First try WAX Cloud Wallet auto-login
          const isWaxAutoLogin = await wax.isAutoLoginAvailable();
          if (isWaxAutoLogin) {
            showConnectionLoading('Checking for existing session...');
            userAccount = wax.userAccount;
            accountName.textContent = userAccount;
            accountInfo.style.display = 'block';
            loginButton.textContent = 'Log Out';
            loginButton.classList.remove('btn');
            loginButton.classList.add('logout-btn');

            totalPowerCard.style.display = 'block';
            statsBar.style.display = 'flex';
            templateCard.style.display = 'block';
            document.querySelector('.rewards-section').style.display = 'block';

            showConnectionLoading('Fetching your NFT data...');
            await fetchStakedAssets();
            showConnectionLoading('Loading your staked assets...');
            await loadUserAssets();
            updateTemplateGrid();
            updateStats();
            fetchClaimableRewards();
            hideConnectionLoading();
            return;
          }



          // Initialize AnchorLink if not already done
          if (!anchorLink) {
            anchorLink = new AnchorLink({
              transport: new AnchorLinkBrowserTransport(),
              chains: [{
                chainId: '1064487b3cd1a897ce03ae5b6a865651747e2e152090f99c1d19d44e01aea5a4',
                nodeUrl: 'https://wax.greymass.com',
              }],
            });
          }

          // Try to restore session
          const session = await anchorLink.restoreSession('pixeljourney');
          if (session) {
            // If WAX auto-login not available, try Anchor Wallet
            showConnectionLoading('Checking Anchor Wallet session...');
            anchorSession = session;
            userAccount = session.auth.toString().split('@')[0];

            accountName.textContent = userAccount;
            accountInfo.style.display = 'block';
            loginButton.textContent = 'Log Out';
            loginButton.classList.remove('btn');
            loginButton.classList.add('logout-btn');

            totalPowerCard.style.display = 'block';
            statsBar.style.display = 'flex';
            templateCard.style.display = 'block';
            document.querySelector('.rewards-section').style.display = 'block';

            showConnectionLoading('Fetching your NFT data...');
            await fetchStakedAssets();
            showConnectionLoading('Loading your staked assets...');
            await loadUserAssets();
            updateTemplateGrid();
            updateStats();
            fetchClaimableRewards();
            hideConnectionLoading();
          }

          // Finally try Wombat Wallet
          if (window.wombat) {
            showConnectionLoading('Checking Wombat Wallet session...');
            const account = await window.wombat.getUserAccount();
            if (account) {
              userAccount = account;
              wallet = 'wombat';

              accountName.textContent = userAccount;
              accountInfo.style.display = 'block';
              loginButton.textContent = 'Log Out';
              loginButton.classList.remove('btn');
              loginButton.classList.add('logout-btn');

              totalPowerCard.style.display = 'block';
              statsBar.style.display = 'flex';
              templateCard.style.display = 'block';
              document.querySelector('.rewards-section').style.display = 'block';

              showConnectionLoading('Fetching your NFT data...');
              await fetchStakedAssets();
              showConnectionLoading('Loading your staked assets...');
              await loadUserAssets();
              updateTemplateGrid();
              updateStats();
              fetchClaimableRewards();
              hideConnectionLoading();
              return;
            }
          }
        } catch (error) {
          hideConnectionLoading();
          showErrorMessage('Auto login error:', error);
          // Don't show error message to user for auto-login failures
        }


      }

      // Modified logout function
      async function logout() {
        try {
          isLoggingOut = true;
          loginAttempts = 0; // Reset attempt counter

          // Clear any pending auto-login checks
          if (autoLoginInterval) {
            clearInterval(autoLoginInterval);
            autoLoginInterval = null;
          }

          // Disable WaxJS auto-login completely
          if (wax) {
            try {
              // First disable auto-login
              wax.autoLogin = false;

              // Then perform logout
              if (typeof wax.logout === 'function') {
                await wax.logout();
              }

              // Force WaxJS to forget user
              wax.userAccount = null;
            } catch (e) {
              console.warn('WaxJS logout cleanup error:', e);
            }
          }

          // Anchor Wallet cleanup
          if (anchorLink && anchorSession) {
            try {
              await anchorLink.removeSession('pixeljourney', anchorSession.auth);
            } catch (e) {
              console.warn('Anchor logout cleanup error:', e);
            }
          }
          /* 
                        // Wombat Wallet cleanup
              if (wallet === 'wombat' && window.wombat) {
                try {
                  await window.wombat.logout();
                } catch (e) {
                  console.warn('Wombat logout cleanup error:', e);
                }
              } */

          // Clear all references
          wax = null;
          anchorLink = null;
          anchorSession = null;
          userAccount = null;
          stakedAssets = [];
          userAssets = [];

          // UI cleanup
          updateUIAfterLogout();
          showSuccessMessage('Logged out successfully');

        } catch (error) {
          showErrorMessage('Logout failed. Please try again.');
        } finally {
          // Small delay before allowing new logins
          setTimeout(() => {
            isLoggingOut = false;

            hideConnectionLoading();
          }, 3000);
        }
      }

      function updateUIAfterLogout() {
        accountInfo.style.display = 'none';
        loginButton.textContent = 'Connect Wallet';
        loginButton.classList.remove('logout-btn');
        loginButton.classList.add('btn');
        totalPowerCard.style.display = 'none';
        statsBar.style.display = 'none';
        templateCard.style.display = 'none';
        document.querySelector('.rewards-section').style.display = 'none';
        templateGrid.innerHTML = '';
        hideConnectionLoading();
      }

      async function fetchClaimableRewards() {
  const rewardsDiv = document.getElementById('claimableRewards');
  if (!userAccount) {
    rewardsDiv.innerHTML = 'Please log in to see rewards.';
    return;
  }

  rewardsDiv.innerHTML = 'Loading rewards...';
  console.log("Fetching rewards for account:", userAccount);

  try {
    // Create a new wax instance if needed (without login)
    if (!wax) {
      wax = new waxjs.WaxJS({
        rpcEndpoint: 'https://wax.greymass.com',
        tryAutoLogin: false
      });
    }

    // Use the wax.rpc regardless of login method
    const rpc = wax.rpc;
    
    // Initialize variables for pagination
    let lower_bound = '';
    let more = true;
    let userStake = null;

    // Loop through pages until we find the user or run out of results
    while (more && !userStake) {
      const response = await rpc.get_table_rows({
        json: true,
        code: 'farms.waxdao',    // Contract account
        scope: 'farms.waxdao',   // Contract scope
        table: 'stakers',        // Table name
        lower_bound,
        limit: 1000,             // Adjust limit as needed
        reverse: false,
        show_payer: false
      });

      console.log("Fetched page with", response.rows.length, "rows. More:", response.more);
      
      // Update pagination variables
      more = response.more;
      if (more) {
        lower_bound = response.next_key;
      }

      // Find the user in the current page of results with the correct farmname
      const matchingRows = response.rows.filter(row => row.user === userAccount);
      console.log("Found", matchingRows.length, "rows matching user account");
      
      // Log all matching rows for debugging
      matchingRows.forEach((row, index) => {
        console.log(`Row ${index}:`, row);
      });
      
      // Find the specific row for pixeljourney farm
      userStake = matchingRows.find(row => row.farmname === 'pixeljourney');
      
      if (userStake) {
        console.log("Found matching row for pixeljourney farm:", userStake);
        break;
      }
    }

    if (userStake && userStake.claimable_balances) {
      // Parse the claimable balances
      let balancesArray;
      
      try {
        // If it's a string, parse it as JSON
        if (typeof userStake.claimable_balances === 'string') {
          balancesArray = JSON.parse(userStake.claimable_balances);
        } else {
          // If it's already an array, use it directly
          balancesArray = userStake.claimable_balances;
        }
        
        // Format the rewards with at most 1 decimal place
        if (balancesArray && balancesArray.length > 0) {
          let formattedRewards = [];
          
          // Process each token balance
          balancesArray.forEach(balance => {
            // Extract token amount and symbol
            const [amount, symbol] = balance.quantity.split(' ');
            
            // Format to at most 1 decimal place
            const formattedAmount = parseFloat(amount).toFixed(1);
            
            // Add to formatted rewards array
            formattedRewards.push(`${symbol}: ${formattedAmount}`);
          });
          
          // Join with pipe separator
          rewardsDiv.innerHTML = formattedRewards.join(' | ');
          
          // Enable claim button if any rewards are greater than zero
          const hasClaimableTokens = balancesArray.some(balance => {
            const [amount, symbol] = balance.quantity.split(' ');
            return parseFloat(amount) > 0;
          });

          // document.getElementById('claimButton').disabled = !hasClaimableTokens;
        } else {
          rewardsDiv.innerHTML = 'No claimable rewards found.';
          document.getElementById('claimButton').disabled = true;
        }
      } catch (parseError) {
        console.error('Error parsing claimable balances:', parseError);
        rewardsDiv.innerHTML = 'Error parsing rewards data.';
        document.getElementById('claimButton').disabled = true;
      }
    } else {
      console.log("No matching stake found for user", userAccount, "in pixeljourney farm");
      rewardsDiv.innerHTML = 'No claimable rewards found.';
      document.getElementById('claimButton').disabled = true;
    }
  } catch (error) {
    console.error('Error fetching rewards:', error);
    rewardsDiv.innerHTML = 'Error loading rewards. Please try again.';
    document.getElementById('claimButton').disabled = true;
  }
}

      async function claimRewards() {
        if (!userAccount) return showErrorMessage('Please log in first.');
        try {
          const action = {
            account: 'farms.waxdao',
            name: 'claim',
            authorization: [{ actor: userAccount, permission: 'active' }],
            data: {
              user: userAccount,
              farmname: 'pixeljourney'
            }
          };

          let result;
          if (wax && wax.api) {
            // WAX Cloud Wallet
            result = await wax.api.transact({
              actions: [action]
            }, {
              blocksBehind: 3,
              expireSeconds: 30
            });
          } else if (anchorLink && anchorSession) {
            // Anchor Wallet
            result = await anchorSession.transact({ action });
          } else {
            throw new showErrorMessage('No wallet connected');
          }

          showSuccessMessage('Rewards claimed successfully!', result);

          const rewardsDiv = document.getElementById('claimableRewards');
          rewardsDiv.innerHTML = 'PXJ: 0.0 | WUF: 0.0';
        } catch (error) {
          showErrorMessage('Failed to claim rewards. Please try again.');
        }
      }

      // Fetch staked assets
      // Upgraded fetchStakedAssets function
      // Fetch staked assets
      async function fetchStakedAssets() {
        if (!userAccount) return;

        try {
          stakedAssets = [];
          let lower_bound = '';
          let more = true;

          // Create a new wax instance if needed (without login)
          let rpcEndpoint;
          if (!wax) {
            wax = new waxjs.WaxJS({
              rpcEndpoint: 'https://wax.greymass.com',
              tryAutoLogin: false
            });
          }

          // Use the wax.rpc regardless of login method
          const rpc = wax.rpc;

          while (more) {
            const result = await rpc.get_table_rows({
              code: 'farms.waxdao',
              scope: 'farms.waxdao',
              table: 'stakednfts',
              limit: 1000,
              lower_bound,
              json: true
            });

            for (const row of result.rows) {
              if (row.owner === userAccount && row.farmname === 'pixeljourney') {
                stakedAssets.push(row);
              }
            }

            more = result.more;
            if (more) lower_bound = result.next_key;
          }

        } catch (error) {
          showErrorMessage('Failed to fetch staked assets.');
        }
      }

      // Load user assets
      async function loadUserAssets() {
        if (!userAccount) return;

        try {
          userAssets = [];
          let page = 1;

          while (true) {
            const response = await fetch(`https://atomic-wax.a-dex.xyz/atomicassets/v1/assets?owner=${userAccount}&collection_name=pixeljourney&limit=1000&page=${page}`);
            const data = await response.json();
            const pageAssets = data.data;

            if (!pageAssets.length) break;

            userAssets = userAssets.concat(pageAssets);
            page++;
          }

        } catch (error) {
          showErrorMessage('Failed to load your assets.');
        }
      }

      // Replace your updateTemplateGrid function with this enhanced version
      function updateTemplateGrid() {
        if (!userAccount || !templateGrid) return;

        templateGrid.innerHTML = '';

        // Template video mappings
        const templateVideos = {
          '858575': './ingredients/Pixel_Amber_vid_25fps_300px.mp4', // amber
          '858576': './ingredients/Pixel_Chartreuse_vid_25fps_300px.mp4', // chartreuse
          '858577': './ingredients/Pixel_Violet_vid_25fps_300px.mp4', // violet
          '858578': './ingredients/Pixel_Teal_vid_25fps_300px.mp4', // teal
          '858580': './ingredients/Pixel_Vermillion_vid_25fps_300px.mp4', // vermillion
          '859273': './ingredients/Pixel_Magenta_vid_25fps_300px.mp4', // magenta
          '858574': './ingredients/Pixel_Purple_vid_25fps_300px.mp4', // purple
          '858573': './ingredients/Pixel_Orange_vid_25fps_300px.mp4', // orange
          '858572': './ingredients/Pixel_Green_vid_25fps_300px.mp4', // green
          '858570': './ingredients/Pixel_Red_vid_25fps_300px.mp4', // red
          '858569': './ingredients/Pixel_Blue_vid_25fps_300px.mp4', // blue
          '858571': './ingredients/Pixel_Yellow_vid_25fps_300px.mp4', // yellow
          '858568': './ingredients/Pixel_Black_White_vid_25fps_300px.mp4', // black
        };

        // Group assets by template
        const templateAssets = {};
        const stakedTemplateAssets = {};

        // Count unstaked assets by template
        userAssets.forEach(asset => {
          const templateId = asset.template?.template_id;
          if (templateId) {
            if (!templateAssets[templateId]) {
              templateAssets[templateId] = [];
            }

            // Check if this asset is staked
            const isStaked = stakedAssets.some(stakedAsset =>
              stakedAsset.asset_id === asset.asset_id
            );

            if (!isStaked) {
              templateAssets[templateId].push(asset);
            }
          }
        });

        // Count staked assets by template
        stakedAssets.forEach(stakedAsset => {
          // Find the asset in user assets to get template info
          const asset = userAssets.find(a => a.asset_id === stakedAsset.asset_id);
          if (asset && asset.template) {
            const templateId = asset.template.template_id;
            if (!stakedTemplateAssets[templateId]) {
              stakedTemplateAssets[templateId] = [];
            }
            stakedTemplateAssets[templateId].push(asset);
          }
        });

        // Create template cards
        templates.forEach(template => {
          const unstakedCount = (templateAssets[template.id] || []).length;
          const stakedCount = (stakedTemplateAssets[template.id] || []).length;
          const totalCount = unstakedCount + stakedCount;

          if (totalCount > 0) {
            const card = document.createElement('div');
            card.className = 'template-card';

            // Check if we have a video for this template
            const videoUrl = templateVideos[template.id];
            let templateImageHtml = '';

            if (videoUrl) {
              templateImageHtml = `
                    <div class="template-image video-bg">
                        <video autoplay loop muted playsinline>
                            <source src="${videoUrl}" type="video/mp4">
                        </video>
                    </div>
                `;
            } else {
              // Get image URL from the first asset of this template
              let imageUrl = '';
              const firstAsset = userAssets.find(asset =>
                asset.template && asset.template.template_id === template.id
              );

              // Special handling for specific template IDs
              if (template.id === 820134) {
                // Pixelpacks template
                imageUrl = './ingredients/pixelpack.webp';
              } else if (template.id === 781515) {
                // PixalPFPs template
                imageUrl = './img/pixelgrey-bluebg-spliteyes.png';
              } else
                if (firstAsset && firstAsset.data && firstAsset.data.img) {
                  imageUrl = `https://ipfs.io/ipfs/${firstAsset.data.img}`;
                }

              templateImageHtml = `
                    <div class="template-image img-asset-bg" style="background-image: url(${imageUrl})">
                    </div>
                `;
            }

            card.innerHTML = `
                ${templateImageHtml}
                <div class="asset-count">${totalCount} owned</div>
                <div class="staked-count">${stakedCount} staked</div>
                <div class="template-info">
                    <div class="template-name">${template.name}</div>
                    <div class="template-type">${template.type}</div>
                    <div class="template-stats">
                        <div>
                            <div class="stat-value">${template.pxj}</div>
                            <div class="stat-label">PXJ</div>
                        </div>
                        <div>
                            <div class="stat-value">${template.wuf}</div>
                            <div class="stat-label">WUF</div>
                        </div>
                    </div>
                    <div class="template-actions">
                        ${unstakedCount > 0 ? `<button class="btn" onclick="openStakeModal(${template.id})">Stake (${unstakedCount})</button>` : ''}
                        ${stakedCount > 0 ? `<button class="btn btn-secondary" onclick="openUnstakeModal(${template.id})">Unstake (${stakedCount})</button>` : ''}
                    </div>
                </div>
            `;

            templateGrid.appendChild(card);
          }
        });
      }

      // Update stats
      function updateStats() {
        if (!userAccount) return;

        const totalAssets = userAssets.length;
        const totalStaked = stakedAssets.length;
        const totalUnstaked = totalAssets - totalStaked;

        // Count unique template types
        const uniqueTypes = new Set();
        userAssets.forEach(asset => {
          if (asset.template) {
            const templateId = asset.template.template_id;
            const template = templates.find(t => t.id === parseInt(templateId));
            if (template) {
              uniqueTypes.add(template.type);
            }
          }
        });

        // Calculate total staking power
        let totalPxj = 0;
        let totalWuf = 0;

        stakedAssets.forEach(stakedAsset => {
          const asset = userAssets.find(a => a.asset_id === stakedAsset.asset_id);
          if (asset && asset.template) {
            const templateId = parseInt(asset.template.template_id);
            const template = templates.find(t => t.id === templateId);
            if (template) {
              totalPxj += template.pxj;
              totalWuf += template.wuf;
            }
          }
        });
        updateEarningsBreakdown();

        // Update UI
        totalAssetsEl.textContent = totalAssets;
        stakedAssetsEl.textContent = totalStaked;
        unstakedAssetsEl.textContent = totalUnstaked;
        templateTypesEl.textContent = uniqueTypes.size;

        totalPowerValue.textContent = totalPxj.toFixed(2);
        totalPxjValue.textContent = totalPxj.toFixed(2);
        totalWufValue.textContent = totalWuf.toFixed(2);
      }

      // Open stake modal
      window.openStakeModal = function (templateId) {
        if (!userAccount) return;

        // Reset selection
        selectedAssets = [];
        assetGrid.innerHTML = '';
        selectedCount.textContent = '0';

        // Show modal first
        assetModal.show();

        // Show loading indicator
        showModalLoading('assetModal');

        // Use setTimeout to allow the modal to render before loading assets
        setTimeout(() => {
          // Filter assets by template
          const templateAssets = userAssets.filter(asset =>
            asset.template &&
            parseInt(asset.template.template_id) === templateId &&
            !stakedAssets.some(stakedAsset => stakedAsset.asset_id === asset.asset_id)
          );

          // Create asset items
          templateAssets.forEach(asset => {
            const div = document.createElement('div');
            div.className = 'asset-item';
            div.dataset.assetId = asset.asset_id;

            let imageUrl = '';
            if (asset.data && asset.data.img) {
              imageUrl = `https://ipfs.io/ipfs/${asset.data.img}`;
              div.innerHTML = `
                <img src="${imageUrl || 'https://pixeljourney.xyz/img/logo.png'}" alt="${asset.name || 'Asset'}">
                <div class="asset-id">${asset.asset_id}</div>
            `;
            } else if (asset.data && asset.data.video) {
              imageUrl = `https://ipfs.io/ipfs/${asset.data.video}`;
              div.innerHTML = `
              <video src="https://ipfs.io/ipfs/${asset.data.video}" autoplay loop muted playsinline class="asset-video"></video>
              <div class="asset-id">${asset.asset_id}</div>
            `;
            } else {
              imageUrl = `https://ipfs.io/ipfs/${asset.data.img}`;
            }



            div.addEventListener('click', () => {
              div.classList.toggle('selected');

              if (div.classList.contains('selected')) {
                selectedAssets.push(asset.asset_id);
              } else {
                selectedAssets = selectedAssets.filter(id => id !== asset.asset_id);
              }

              selectedCount.textContent = selectedAssets.length;
            });

            assetGrid.appendChild(div);
          });

          // Hide loading indicator
          hideModalLoading('assetModal');
        }, 300);
      };

      // Open unstake modal
      window.openUnstakeModal = function (templateId) {
        if (!userAccount) return;

        // Reset selection
        selectedUnstakeAssets = [];
        stakedAssetGrid.innerHTML = '';
        selectedUnstakeCount.textContent = '0';

        // Show modal first
        unstakeModal.show();

        // Show loading indicator
        showModalLoading('unstakeModal');

        // Use setTimeout to allow the modal to render before loading assets
        setTimeout(() => {
          // Filter staked assets by template
          const templateStakedAssets = stakedAssets.filter(stakedAsset => {
            const asset = userAssets.find(a => a.asset_id === stakedAsset.asset_id);
            return asset &&
              asset.template &&
              parseInt(asset.template.template_id) === templateId;
          });

          // Create asset items
          templateStakedAssets.forEach(stakedAsset => {
            const asset = userAssets.find(a => a.asset_id === stakedAsset.asset_id);
            if (!asset) return;

            const div = document.createElement('div');
            div.className = 'asset-item';
            div.dataset.assetId = stakedAsset.asset_id;

            let mediaElement = '';
            if (asset.data && asset.data.video) {
              mediaElement = `<video src="https://ipfs.io/ipfs/${asset.data.video}" autoplay loop muted playsinline class="asset-video"></video>`;
            } else if (asset.data && asset.data.img) {
              mediaElement = `<img src="https://ipfs.io/ipfs/${asset.data.img}" alt="${asset.name || 'Asset'}">`;
            } else {
              mediaElement = `<img src="https://pixeljourney.xyz/img/logo.png" alt="${asset.name || 'Asset'}">`;
            }

            div.innerHTML = `
                ${mediaElement}
                <div class="asset-id">${stakedAsset.asset_id}</div>
            `;

            div.addEventListener('click', () => {
              div.classList.toggle('selected');

              if (div.classList.contains('selected')) {
                selectedUnstakeAssets.push(stakedAsset.asset_id);
              } else {
                selectedUnstakeAssets = selectedUnstakeAssets.filter(id => id !== stakedAsset.asset_id);
              }

              selectedUnstakeCount.textContent = selectedUnstakeAssets.length;
            });

            stakedAssetGrid.appendChild(div);
          });

          // Hide loading indicator
          hideModalLoading('unstakeModal');
        }, 300);
      };

      async function stakeAssets(assetIds) {
        if (!userAccount || assetIds.length === 0) return;

        try {
          assetModal.hide();
          showGlobalLoading('Staking assets...');

          const action = {
            account: 'farms.waxdao',
            name: 'stakenfts',
            authorization: [{
              actor: userAccount,
              permission: 'active',
            }],
            data: {
              user: userAccount,
              farmname: 'pixeljourney',
              assets_to_stake: assetIds
            },
          };

          let result;
          if (wax && wax.api) {
            // WAX Cloud Wallet
            result = await wax.api.transact({
              actions: [action]
            }, {
              blocksBehind: 3,
              expireSeconds: 90,
            });
          } else if (anchorLink && anchorSession) {
            // Anchor Wallet
            result = await anchorSession.transact({ action });
          } else if (window.wombat) {
            // Wombat Wallet
            result = await window.wombat.api.transact({
              actions: [action]
            }, {
              blocksBehind: 3,
              expireSeconds: 90,
            });
          } else {
            throw new Error('No wallet connected');
          }

          // Update local data
          assetIds.forEach(assetId => {
            stakedAssets.push({
              owner: userAccount,
              farmname: 'pixeljourney',
              asset_id: assetId
            });
          });

          updateTemplateGrid();
          updateStats();
          hideGlobalLoading();
          showSuccessMessage('Assets staked successfully!', result);
        } catch (error) {
          hideGlobalLoading();
          showErrorMessage(`Stake failed: ${error.message}`);
        }
      }

      async function unstakeAssets(assetIds) {
        console.log(userAccount + ' ' + assetIds.length)
        if (!userAccount || assetIds.length === 0) return;

        try {
          unstakeModal.hide();
          showGlobalLoading('Unstaking assets...');

          const action = {
            account: 'farms.waxdao',
            name: 'unstake',
            authorization: [{
              actor: userAccount,
              permission: 'active',
            }],
            data: {
              user: userAccount,
              farmname: 'pixeljourney',
              asset_ids: assetIds
            },
          };

          let result;
          if (wax && wax.api) {
            // WAX Cloud Wallet
            result = await wax.api.transact({
              actions: [action]
            }, {
              blocksBehind: 3,
              expireSeconds: 90,
            });
          } else if (anchorLink && anchorSession) {
            // Anchor Wallet
            result = await anchorSession.transact({ action });
          } else if (window.wombat) {
            // Wombat Wallet
            result = await window.wombat.api.transact({
              actions: [action]
            }, {
              blocksBehind: 3,
              expireSeconds: 90,
            });
          } else {
            throw new Error('No wallet connected');
          }

          updateTemplateGrid();
          updateStats();
          hideGlobalLoading();
          showSuccessMessage('Assets unstaked successfully!', result);
        } catch (error) {
          hideGlobalLoading();
          showErrorMessage(`Unstake failed: ${error.message}`);
        }
      }

      // Select all assets
      function selectAllAssets() {
        const assetItems = assetGrid.querySelectorAll('.asset-item');
        selectedAssets = [];

        assetItems.forEach(item => {
          item.classList.add('selected');
          selectedAssets.push(item.dataset.assetId);
        });

        selectedCount.textContent = selectedAssets.length;
      }

      // Deselect all assets
      function deselectAllAssets() {
        const assetItems = assetGrid.querySelectorAll('.asset-item');

        assetItems.forEach(item => {
          item.classList.remove('selected');
        });

        selectedAssets = [];
        selectedCount.textContent = '0';
      }

      // Select all staked assets
      function selectAllStakedAssets() {
        const assetItems = stakedAssetGrid.querySelectorAll('.asset-item');
        selectedUnstakeAssets = [];

        assetItems.forEach(item => {
          item.classList.add('selected');
          selectedUnstakeAssets.push(item.dataset.assetId);
        });

        selectedUnstakeCount.textContent = selectedUnstakeAssets.length;
      }

      // Deselect all staked assets
      function deselectAllStakedAssets() {
        const assetItems = stakedAssetGrid.querySelectorAll('.asset-item');

        assetItems.forEach(item => {
          item.classList.remove('selected');
        });

        selectedUnstakeAssets = [];
        selectedUnstakeCount.textContent = '0';
      }

      // Show processing message
      function showProcessingMessage(message) {
        const processingDiv = document.createElement('div');
        processingDiv.id = 'processingMessage';
        processingDiv.style.position = 'fixed';
        processingDiv.style.top = '50%';
        processingDiv.style.left = '50%';
        processingDiv.style.transform = 'translate(-50%, -50%)';
        processingDiv.style.background = 'rgba(0, 0, 0, 0.8)';
        processingDiv.style.color = 'white';
        processingDiv.style.padding = '20px';
        processingDiv.style.borderRadius = '10px';
        processingDiv.style.zIndex = '9999';
        processingDiv.innerHTML = `
            <div class="loading-spinner"></div>
            <span>${message}</span>
        `;

        document.body.appendChild(processingDiv);
      }

      // Hide processing message
      function hideProcessingMessage() {
        const processingDiv = document.getElementById('processingMessage');
        if (processingDiv) {
          processingDiv.remove();
        }
      }

      // Show success message
      function showSuccessMessage(message) {
        const successDiv = document.createElement('div');
        successDiv.style.position = 'fixed';
        successDiv.style.top = '20px';
        successDiv.style.right = '20px';
        successDiv.style.background = 'rgba(16, 163, 127, 0.9)';
        successDiv.style.color = 'white';
        successDiv.style.padding = '15px 20px';
        successDiv.style.borderRadius = '5px';
        successDiv.style.zIndex = '9999';
        successDiv.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
        successDiv.textContent = message;

        document.body.appendChild(successDiv);

        setTimeout(() => {
          successDiv.style.opacity = '0';
          successDiv.style.transition = 'opacity 0.5s ease';
          setTimeout(() => {
            successDiv.remove();
          }, 500);
        }, 3000);
      }

      // Show error message
      function showErrorMessage(message) {
        const errorDiv = document.createElement('div');
        errorDiv.style.position = 'fixed';
        errorDiv.style.top = '20px';
        errorDiv.style.right = '20px';
        errorDiv.style.background = 'rgba(220, 53, 69, 0.9)';
        errorDiv.style.color = 'white';
        errorDiv.style.padding = '15px 20px';
        errorDiv.style.borderRadius = '5px';
        errorDiv.style.zIndex = '9999';
        errorDiv.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
        errorDiv.textContent = message;

        document.body.appendChild(errorDiv);

        setTimeout(() => {
          errorDiv.style.opacity = '0';
          errorDiv.style.transition = 'opacity 0.5s ease';
          setTimeout(() => {
            errorDiv.remove();
          }, 500);
        }, 5000);
      }
    });

    // Show loading indicator in modal
    function showModalLoading(modalId) {
      const modalBody = document.querySelector(`#${modalId} .modal-body`);
      if (!modalBody) return;

      // Create loading overlay
      const loadingOverlay = document.createElement('div');
      loadingOverlay.className = 'loading-overlay';
      loadingOverlay.innerHTML = `
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading assets...</div>
    `;

      modalBody.appendChild(loadingOverlay);
    }

    // Hide loading indicator in modal
    function hideModalLoading(modalId) {
      const loadingOverlay = document.querySelector(`#${modalId} .loading-overlay`);
      if (loadingOverlay) {
        loadingOverlay.remove();
      }
    }

    // Show global loading indicator
    function showGlobalLoading(message = 'Processing...') {
      // Remove any existing loading overlay
      hideGlobalLoading();

      // Create loading overlay
      const loadingOverlay = document.createElement('div');
      loadingOverlay.id = 'globalLoadingOverlay';
      loadingOverlay.className = 'global-loading-overlay';
      loadingOverlay.innerHTML = `
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">${message}</div>
        </div>
    `;

      document.body.appendChild(loadingOverlay);
    }

    // Hide global loading indicator
    function hideGlobalLoading() {
      const loadingOverlay = document.getElementById('globalLoadingOverlay');
      if (loadingOverlay) {
        loadingOverlay.remove();
      }
    }

    function updateEarningsBreakdown() {
      // Get the hourly values
      const pxjPerHour = parseFloat(document.getElementById('totalPxjValue').textContent);
      const wufPerHour = parseFloat(document.getElementById('totalWufValue').textContent);

      // Calculate other time periods
      const pxjPerSecond = (pxjPerHour / 3600).toFixed(6);
      const wufPerSecond = (wufPerHour / 3600).toFixed(6);

      const pxjPerMinute = (pxjPerHour / 60).toFixed(4);
      const wufPerMinute = (wufPerHour / 60).toFixed(4);

      const pxjPerDay = (pxjPerHour * 24).toFixed(2);
      const wufPerDay = (wufPerHour * 24).toFixed(2);

      const pxjPerWeek = (pxjPerHour * 24 * 7).toFixed(2);
      const wufPerWeek = (wufPerHour * 24 * 7).toFixed(2);

      const pxjPerMonth = (pxjPerHour * 24 * 30).toFixed(2);
      const wufPerMonth = (wufPerHour * 24 * 30).toFixed(2);

      const pxjPerYear = (pxjPerHour * 24 * 365).toFixed(2);
      const wufPerYear = (wufPerHour * 24 * 365).toFixed(2);

      // Update the table values
      document.getElementById('pxjPerSecond').textContent = pxjPerSecond;
      document.getElementById('wufPerSecond').textContent = wufPerSecond;

      document.getElementById('pxjPerMinute').textContent = pxjPerMinute;
      document.getElementById('wufPerMinute').textContent = wufPerMinute;

      document.getElementById('pxjPerHour').textContent = pxjPerHour.toFixed(2);
      document.getElementById('wufPerHour').textContent = wufPerHour.toFixed(2);

      document.getElementById('pxjPerDay').textContent = pxjPerDay;
      document.getElementById('wufPerDay').textContent = wufPerDay;

      document.getElementById('pxjPerWeek').textContent = pxjPerWeek;
      document.getElementById('wufPerWeek').textContent = wufPerWeek;

      document.getElementById('pxjPerMonth').textContent = pxjPerMonth;
      document.getElementById('wufPerMonth').textContent = wufPerMonth;

      document.getElementById('pxjPerYear').textContent = pxjPerYear;
      document.getElementById('wufPerYear').textContent = wufPerYear;
    }



  </script>
</body>

</html>
