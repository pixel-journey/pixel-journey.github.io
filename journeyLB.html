<!DOCTYPE html>
<html lang="en">
<head>

  <meta name="title" content="
  Pixel Journey || WaxDAO Farm Collection Power Leaderboard
  " />
  <meta name="description" content="Pixel Journey is an innovative new crypto-education focused project starting off from Wax.io, NFT-bridged to both Polygon and Ethereum, soon our goal is to explore all that the Web3 and crypto space has to offer. Together, we'll work towards Pixels binding together endless worlds in our shared metaverse." />

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://lb.pixeljourney.xyz/" />
  <meta property="og:title" content="
  Pixel Journey || WaxDAO Farm Collection Power Leaderboard
  " />
  <meta property="og:description" content="Pixel Journey is an innovative new crypto-education focused project starting off from Wax.io, NFT-bridged to both Polygon and Ethereum, soon our goal is to explore all that the Web3 and crypto space has to offer. Together, we'll work towards Pixels binding together endless worlds in our shared metaverse." />
  <meta property="og:image" content="https://pixeljourney.xyz/img/pixelblue.png" />

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="https://lb.pixeljourney.xyz/" />
  <meta property="twitter:title" content="
  Pixel Journey || WaxDAO Farm Collection Power Leaderboard
  " />
  <meta property="twitter:description" content="Pixel Journey is an innovative new crypto-education focused project starting off from Wax.io, NFT-bridged to both Polygon and Ethereum, soon our goal is to explore all that the Web3 and crypto space has to offer. Together, we'll work towards Pixels binding together endless worlds in our shared metaverse." />
  <meta property="twitter:image" content="https://pixeljourney.xyz/img/pixelblue.png" />

  <meta content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">

  <link rel="icon" type="image/x-icon" href="https://pixeljourney.xyz/img/logo.png">

    <title>Pixel Journey || WaxDAO Farm Collection Power Leaderboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <style>
    :root {
    --bg-dark: #202123;
    --bg-light: #ffffff;
    --accent-light: #f2f3f5;
    --accent-dark: #2d2f31;
    --highlight: #10a37f;
    --hover-bg-dark: #2f3134;
    --hover-bg-light: #eaeaea;
    --table-row-alt-dark: #27292b;
    --table-row-alt-light: #f9f9f9;
    --table-text-dark: #d1d5db;
    --table-text-light: #1f2937;
    --border-dark: #3a3d40;
    --border-light: #d1d5db;
    --card-dark: #27292b;
    --card-light: #f5f5f5;
    --btn-bg-dark: linear-gradient(90deg, #10a37f, #14b885);
    --btn-bg-light: linear-gradient(90deg, #10a37f, #14b885);
    --btn-hover-dark: #18b493;
    --btn-hover-light: #18b493;
}

body {
    background-color: var(--bg-dark);
    color: var(--table-text-dark);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    transition: all 0.3s ease;
}

.light-mode {
    background-color: var(--bg-light);
    color: var(--table-text-light);
}

a {
    color: var(--highlight);
    text-decoration: none;
}

a:hover {
    text-decoration: underline;
}

header {
    background-color: var(--bg-dark);
    padding: 16px;
    border-bottom: 1px solid var(--border-dark);
}

header.light-mode {
    background-color: var(--bg-light);
    border-bottom: 1px solid var(--border-light);
}

header h1 {
    color: var(--highlight);
    margin: 0;
    font-size: 1.8rem;
}

.stats-bar {
    display: flex;
    align-items: center;
    padding: 10px 20px;
    background: var(--card-dark);
    border: 1px solid var(--border-dark);
    border-radius: 8px;
}

.stats-bar .stat{
  margin-right: 5px;
}

.stats-bar img {
    height: 40px;
    margin-right: 15px;
}

.stats-bar.light-mode {
    background: var(--card-light);
    border: 1px solid var(--border-light);
}

.light-mode .stat {
    color: var(--table-text-dark);
}


button {
    border: none;
    color: white;
    padding: 10px 20px;
    cursor: pointer;
    border-radius: 6px;
    background: var(--btn-bg-dark);
    transition: all 0.3s ease;
}

button:hover {
    background: var(--btn-hover-dark);
}

.light-mode button {
    background: var(--btn-bg-light);
}

.light-mode button:hover {
    background: var(--btn-hover-light);
}

table {
    max-width: 97.5%;
    border-collapse: collapse;
    margin-left: auto;
    margin-right: auto;
}

table thead th {
    background: var(--card-dark);
    color: var(--table-text-dark);
    text-align: left;
    padding: 12px;
    border-bottom: 2px solid var(--border-dark);
}

.light-mode table thead th {
    background: var(--card-light);
    color: var(--table-text-light);
    border-bottom: 2px solid var(--border-light);
}

table tbody tr {
    background-color: var(--bg-dark);
    color: var(--table-text-dark);
    transition: background 0.3s ease;
}

table tbody tr:nth-child(2n) {
    background-color: var(--table-row-alt-dark);
}

table tbody tr:hover {
    background-color: var(--hover-bg-dark);
}

.light-mode table tbody tr {
    background-color: var(--accent-light);
    color: var(--table-text-light);
}

.light-mode table tbody tr:nth-child(2n) {
    background-color: var(--table-row-alt-light);
}

.light-mode table tbody tr:hover {
    background-color: var(--hover-bg-light);
}

table tbody td {
    padding: 10px;
    border-top: 1px solid var(--border-dark);
}

.light-mode table tbody td {
    border-top: 1px solid var(--border-light);
}

.card {
    background: var(--card-dark);
    color: var(--table-text-dark);
    padding: 20px;
    border: 1px solid var(--border-dark);
    border-radius: 8px;
    margin-bottom: 20px;
    transition: all 0.3s ease;
}

.card.light-mode {
    background: var(--card-light);
    color: var(--table-text-light);
    border: 1px solid var(--border-light);
}

.dropdown-menu {
    background: var(--card-dark);
    color: var(--table-text-dark);
    border: 1px solid var(--border-dark);
    border-radius: 8px;
    max-height: 300px;
    overflow-y: auto;
    padding: 10px;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
}

.dropdown-menu.light-mode {
    background: var(--card-light);
    color: var(--table-text-light);
    border: 1px solid var(--border-light);
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.05);
}

.dropdown-item {
    padding: 10px;
    cursor: pointer;
    border-radius: 4px;
}

.dropdown-item:hover {
    background: var(--highlight);
    color: white;
}

.dark-mode-toggle {
    position: absolute;
    top: 10px;
    right: 10px;
    background: var(--highlight);
    color: white;
    border: none;
    padding: 10px 15px;
    cursor: pointer;
    border-radius: 5px;
    transition: all 0.3s ease;
}

.dark-mode-toggle:hover {
    background: #18b493;
    color: white;
}

.input-group input {
    width: 100%;
    padding: 10px;
    background: var(--accent-dark);
    color: var(--table-text-dark);
    border: 1px solid var(--border-dark);
    border-radius: 4px;
    transition: all 0.3s ease;
}

.input-group input:focus {
    border-color: var(--highlight);
    outline: none;
}

.light-mode .input-group input {
    background: var(--accent-light);
    color: var(--table-text-light);
    border: 1px solid var(--border-light);
}

.loading {
  text-align: center;

}

.total-row {
    background-color: var(--highlight) !important;
    color: white !important;
    font-weight: bold;
}

.total-row td {
    border-top: 2px solid var(--border-dark) !important;
}

.light-mode .total-row {
    background-color: var(--highlight) !important;
    color: white !important;
}

.light-mode .total-row td {
    border-top: 2px solid var(--border-light) !important;
}

    </style>
</head>
<body>
  <!-- Dark Mode Toggle -->
     <button class="dark-mode-toggle" id="darkModeToggle">Light Mode</button>

     <!-- Stats Bar -->
     <div class="stats-bar">
         <a href="https://pixeljourney.xyz/" target="_blank">
             <img src="https://pixeljourney.xyz/img/logo.png" alt="Pixel Journey" style="height: 40px; margin-right: 15px;">
         </a>
         <div class="stat" id="waxPrice">WAX: $0.00</div>
         <div class="stat" id="wufPrice">WUF: $0.00</div>
         <div class="stat" id="pxjPrice">PXJ: $0.00</div>
     </div>

    <div class="container mt-4">
        <h1 class="text-center mb-4">Pixel Journey WaxDAO Farm Collection Power Leaderboard</h1>

                <!-- Settings Section -->
                <div class="row mb-3">

        <!-- Blacklist Settings -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <div class="exclude-wallets-container">
                        <div class="input-group mb-2">
                            <input type="text" class="form-control" id="excludeWalletsInput" placeholder="Blacklist wallets (Comma-separated)">
                            <button class="btn btn-secondary" id="updateExclusions">Update</button>
                        </div>
                        <button class="btn btn-secondary w-100" data-bs-toggle="modal" data-bs-target="#blacklistModal">
                            View/Edit Blacklisted Accounts
                        </button>
                    </div>
                </div>
            </div>
        </div>


            <!-- Filter Settings -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">

                        <!-- Quick Filter Buttons -->
  <div class="d-flex flex-wrap mb-3">
      <button class="btn btn-sm btn-secondary" id="togglePrimary">Toggle Primary Ingredients</button>
      <button class="btn btn-sm btn-secondary" id="toggleSecondary">Toggle Secondary Ingredients</button>
      <button class="btn btn-sm btn-secondary" id="toggleTertiary">Toggle Tertiary Ingredients</button>
  </div>
                      <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle w-100" type="button" id="templateDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                              Filter Templates
                          </button>
                          <ul class="dropdown-menu p-3" aria-labelledby="templateDropdown" id="templateFilters">
                              <li><button class="btn btn-sm btn-primary w-100 mb-2" id="selectAllTemplates">Select All</button></li>
                              <li><button class="btn btn-sm btn-danger w-100 mb-2" id="deselectAllTemplates">Deselect All</button></li>
                              <div id="templateFilters"></div>
                          </ul>
                      </div>
                  </div>
                        <select id="timePeriod" class="form-select mb-2">
                            <option value="second">Per Second</option>
                            <option value="minute">Per Minute</option>
                            <option value="hour">Per Hour</option>
                            <option value="day">Per Day</option>
                            <option value="week" selected="">Per Week</option>
                            <option value="month">Per Month</option>
                            <option value="year">Per Year</option>
                        </select>
                    </div>
                </div>
            </div>

            <button id="toggleView" class="btn btn-outline-primary w-100" style="display:none">
                Switch to USD View
            </button>
        </div>

        <div id="apr-notification" class="text-center p-4 mt-3 mb-3"
             style="font-size: 24px; font-weight: bold; color: #fff; background: #10a37f; border-radius: 10px;">
            ðŸ”¥ Current Ingredient <u>PXJ</u> Lockup-Staking APR rates (WUF bonus excluded) ðŸ”¥ <br>

            Black: <span id="blackApr">Calculating...</span>% |
            Secondary: <span id="secondaryApr">Calculating...</span>% |
            Tertiary: <span id="tertiaryApr">Calculating...</span>%
        </div>


        <!-- Collapsible Info Box -->
<div class="info-box mt-4 mb-4 text-center">

                <a href="https://waxdao.io/v2/farm/pixeljourney" class="btn btn-secondary" target="_blank">
               Go to Pixel Journey Farm
           </a>
           <button class="btn btn-secondary" id="stakingToggle" data-bs-toggle="collapse" data-bs-target="#stakingTable">
           Show Staking Information
       </button>

    <div class="collapse" id="stakingTable">
        <div class="table-responsive">
            <table class="table table-borderless table-sm">
                <thead>
                </thead>
                <tbody>
                    <tr>
                        <td><b>Name</b></td>
                        <td><b>WUF Staking / Hour</b></td>
                        <td><b>PXJ Staking / Hour</b></td>
                    </tr>
                    <tr>
                        <td>Pixal PFP</td>
                        <td>5.0000 WUF</td>
                        <td>0.25000000 PXJ</td>
                    </tr>
                    <tr>
                        <td>Pixel Ingredient Pack</td>
                        <td>20.0000 WUF</td>
                        <td>2.50000000 PXJ</td>
                    </tr>
                    <tr>
                        <td>Black (Primary)</td>
                        <td>100.0000 WUF</td>
                        <td>100.00000000 PXJ</td>
                    </tr>
                    <tr>
                        <td>Red (Primary)</td>
                        <td>2.0000 WUF</td>
                        <td>0.20000000 PXJ</td>
                    </tr>
                    <tr>
                        <td>Yellow (Primary)</td>
                        <td>2.0000 WUF</td>
                        <td>0.20000000 PXJ</td>
                    </tr>
                    <tr>
                        <td>Blue (Primary)</td>
                        <td>2.0000 WUF</td>
                        <td>0.20000000 PXJ</td>
                    </tr>
                    <tr>
                        <td>Green (Secondary)</td>
                        <td>9.0000 WUF</td>
                        <td>2.50000000 PXJ</td>
                    </tr>
                    <tr>
                        <td>Orange (Secondary)</td>
                        <td>9.0000 WUF</td>
                        <td>2.50000000 PXJ</td>
                    </tr>
                    <tr>
                        <td>Purple (Secondary)</td>
                        <td>9.0000 WUF</td>
                        <td>2.50000000 PXJ</td>
                    </tr>
                    <tr>
                        <td>Amber (Tertiary)</td>
                        <td>46.0000 WUF</td>
                        <td>13.50000000 PXJ</td>
                    </tr>
                    <tr>
                        <td>Chartreuse (Tertiary)</td>
                        <td>46.0000 WUF</td>
                        <td>13.50000000 PXJ</td>
                    </tr>
                    <tr>
                        <td>Violet (Tertiary)</td>
                        <td>46.0000 WUF</td>
                        <td>13.50000000 PXJ</td>
                    </tr>
                    <tr>
                        <td>Teal (Tertiary)</td>
                        <td>46.0000 WUF</td>
                        <td>13.50000000 PXJ</td>
                    </tr>
                    <tr>
                        <td>Vermillion (Tertiary)</td>
                        <td>46.0000 WUF</td>
                        <td>13.50000000 PXJ</td>
                    </tr>
                    <tr>
                        <td>Magenta (Tertiary)</td>
                        <td>46.0000 WUF</td>
                        <td>13.50000000 PXJ</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

<br>
                  <a href="https://docs.pixeljourney.xyz/introduction/season-1-starting-from-wax/recycling-and-crafting/pixel-ingredients-and-pack-staking" class="btn btn-secondary mt-3" target="_blank">
                 Stakables Guides of our Pixel Journey Docs
             </a>
</div>


        <!-- Leaderboard -->
              <div id="loading" class="loading mt-3">Loading data, please wait...</div>
              <div class="table-responsive" id="leaderboard-container" style="display:none;">
                <table class="table table-bordered mt-4" id="leaderboard">
    <thead>
        <tr>
            <th onclick="sortTable(0)">Rank</th>
            <th onclick="sortTable(1)">User</th>
            <th onclick="sortTable(2)">Filtered Assets Owned</th>
            <th onclick="sortTable(3)">PXJ Locked in Second-/Tertiary Ingredients</th>
            <th id="totalColumnHeader" class="highlight" onclick="sortTable(4)">
                Farm Yield Value (<span id="timePeriodLabelTotal">Per Week</span>)
            </th>
        </tr>
    </thead>
    <tbody>
        <!-- Rows dynamically added -->
    </tbody>
</table>
              </div>
    </div>


        <!-- Blacklist Modal -->
        <div class="modal fade" id="blacklistModal" tabindex="-1" aria-labelledby="blacklistModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="blacklistModalLabel">Blacklisted Accounts</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <ul id="blacklistAccounts" class="list-group">
                            <!-- Blacklist items dynamically generated -->
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    const templates = [
        { id: 781515, pxj: 0.25, wuf: 5.0, pxjUpgrade: 0, name: "Pixal PFP", type: "pixals" },
        { id: 820134, pxj: 2.5, wuf: 20.0, pxjUpgrade: 0, name: "Pixel Ingredient Pack", type: "pixelpack" },
        { id: 858568, pxj: 124.0, wuf: 100.0, pxjUpgrade: 0, name: "Black (Primary)", type: "primary" },
        { id: 858569, pxj: 0.2, wuf: 2.0, pxjUpgrade: 0, name: "Red (Primary)", type: "primary" },
        { id: 858570, pxj: 0.2, wuf: 2.0, pxjUpgrade: 0,  name: "Yellow (Primary)", type: "primary" },
        { id: 858571, pxj: 0.2, wuf: 2.0, pxjUpgrade: 0, name: "Blue (Primary)", type: "primary" },
        { id: 858572, pxj: 2.5, wuf: 9.0, pxjUpgrade: 25000, name: "Green (Secondary)", type: "secondary" },
        { id: 858573, pxj: 2.5, wuf: 9.0, pxjUpgrade: 25000, name: "Orange (Secondary)", type: "secondary" },
        { id: 858574, pxj: 2.5, wuf: 9.0, pxjUpgrade: 25000, name: "Purple (Secondary)", type: "secondary" },
        { id: 858575, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Amber (Tertiary)", type: "tertiary" },
        { id: 858576, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Chartreuse (Tertiary)", type: "tertiary" },
        { id: 858577, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Violet (Tertiary)", type: "tertiary" },
        { id: 858578, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Teal (Tertiary)", type: "tertiary" },
        { id: 858580, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Vermillion (Tertiary)", type: "tertiary" },
        { id: 859273, pxj: 13.5, wuf: 46.0, pxjUpgrade: 150000, name: "Magenta (Tertiary)", type: "tertiary" }
    ];


        const timeMultipliers = {
            second: 1 / 3600,
            minute: 1 / 60,
            hour: 1,
            day: 24,
            week: 24 * 7,
            month: 24 * 30,
            year: 24 * 365
        };

        let currentTimePeriod = "week";
        let currentView = "WAXP"; // Default view
        const excludedWallets = new Set(["swap.taco", "bridge.wax", "dao.pxj", "pixals.pxj", "pixeljourney", "wombatmaster", "dev.pxj", "team.pxj", "pepperstake"]);

        let pxjPriceUSD = 0;
        let wufPriceUSD = 0;

        async function fetchPrices() {
            const apiUrlPXJ = "https://alcor.exchange/api/v2/tokens/pxj-pixeljourney";
            const apiUrlWUF = "https://alcor.exchange/api/v2/tokens/wuf-wuffi";
            const apiUrlWAX = "https://alcor.exchange/api/v2/tokens/wax-eosio.token";

            try {
                const pxjResponse = await fetch(apiUrlPXJ);
                const wufResponse = await fetch(apiUrlWUF);
                const waxResponse = await fetch(apiUrlWAX);

                if (!pxjResponse.ok || !wufResponse.ok || !waxResponse.ok) throw new Error("Failed to fetch token prices.");

                const pxjData = await pxjResponse.json();
                const wufData = await wufResponse.json();
                const waxData = await waxResponse.json();

                pxjPriceUSD = pxjData.usd_price;
                wufPriceUSD = wufData.usd_price;
                waxPriceUSD = waxData.usd_price;


                                document.getElementById("waxPrice").textContent = `WAX: $${waxPriceUSD.toFixed(8)}`;
                                document.getElementById("pxjPrice").textContent = `PXJ: $${pxjPriceUSD.toFixed(8)}`;
                                document.getElementById("wufPrice").textContent = `WUF: $${wufPriceUSD.toFixed(8)}`;
            } catch (error) {
                console.error("Error fetching token prices:", error);
                throw new Error("Could not fetch token prices.");
            }
        }

        async function fetchTemplateHolders(template) {
            const apiUrl = `https://wax.api.atomicassets.io/atomicassets/v1/accounts?template_id=${template.id}&burned=false&page=1&limit=1000&order=desc`;
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                const result = await response.json();
                return result.data.map(holder => ({
                    username: holder.account,
                    assets: parseInt(holder.assets, 10),
                    pxj: parseInt(holder.assets, 10) * template.pxj,
                    wuf: parseInt(holder.assets, 10) * template.wuf
                }));
            } catch (error) {
                console.error(`Failed to fetch holders for template ${template.id}:`, error);
                return [];
            }
        }

        async function fetchAllData(selectedTemplates) {
    const leaderboardData = {};

    for (const template of selectedTemplates) {
        const holders = await fetchTemplateHolders(template);

        holders.forEach(holder => {
            if (excludedWallets.has(holder.username)) return;

            if (!leaderboardData[holder.username]) {
                leaderboardData[holder.username] = {
                    templatesOwned: 0,
                    pxj: 0,
                    wuf: 0,
                    pxjUpgrades: 0,
                    templates: {}, // Track template composition
                    upgradedIngredients: {} // Track upgraded ingredients
                };
            }

            leaderboardData[holder.username].templatesOwned += holder.assets;
            leaderboardData[holder.username].pxj += holder.pxj;
            leaderboardData[holder.username].wuf += holder.wuf;

            // Track template composition
            leaderboardData[holder.username].templates[template.id] = (leaderboardData[holder.username].templates[template.id] || 0) + holder.assets;

            if (template.pxjUpgrade > 0) {
                leaderboardData[holder.username].pxjUpgrades += holder.assets * template.pxjUpgrade;
                // Track upgraded ingredients
                leaderboardData[holder.username].upgradedIngredients[template.name] = (leaderboardData[holder.username].upgradedIngredients[template.name] || 0) + holder.assets;
            }
        });
    }

    return Object.entries(leaderboardData).map(([username, data]) => ({
        username,
        ...data
    }));
}

function populateLeaderboard(data) {
const loadingDiv = document.getElementById('loading');
const leaderboardContainer = document.getElementById('leaderboard-container');
const tbody = document.querySelector('#leaderboard tbody');
const totalColumnHeader = document.getElementById('totalColumnHeader');
const timePeriodLabelTotal = document.getElementById('timePeriodLabelTotal');

loadingDiv.style.display = 'none';
leaderboardContainer.style.display = 'block';

const multiplier = timeMultipliers[currentTimePeriod];

timePeriodLabelTotal.textContent = `Per ${currentTimePeriod}`;

tbody.innerHTML = ""; // Clear existing rows

data.sort((a, b) => b.pxj - a.pxj); // Sort by PXJ (default)

// Initialize totals
let totalTemplatesOwned = 0;
let totalPxjUpgrades = 0;
let totalPxjReward = 0;
let totalWufReward = 0;
let totalUSD = 0;

data.forEach((user, index) => {
    const pxjReward = user.pxj * multiplier;
    const wufReward = user.wuf * multiplier;
    const pxjValueUSD = pxjReward * pxjPriceUSD;
    const wufValueUSD = wufReward * wufPriceUSD;
    const userTotalUSD = pxjValueUSD + wufValueUSD;

    // Accumulate totals
    totalTemplatesOwned += user.templatesOwned;
    totalPxjUpgrades += user.pxjUpgrades;
    totalPxjReward += pxjReward;
    totalWufReward += wufReward;
    totalUSD += userTotalUSD;

    // Generate tooltip content for "Journey Assets Owned"
    const templatesTooltip = `
        <strong>Templates Held:</strong><br>
        ${Object.entries(user.templates).map(([templateId, count]) => `
            ${templates.find(t => t.id === parseInt(templateId))?.name || templateId}: ${count}
        `).join('<br>')}
    `;

    // Generate tooltip content for "Locked PXJ"
    const upgradesTooltip = `
        <strong>Upgraded Ingredients:</strong><br>
        ${Object.entries(user.upgradedIngredients).map(([ingredient, count]) => `
            ${ingredient}: ${count}
        `).join('<br>')}
    `;

    const row = document.createElement("tr");
    row.innerHTML = `
        <td>${index + 1}</td>
        <td>
            <a href="https://atomichub.io/profile/wax-mainnet/${user.username}" target="_blank">
                ${user.username}
            </a>
        </td>
        <td data-bs-toggle="tooltip" data-bs-html="true" title="${templatesTooltip}">
            ${user.templatesOwned}
        </td>
        <td data-bs-toggle="tooltip" data-bs-html="true" title="${upgradesTooltip}">
            ${user.pxjUpgrades.toLocaleString()} PXJ
        </td>
        <td>
            <strong>=~ ${(userTotalUSD / waxPriceUSD).toFixed(2)} WAX or $${userTotalUSD.toFixed(2)}</strong><br>
            <small>(${pxjReward.toLocaleString()} PXJ + ${wufReward.toLocaleString()} WUF)</small>
        </td>
    `;
    tbody.appendChild(row);
});

// Add the total row
const totalRow = document.createElement("tr");
totalRow.className = "total-row"; // Add a class for styling
totalRow.innerHTML = `
    <td colspan="2"><strong>Total</strong></td>
    <td><strong>${totalTemplatesOwned.toLocaleString()}</strong></td>
    <td><strong>${totalPxjUpgrades.toLocaleString()} PXJ</strong></td>
    <td>
        <strong>=~ ${(totalUSD / waxPriceUSD).toFixed(2)} WAX or $${totalUSD.toFixed(2)}</strong><br>
        <small>(${totalPxjReward.toLocaleString()} PXJ + ${totalWufReward.toLocaleString()} WUF)</small>
    </td>
`;
tbody.appendChild(totalRow);

// Initialize tooltips
const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
tooltipTriggerList.map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
}


        async function updateLeaderboard() {
            try {
                await fetchPrices(); // Fetch prices globally once

                const selectedTemplates = templates.filter(template => {
                    const checkbox = document.getElementById(`template-${template.id}`);
                    return checkbox.checked;
                });

                if (selectedTemplates.length === 0) {
                    alert('Please select at least one template!');
                    return;
                }

                document.getElementById('loading').style.display = 'block';
                document.getElementById('leaderboard-container').style.display = 'none';

                const data = await fetchAllData(selectedTemplates);
                populateLeaderboard(data);
            } catch (error) {
                console.error("Error updating leaderboard:", error);
                alert("Failed to update leaderboard. Please try again later.");
            }
        }

        function toggleView() {
            currentView = currentView === "WAXP" ? "USD" : "WAXP";
            document.getElementById("toggleView").textContent =
                currentView === "WAXP" ? "Switch to USD View" : "Switch to WAXP View";
            updateLeaderboard();
        }

        async function initLeaderboard() {
            createTemplateFilters();
            updateBlacklistModal();

            // Add event listeners for filters
            document.querySelectorAll('.form-check-input').forEach(input => {
                input.addEventListener('change', updateLeaderboard);
            });

            document.addEventListener("DOMContentLoaded", () => {
      const stakingButton = document.getElementById("stakingToggle");
      stakingButton.addEventListener("click", () => {
          stakingButton.textContent = stakingButton.textContent.includes("Show")
              ? "Hide Staking Information"
              : "Show Staking Information";
      });
  });


            // Add event listener for time period change
            document.getElementById('timePeriod').addEventListener('change', (event) => {
                currentTimePeriod = event.target.value;
                updateLeaderboard();
            });

                        // Add toggle button listener
                        document.getElementById('toggleView').addEventListener('click', toggleView);

            // Initial load
            await updateLeaderboard();
        }

        let sortDirection = 1; // 1 for ascending, -1 for descending

function sortTable(columnIndex) {
    const tbody = document.querySelector('#leaderboard tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));

    rows.sort((a, b) => {
        const aValue = a.children[columnIndex].textContent.trim();
        const bValue = b.children[columnIndex].textContent.trim();

        if (columnIndex === 0 || columnIndex === 2 || columnIndex === 3) {
            // Sort numbers
            return sortDirection * (parseFloat(aValue.replace(/,/g, '')) - parseFloat(bValue.replace(/,/g, '')));
        } else if (columnIndex === 1) {
            // Sort usernames alphabetically
            return sortDirection * aValue.localeCompare(bValue);
        } else if (columnIndex === 4) {
            // Sort by WAX value
            const aWax = parseFloat(a.children[4].textContent.match(/=~ ([\d.]+) WAX/)[1]);
            const bWax = parseFloat(b.children[4].textContent.match(/=~ ([\d.]+) WAX/)[1]);
            return sortDirection * (aWax - bWax);
        }
        return 0;
    });

    // Toggle sort direction
    sortDirection *= -1;

    // Clear and re-add sorted rows
    tbody.innerHTML = "";
    rows.forEach(row => tbody.appendChild(row));
}

        function createTemplateFilters() {
            const filtersDiv = document.getElementById('templateFilters');

            templates.forEach(template => {
                const filter = document.createElement('div');
                filter.className = 'form-check';
                filter.innerHTML = `
                    <input class="form-check-input" type="checkbox" id="template-${template.id}" value="${template.id}" checked>
                    <label class="form-check-label" for="template-${template.id}">
                        Template ${template.id}: ${template.name}
                    </label>
                `;
                filtersDiv.appendChild(filter);
            });

            document.getElementById('selectAllTemplates').addEventListener('click', () => {
                document.querySelectorAll('.form-check-input').forEach(input => input.checked = true);
                updateLeaderboard();
            });

            document.getElementById('deselectAllTemplates').addEventListener('click', () => {
                document.querySelectorAll('.form-check-input').forEach(input => input.checked = false);
                updateLeaderboard();
            });
        }


                async function updateBlacklistModal() {
                    const blacklistAccounts = document.getElementById("blacklistAccounts");
                    if (!blacklistAccounts) return;

                    blacklistAccounts.innerHTML = "";
                    excludedWallets.forEach(wallet => {
                        const listItem = document.createElement("li");
                        listItem.className = "list-group-item d-flex justify-content-between align-items-center";
                        listItem.textContent = wallet;

                        const removeBtn = document.createElement("button");
                        removeBtn.className = "btn btn-sm btn-danger";
                        removeBtn.textContent = "Remove";
                        removeBtn.onclick = () => {
                            excludedWallets.delete(wallet);
                            updateBlacklistModal();
                        };

                        listItem.appendChild(removeBtn);
                        blacklistAccounts.appendChild(listItem);
                    });
                }

        // Initialize leaderboard on page load
        window.onload = initLeaderboard;

        const darkModeToggle = document.getElementById('darkModeToggle');
        darkModeToggle.addEventListener('click', () => {
            document.body.classList.toggle('light-mode');
            darkModeToggle.textContent = document.body.classList.contains('light-mode') ? 'Dark Mode' : 'Light Mode';
        });

        function calculateAPR() {

    const primaryReward = 2;
    const secondaryReward = 2.5;
    const tertiaryReward = 13.5;
    const blackReward = 124;

    const primaryAPR = ((primaryReward * 24 * 365) / 8000) * 100;
    const secondaryAPR = ((secondaryReward * 24 * 365) / 25000) * 100;
    const tertiaryAPR = ((tertiaryReward * 24 * 365) / 125000) * 100;
    const blackAPR = ((blackReward * 24 * 365) / 1500000) * 100;

    //document.getElementById("primaryApr").textContent = primaryAPR.toFixed(2);
    document.getElementById("secondaryApr").textContent = secondaryAPR.toFixed(2);
    document.getElementById("tertiaryApr").textContent = tertiaryAPR.toFixed(2);
    document.getElementById("blackApr").textContent = blackAPR.toFixed(2);
}

// Run APR calculation when the page loads
document.addEventListener("DOMContentLoaded", calculateAPR);


    </script>
</body>
</html>
